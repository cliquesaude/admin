/*!
 * Copyright 2018 E-Com Club
 */
!function(){"use strict";var a=window.tabId,b=$("#"+a+"-tab-normal");window.renderContentIds(b);var c,d=window.i18n,e=window.routeParams[0],f=window.routeParams[1];"new"===f&&(c=!0);var g=window.tabCommit[a],h=function(){return window.tabData[a]},i=b.children("form");window.setSaveAction(i,function(b){var d,g;c?(g=e+".json",d="POST"):(g=e+"/"+f+".json",d="PUT"),i.addClass("ajax");var j=function(){i.removeClass("ajax"),"function"==typeof b&&b(a)};window.callApi(g,d,j,h())});var j=0,k=0,l=function(){if(++k===j){var a=i.find(".html-editor");a.summernote({toolbar:[["style",["style"]],["font",["bold","italic","underline","strikethrough","clear"]],["color",["color"]],["insert",["picture","link","video","hr","table"]],["paragraph",["ul","ol","paragraph"]],["misc",["codeview","help"]]],height:400,dialogsFade:!0,callbacks:{onChange:function(b){var c=b.trim();"<div>"!==c.substring(0,5)&&a.summernote("code","<div><br></div>"+c)},onBlur:function(){a.trigger("change")}}}),i.find(".tagsinput").tagsinput(),i.find("select:not(.tagsinput)").selectpicker({style:"btn-light",noneSelectedText:"--"});var b=function(a,b){if(""===(b=b.trim()))return null;if(a.data("json")){var c;try{c=JSON.parse(b)}catch(a){c=!1}return c}return b};i.find('input[type="text"],select,textarea').change(function(){var a=$(this).attr("name");if(a&&""!==a){var c,d=h(),e=$(this).val();if("string"==typeof e)if(c=b($(this),e))d[a]=c;else{if(null!==c||!d.hasOwnProperty(a))return;delete d[a]}else if(Array.isArray(e)){for(var f=[],i=0;i<e.length;i++)(c=b($(this),e[i]))&&f.push(c);if(f.length)d[a]=f;else{if(!d.hasOwnProperty(a))return;delete d[a]}}g(d,!0)}}),i.find('input[type="file"]').each(function(){var b,c,e,f,j,k;c=$(this).attr("multiple"),c?(f=$(this).data("max"),f||(f=50),b=d({en_us:"Select images",pt_br:"Selecionar imagens"})):(f=1,b=d({en_us:"Select image",pt_br:"Selecionar imagem"})),j=$(this).attr("name"),e=$(this).data("thumbnails");var l=function(b,i){if(!b){var l=h();if(i.length>f&&(c?(e&&i.splice(f,i.length-f),app.toast(d({en_us:"A maximum of "+f+" images will be selected",pt_br:"No máximo "+f+" imagens serão selecionadas"}))):app.toast(d({en_us:"Only one image will be selected",pt_br:"Apenas uma imagem será selecionada"}))),e)l[j]=c?i:i[0];else if(c)for(l[j]=[],k=0;k<i.length;k++)l[j].push(i[k].zoom);else l[j]=i[0].zoom;if(g(l,!0),!m){o.addClass("ajax").find("img").remove();var n=0,p=0,q="",r=function(){++p===n&&o.removeClass("ajax").children(".images-list").prepend(q)}}for(k=0;k<i.length&&k<f;k++)!function(){if(m)a.summernote("insertImage",i[k].zoom.url,function(a){a.css("max-width","100%")});else{n++;var b=i[k].normal.url,c=new Image;c.onload=function(){m||(q+='<img src="'+b+'" />',r())},c.src=b}}()}},m=$(this).hasClass("note-image-input"),n=function(){var a;m?(i.find(".note-editor .modal.show").modal("hide"),a=400):a=100,window.setImagesCallback(l),setTimeout(function(){window.upload()},a)},o=$("<div/>",{class:"select-image scrollable ajax-content",html:'<div class="ajax-overlay"><div class="spinner-circle-material"></div></div><div class="images-list"><p><i class="fa fa-picture-o"></i>&nbsp; '+b+"</p></div>",click:n});$(this).replaceWith(o)}),window.fixScrollbars(i),i.removeClass("ajax ajax-cards")}};i.find("select").each(function(a){var b=$(this).data("fill");if(b){j++;var c=[$(this)];i.find('select[data-fill-same="'+$(this).attr("name")+'"]').each(function(){c.push($(this))});var d,e=b+".json",f=$(this).data("properties");f&&(d=!0,e+="?fields="+f),window.callApi(e,"GET",function(a,b){if(!a){var e=b.result;if(e)for(var f=0;f<e.length;f++)for(var g=e[f],h=0;h<c.length;h++){var i;i=d?JSON.stringify(g):g._id,$("<option />",{value:i}).text(g.name).appendTo(c[h])}}l()})}})}();