/*!
 * Copyright 2018 E-Com Club
 */
!function(){"use strict";var a=window.tabId,b=$("#"+a+"-tab-normal");window.renderContentIds(b);var c,d=window.routeParams[0],e=window.routeParams[1];"new"===e&&(c=!0);var f=window.tabCommit[a],g=function(){return window.tabData[a]},h=b.children("form");window.setSaveAction(h,function(b){var f,i;c?(i=d+".json",f="POST"):(i=d+"/"+e+".json",f="PUT"),h.addClass("ajax");var j=function(){h.removeClass("ajax"),"function"==typeof b&&b(a)};window.callApi(i,f,j,g())});var i=0,j=0,k=function(){if(++j===i){h.find(".html-editor").summernote(),h.find(".tagsinput").tagsinput("items"),h.find("select:not(.tags)").selectpicker({style:"btn-light",noneSelectedText:"--"});var a=function(a,b){if(""===(b=b.trim()))return null;if(a.data("json")){var c;try{c=JSON.parse(b)}catch(a){c=!1}return c}return b};h.find('input[type="text"],select').change(function(){var b=$(this).attr("name");if(b&&""!==b){var c,d=g(),e=$(this).val();if("string"==typeof e)if(c=a($(this),e))d[b]=c;else{if(null!==c||!d.hasOwnProperty(b))return;delete d[b]}else if(Array.isArray(e)){for(var h=[],i=0;i<e.length;i++)(c=a($(this),e[i]))&&h.push(c);if(h.length)d[b]=h;else{if(!d.hasOwnProperty(b))return;delete d[b]}}f(d,!0)}}),h.removeClass("ajax ajax-cards")}};h.find("select").each(function(a){var b=$(this).data("fill");if(b){i++;var c=[$(this)];h.find('select[data-fill-same="'+$(this).attr("name")+'"]').each(function(){c.push($(this))});var d,e=b+".json",f=$(this).data("properties");f&&(d=!0,e+="?fields="+f),window.callApi(e,"GET",function(a,b){if(!a){var e=b.result;if(e)for(var f=0;f<e.length;f++)for(var g=e[f],h=0;h<c.length;h++){var i;i=d?JSON.stringify(g):g._id,$("<option />",{value:i}).text(g.name).appendTo(c[h])}}k()})}})}();