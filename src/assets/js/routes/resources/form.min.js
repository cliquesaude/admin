/*!
 * Copyright 2018 E-Com Club
 */
!function(){"use strict";var a=window.tabId,b=$("#"+a+"-tab-normal");window.renderContentIds(b);var c,d,e=window.i18n,f=window.routeParams[0],g=window.routeParams[1];"new"===g?(c=!0,d=f+".json"):(d=f+"/"+g+".json",$("#"+a+"-delete").click(function(){window.callApi(d,"DELETE",function(a,b){a||(window.location="/#/resources/"+f)})}),$("#"+a+"-nav .edit-btn").fadeIn());var h=window.tabCommit[a],i=function(){return window.tabData[a]},j=b.children("form");window.setSaveAction(j,function(b){var e;e=c?"POST":"PUT",j.addClass("ajax");var g=function(d,e){"function"==typeof b&&b(a),c&&!d&&e._id?window.location="/#/resources/"+f+"/"+e._id:j.removeClass("ajax")};window.callApi(d,e,g,i())});var k=0,l=0,m=function(){if(++l===k){var a=j.find(".html-editor");a.summernote({toolbar:[["style",["style"]],["font",["bold","italic","underline","strikethrough","clear"]],["color",["color"]],["insert",["picture","link","video","hr","table"]],["paragraph",["ul","ol","paragraph"]],["misc",["codeview","help"]]],height:400,dialogsFade:!0,callbacks:{onChange:function(b){var c=b.trim();"<div>"!==c.substring(0,5)&&a.summernote("code","<div><br></div>"+c)},onBlur:function(){a.trigger("change")}}}),j.find(".tagsinput").tagsinput(),j.find("select:not(.tagsinput)").selectpicker({style:"btn-light",noneSelectedText:"--"});var b=function(a,b){if(""===(b=b.trim()))return null;if(a.data("json")){var c;try{c=JSON.parse(b)}catch(a){c=!1}return c}return b};j.find('input[type="text"],select,textarea').change(function(){var a=$(this).attr("name");if(a&&""!==a){var c,d=i(),e=$(this).val();if("string"==typeof e)if(c=b($(this),e))d[a]=c;else{if(null!==c||!d.hasOwnProperty(a))return;delete d[a]}else if(Array.isArray(e)){for(var f=[],g=0;g<e.length;g++)(c=b($(this),e[g]))&&f.push(c);if(f.length)d[a]=f;else{if(!d.hasOwnProperty(a))return;delete d[a]}}h(d,!0)}}),j.find('input[type="file"]').each(function(){var b,d,f,g,k,l;d=$(this).attr("multiple"),d?(g=$(this).data("max"),g||(g=50),b=e({en_us:"Select images",pt_br:"Selecionar imagens"})):(g=1,b=e({en_us:"Select image",pt_br:"Selecionar imagem"})),k=$(this).attr("name"),f=$(this).data("thumbnails");var m=function(b,j){if(!b){var m=i();if(j.length>g&&(d?(f&&j.splice(g,j.length-g),app.toast(e({en_us:"A maximum of "+g+" images will be selected",pt_br:"No máximo "+g+" imagens serão selecionadas"}))):app.toast(e({en_us:"Only one image will be selected",pt_br:"Apenas uma imagem será selecionada"}))),f)m[k]=d?j:j[0];else if(d)for(m[k]=[],l=0;l<j.length;l++)m[k].push(j[l].zoom);else m[k]=j[0].zoom;if(h(m,!0),!n){p.addClass("ajax");var o=p.children(".images-list");o.children("span").remove();var q=0,r=0,s=[],t=function(){++r===q&&(o.prepend(s),p.removeClass("ajax"))}}for(l=0;l<j.length&&l<g;l++)!function(){var b;n?b=j[l].zoom.url:(q++,b=j[l].normal.url);var d=l,e=new Image;e.onload=function(){n?a.summernote("insertImage",b,function(a){a.css("max-width","100%")}):(s.push($("<span />",{html:'<img src="'+b+'" /><i class="fa fa-cog"></i>',click:c(k,d)})),t())},e.src=b}()}},n=$(this).hasClass("note-image-input"),o=function(){var a;n?(j.find(".note-editor .modal.show").modal("hide"),a=400):a=100,window.setImagesCallback(m),setTimeout(function(){window.upload()},a)},p=$("<div/>",{class:"select-image scrollable ajax-content",html:'<div class="ajax-overlay"><div class="spinner-circle-material"></div></div><div class="images-list"><p><i class="fa fa-picture-o"></i>&nbsp; '+b+"</p></div>",click:o});$(this).replaceWith(p)});var c=function(a,b){return function(c){c.stopPropagation();var d=$(this);window.editImage(function(c,e){if(!c){var f=i();if(!1===e)Array.isArray(f[a])?f[a].splice(b,1):delete f[a],d.toggle("slide",function(){$(this).remove()});else{var g=f[a];if("object"==typeof g){Array.isArray(g)&&(g=g[b]);for(var j in e){var k=e[j];if(k)if(g.hasOwnProperty("zoom"))if("size"!==j)for(var l in g)g.hasOwnProperty(l)&&(g[l][j]=k);else g.zoom[j]=k;else g[j]=k}}}h(f,!0)}})}};window.fixScrollbars(j),j.removeClass("ajax ajax-cards")}};j.find("select").each(function(a){var b=$(this).data("fill");if(b){k++;var c=[$(this)];j.find('select[data-fill-same="'+$(this).attr("name")+'"]').each(function(){c.push($(this))});var d,e=b+".json",f=$(this).data("properties");f&&(d=!0,e+="?fields="+f),window.callApi(e,"GET",function(a,b){if(!a){var e=b.result;if(e)for(var f=0;f<e.length;f++)for(var g=e[f],h=0;h<c.length;h++){var i;i=d?JSON.stringify(g):g._id,$("<option />",{value:i}).text(g.name).appendTo(c[h])}}m()})}})}();