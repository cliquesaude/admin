/*!
 * Copyright 2018 E-Com Club
 */
!function(){"use strict";var a=window.tabId,b=$("#"+a+"-tab-normal");window.renderContentIds(b);var c,d,e=window.i18n,f=function(a,b,c,d){l.addClass("ajax");var e=function(a,b){l.removeClass("ajax"),a||c(b)};window.callApi(a,b,e,d)},g=window.tabCommit[a],h=function(){return window.tabData[a]},i=window.routeParams[0],j=window.routeParams[1];if("new"===j)c=!0,d=i+".json";else{d=i+"/"+j+".json",$("#"+a+"-delete").click(function(){f(d,"DELETE",function(a){window.location="/#/resources/"+i})}),$("#"+a+"-duplicate").click(function(){f(i+".json","POST",function(a){window.location="/#/resources/"+i+"/"+a._id},h())});var k=function(a){if(window.shopDomain&&h().slug){var b="https://"+window.shopDomain+"/"+h().slug;a&&(b=a+encodeURIComponent(b)),window.newTabLink(b)}else app.toast(e({en_us:"No link to share",pt_br:"Nenhum link para compartilhar"}))};$("#"+a+"-view").click(function(){k()}),$("#"+a+"-facebook").click(function(){k("https://www.facebook.com/sharer.php?u=")}),$("#"+a+"-whatsapp").click(function(){var a;a=$(window).width()<480?"api":"web",k("https://"+a+".whatsapp.com/send?text=")}),$("#"+a+"-nav .edit-btn").fadeIn()}var l=b.children("form");window.setSaveAction(l,function(b){var e;e=c?"POST":"PUT",f(d,e,function(d){"function"==typeof b&&b(a),c&&d._id&&(window.location="/#/resources/"+i+"/"+d._id)},h())});var m=0,n=0,o=function(){if(++n===m){var a=function(a,b){if(""===(b=b.trim()))return null;if(a.data("json")){var c;try{c=JSON.parse(b)}catch(a){c=!1}return c}return b};if(l.find('input[type="text"],select,textarea').change(function(){var b=$(this).attr("name");if(b&&""!==b){var c,d=h(),e=$(this).val();if("string"==typeof e)if(c=a($(this),e))d[b]=c;else{if(null!==c||!d.hasOwnProperty(b))return;delete d[b]}else if(Array.isArray(e)){for(var f=[],i=0;i<e.length;i++)(c=a($(this),e[i]))&&f.push(c);if(f.length)d[b]=f;else{if(!d.hasOwnProperty(b))return;delete d[b]}}g(d,!0)}}),!c){var b=h();for(var d in b){var f=b[d],i=$('[name="'+d+'"]');if(i&&!i.is("input:file"))switch(typeof f){case"string":i.val(f);break;case"object":if(Array.isArray(f)){for(var j=[],k=0;k<f.length;k++){var o=f[k];"string"!=typeof o?j.push(JSON.stringify(o)):j.push(o)}i.val(j)}else null!==f&&i.val(JSON.stringify(f))}}}l.find(".tagsinput").tagsinput(),l.find("select:not(.tagsinput)").selectpicker({style:"btn-light",noneSelectedText:"--"});var p=l.find(".html-editor"),q=!1;p.summernote({toolbar:[["style",["style"]],["font",["bold","italic","underline","strikethrough","clear"]],["color",["color"]],["insert",["picture","link","video","hr","table"]],["paragraph",["ul","ol","paragraph"]],["misc",["codeview","help"]]],height:400,dialogsFade:!0,callbacks:{onChange:function(a){q=!0;var b=a.trim();"<div>"!==b.substring(0,5)&&p.summernote("code","<div><br></div>"+b)},onBlur:function(){q&&(p.trigger("change"),q=!1)}}}),l.find('input[type="file"]').each(function(){var a,b,d,f,i,j;b=$(this).attr("multiple"),b?(f=$(this).data("max"),f||(f=50),a=e({en_us:"Select images",pt_br:"Selecionar imagens"})):(f=1,a=e({en_us:"Select image",pt_br:"Selecionar imagem"})),i=$(this).attr("name"),d=$(this).data("thumbnails");var k=function(a,c,k){if(!a){var l=h();if(l.hasOwnProperty(i)){var n=function(a){if(a){if(!d){var b=a.url;a={zoom:a},-1!==b.indexOf("digitaloceanspaces.com/@")?a.normal={url:b.replace(/^((https?:)?\/\/[^\/]+\/)(.*)$/,"$1imgs/400px/$3")}:a.normal=a.zoom}c.push(a)}};if(b)for(j=0;j<l[i].length;j++){var q=l[i][j];n(q)}else c.length||n(l[i])}if(!c.length)return;if(c.length>f&&(b?(d&&c.splice(f,c.length-f),app.toast(e({en_us:"A maximum of "+f+" images will be selected",pt_br:"No máximo "+f+" imagens serão selecionadas"}))):app.toast(e({en_us:"Only one image will be selected",pt_br:"Apenas uma imagem será selecionada"}))),!m){o.addClass("ajax");var s=o.children(".images-list");s.children("span").remove();var t=0,u=0,v=[],w=function(){++u===t&&(s.prepend(v),o.removeClass("ajax"))};if(!k){if(b){l[i]=[];var x="110000000000000000000000";for(j=0;j<c.length;j++){var y;y=d?c[j]:c[j].zoom;var z=""+j;y._id=x.substring(0,x.length-z.length)+z,l[i].push(y)}}else l[i]=d?c[0]:c[0].zoom;g(l,!0)}}for(j=0;j<c.length&&j<f;j++)!function(){var a;m?a=c[j].zoom.url:(t++,a=c[j].normal.url);var b=j,d=function(){m?p.summernote("insertImage",a,function(a){a.css("max-width","100%")}):(v.push($("<span />",{html:'<img src="'+a+'" /><i class="fa fa-cog"></i>',click:r(i,b)})),w())},e=new Image;e.onload=function(){d(),clearTimeout(f)};var f=setTimeout(d,5e3);e.src=a}()}},m=$(this).hasClass("note-image-input"),n=function(){var a;m?(l.find(".note-editor .modal.show").modal("hide"),a=400):a=100,window.setImagesCallback(k),setTimeout(function(){window.upload()},a)},o=$("<div/>",{class:"select-image scrollable ajax-content",html:'<div class="ajax-overlay"><div class="spinner-circle-material"></div></div><div class="images-list"><p><i class="fa fa-picture-o"></i>&nbsp; '+a+"</p></div>",click:n});$(this).replaceWith(o),c||k(null,[],!0)});var r=function(a,b){return function(c){c.stopPropagation();var d=$(this);window.editImage(function(c,e){if(!c){var f=h();if(!1===e)Array.isArray(f[a])?f[a].splice(b,1):delete f[a],d.toggle("slide",function(){$(this).remove()});else{var i=f[a];if("object"==typeof i){Array.isArray(i)&&(i=i[b]);for(var j in e){var k=e[j];if(k)if(i.hasOwnProperty("zoom"))if("size"!==j)for(var l in i)i.hasOwnProperty(l)&&(i[l][j]=k);else i.zoom[j]=k;else i[j]=k}}}g(f,!0)}})}};window.fixScrollbars(l),l.removeClass("ajax ajax-cards")}};l.find("select").each(function(a){var b=$(this).data("fill");if(b){m++;var c=[$(this)];l.find('select[data-fill-same="'+$(this).attr("name")+'"]').each(function(){c.push($(this))});var d,e=b+".json",f=$(this).data("properties");f&&(d=!0,e+="?fields="+f),window.callApi(e,"GET",function(a,b){if(!a){var e=b.result;if(e)for(var f=0;f<e.length;f++){var g=e[f];if(g._id!==j)for(var h=0;h<c.length;h++){var i;i=d?JSON.stringify(g):g._id,$("<option />",{value:i,text:g.name}).appendTo(c[h])}}}o()})}})}();