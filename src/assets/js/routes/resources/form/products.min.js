/*!
 * Copyright 2018 E-Com Club
 */
!function(){"use strict";var a=window.tabId,b=window.Tabs[a],c=function(){return b.data},d=window.i18n;b.continue=function(){var e=b.$form,f=randomObjectId(),g=0,h={},i=function(a){h=a,console.log(h)};b.schema?i(b.schema.properties.specifications):window.callApi("products/schema/specifications.json","GET",function(a,b){a||i(b.properties)});var j=$("#"+a+"-grids-list"),k='<div class="row gap-2"><div class="col-6"><div class="flexbox align-items-center"><div class="i-drag"></div><div class="input-group"><div class="input-group-prepend"><button class="btn btn-light remove-grid" type="button"><i class="fa fa-trash"></i></button></div><input class="form-control" type="text" name="grid" placeholder="'+d({en_us:"Size",pt_br:"Tamanho"})+'"></div></div></div><div class="col-6 hidden option-block"><div class="input-group"><input class="form-control" type="text" name="option" placeholder="GG"><div class="input-group-append"><button class="btn btn-light add-option" type="button"><i class="fa fa-plus"></i></button></div></div></div></div><ul class="hide-empty badges-list"></ul>',l=0,m=function(b){var c=j.find('input[name="grid"]').filter(function(){return""===$(this).val()});if(c.length)return void c.focus();var d=$("<li />",{html:k});j.append(d);var e=d.find('input[name="grid"]'),f=d.find(".option-block"),g=f.find('input[name="option"]'),h=!0;e.change(function(){""!==$(this).val()?g.focus():(g.val(""),l>1&&o(d))}).keyup(function(){""!==e.val()?h&&(f.fadeIn(),h=!1,1===l&&$("#"+a+"-add-option-header").fadeIn()):h||(f.fadeOut(),h=!0,1===l&&$("#"+a+"-add-option-header").fadeOut())}).keydown(function(a){switch(a.which){case 9:case 13:setTimeout(function(){e.trigger("change")},100)}}),g.keydown(function(a){switch(a.which){case 9:setTimeout(function(){e.focus()},100);break;case 13:n(d,g)}}),e.typeahead({hint:!0,highlight:!0,minLength:1},{name:"states",source:substringMatcher(p)}),d.find(".remove-grid").click(function(){o(d)}),d.find(".add-option").click(function(){n(d,g)}),l++,1===l&&$("#"+a+"-grids-list-header").slideDown(),d.slideDown(400,function(){b||e.focus()})},n=function(a,b){for(var c=b.val().split(","),d=0;d<c.length;d++){var e=c[d].trim();if(""!==e){var f=$("<li />",{html:'<span class="i-drag white"></span>'+e+'<i class="fa fa-times"></i>'});a.find(".badges-list").append(f),f.find(".fa-times").click(function(){f.remove()})}}};$("#"+a+"-add-grid").click(function(){m()});var o=function(b){b.slideUp(400,function(){$(this).remove()}),0===--l&&$("#"+a+"-grids-list-header, #"+a+"-add-option-header").slideUp()},p=["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"],q=e.find('input[name="sku"]');q.click(function(){$(this).select()});var r=function(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZ",c=0;c<3;c++)a+=b.charAt(Math.floor(Math.random()*b.length));a+=randomInt(1e4,99999),q.val(a).trigger("change")};if($("#"+a+"-random-sku").click(r),!c().sku){var s=function(){r(),e.off("change",'input[name="name"]',s)};e.on("change",'input[name="name"]',s)}setTimeout(function(){var a=function(a,b){var c=function(a){return JSON.stringify({_id:a,name:b})},d=$("<option />",{text:b,selected:!0,value:c(objectIdPad(f,""+g))});a.append(d).selectpicker("refresh").trigger("change"),g++;var e=a.attr("name"),h=function(b,e){b||(d.val(c(e._id)),a.trigger("change"))};window.callApi(e+".json","POST",h,{name:b})};e.find('select[name="brands"],select[name="categories"]').each(function(){var b=$(this).prev(".dropdown-menu");if(b.length){var c=$(this);b.find(".bs-searchbox input").keydown(function(){var e=$(this);setTimeout(function(){var f=b.find(".dropdown-menu > .no-results");if(f.length){var g=$("<button />",{class:"btn btn-outline btn-secondary btn-sm btn-block",type:"button",html:'<i class="fa fa-plus"></i> '+d({en_us:"Add",pt_br:"Adicionar"}),click:function(){a(c,e.val())}});f.html(g)}},300)})}})},400),e.find('input[name="name"]').attr("placeholder",d({en_us:"Long Sleeve Polo Shirt",pt_br:"Camisa Polo Manga Longa"})),b.formSetup()}}();