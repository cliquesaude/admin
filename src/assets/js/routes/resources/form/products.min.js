/*!
 * Copyright 2018 E-Com Club
 */
!function(){"use strict";var a=window.tabId,b=window.Tabs[a],c=function(){return b.data},d=window.i18n;b.continue=function(){var e=b.$form,f=randomObjectId(),g=0,h={material:{title:"Material"},pattern:{title:d({en_us:"Pattern",pt_br:"Modelo"})},size:{title:d({en_us:"Size",pt_br:"Tamanho"})},colors:{title:d({en_us:"Color",pt_br:"Cor"})}},i={};window.callApi("grids.json?fields=title,grid_id,options","GET",function(a,b){if(!a)for(var c=0;c<b.result.length;c++){var d=b.result[c];h[d.grid_id]=d}});var j=function(){var a=[];for(var b in h)h.hasOwnProperty(b)&&a.push(h[b].title);return a},k=function(a){var b=[];if(h[a]){var c=h[a].options;if(void 0!==c)for(var d=0;d<c.length;d++)b.push(c[d].text)}return b},l=function(a,b,c){a.typeahead({hint:!0,highlight:!0,minLength:1},{name:b,source:c})},m=$("#"+a+"-grids-list"),n='<div class="row gap-2"><div class="col-6"><div class="flexbox align-items-center"><div class="i-drag"></div><div class="input-group"><div class="input-group-prepend"><button class="btn btn-light remove-grid" type="button"><i class="fa fa-trash"></i></button></div><input class="form-control" type="text" name="grid" placeholder="'+d({en_us:"Size",pt_br:"Tamanho"})+'"></div></div></div><div class="col-6 hidden option-block"><div class="input-group"><input class="form-control" type="text" name="option" placeholder="GG"><div class="input-group-append"><button class="btn btn-light add-option" type="button"><i class="fa fa-plus"></i></button></div></div></div></div><ul class="hide-empty badges-list"></ul>',o=0,p=function(b){var c=m.find('input[name="grid"]').filter(function(){return""===$(this).val()});if(c.length)return void c.focus();var d=$("<li />",{html:n});m.append(d);var e,f=d.find('input[name="grid"]'),g=d.find(".option-block"),p=g.find('input[name="option"]'),r=!0,s=[];f.change(function(){var a=$(this).val().trim();if(""!==a){var b;e&&(b=e),e=normalizeString(a);for(var c in h)if(h.hasOwnProperty(c)&&normalizeString(h[c].title)===e){e=c;break}if(b!==e){s=k(e);for(var f=0;i.hasOwnProperty(e);)f++,e+=e+"_"+f;b?(i[e]=i[b],delete i[b]):i[e]=[],$(this).data("grid-id",e)}p.focus()}else p.val(""),o>1&&u(d)}).keyup(function(){""!==f.val()?r&&(g.fadeIn(),r=!1,1===o&&$("#"+a+"-add-option-header").fadeIn()):r||(g.fadeOut(),r=!0,1===o&&$("#"+a+"-add-option-header").fadeOut())}).keydown(function(a){switch(a.which){case 9:case 13:setTimeout(function(){f.trigger("change")},100)}}),p.click(function(){$(this).select()}).keydown(function(a){switch(a.which){case 9:setTimeout(function(){f.focus()},100);break;case 13:q(d,p,e)}}),l(f,"grids",substringMatcher(j())),l(p,"options",substringMatcher(function(){return s})),d.find(".remove-grid").click(function(){u(d)}),d.find(".add-option").click(function(){q(d,p,e)}),o++,1===o&&$("#"+a+"-grids-list-header").slideDown(),d.slideDown(400,function(){b||f.focus()})},q=function(a,b,c){var d=b.val().split(",");b.val("").focus();for(var e=0;e<d.length;e++){var f=d[e].trim();if(""!==f){if(c){var g,j=normalizeString(f);if(h[c]&&h[c].options)for(g=0;g<h[c].options.length;g++){var k=h[c].options[g];if(j===normalizeString(k.text)){j=k.option_id;break}}var l,m=i[c];for(g=0;g<m.length;g++)if(j===m[g]){l=!0;break}if(l)continue;m.push(j)}var n=$("<li />",{html:'<span class="i-drag white"></span>'+f+'<i class="fa fa-times"></i>'});a.find(".badges-list").append(n),n.find(".fa-times").click(function(){n.remove()}),a=$("<li />",{html:s}),a.find("label").text(f),r.append(a),a.slideDown(),t()}}},r=$("#"+a+"-variations-list"),s='<div class="flexbox align-items-center"><div><div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" checked ><label class="custom-control-label fw-400"> </label></div></div><button class="btn btn-light" type="button"><i class="fa fa-cog"></i><span class="i18n"> <span data-lang="en_us">Edit variation</span><span data-lang="pt_br">Editar variação</span></span></button></div>',t=function(){r.slideUp(400,function(){$(this).html("")});for(var a=0;a<i.length;a++);};$("#"+a+"-add-grid").click(function(){p()});var u=function(b){b.slideUp(400,function(){$(this).remove()}),0===--o&&$("#"+a+"-grids-list-header, #"+a+"-add-option-header").slideUp()},v=e.find('input[name="sku"]');v.click(function(){$(this).select()});var w=function(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZ",c=0;c<3;c++)a+=b.charAt(Math.floor(Math.random()*b.length));a+=randomInt(1e4,99999),v.val(a).trigger("change")};if($("#"+a+"-random-sku").click(w),!c().sku){var x=function(){w(),e.off("change",'input[name="name"]',x)};e.on("change",'input[name="name"]',x)}setTimeout(function(){var a=function(a,b){var c=function(a){return JSON.stringify({_id:a,name:b})},d=$("<option />",{text:b,selected:!0,value:c(objectIdPad(f,""+g))});a.append(d).selectpicker("refresh").trigger("change"),g++;var e=a.attr("name"),h=function(b,e){b||(d.val(c(e._id)),a.trigger("change"))};window.callApi(e+".json","POST",h,{name:b})};e.find('select[name="brands"],select[name="categories"]').each(function(){var b=$(this).prev(".dropdown-menu");if(b.length){var c=$(this);b.find(".bs-searchbox input").keydown(function(){var e=$(this);setTimeout(function(){var f=b.find(".dropdown-menu > .no-results");if(f.length){var g=$("<button />",{class:"btn btn-outline btn-secondary btn-sm btn-block",type:"button",html:'<i class="fa fa-plus"></i> '+d({en_us:"Add",pt_br:"Adicionar"}),click:function(){a(c,e.val())}});f.html(g)}},300)})}})},400),e.find('input[name="name"]').attr("placeholder",d({en_us:"Long Sleeve Polo Shirt",pt_br:"Camisa Polo Manga Longa"})),b.formSetup()}}();