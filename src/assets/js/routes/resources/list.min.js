!function(){"use strict";var n=window.tabId,a=window.Tabs[n],t=$("#t"+n+"-tab-normal");window.renderContentIds(t);var r=window.i18n;$("#t"+n+"-create").click(function(){window.location="/"+window.location.hash+"/new"});var e,l,o,c=a.slug;if("products"!==c&&((o=function(){e=a.data,l=e.result})(),l.length)){var s,d='<div class="custom-controls-stacked"><div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" /><label class="custom-control-label"> </label></div></div>',f=$("#t"+n+"-resource-list"),i=0,u=0;s=e.meta.hasOwnProperty("limit")?e.meta.limit:1e3;var h={},v={field:null,order:null},g=function(t){u=(t-1)*s,y()},p=function(t){var e=$("#t"+n+"-page"),i=parseInt(e.val(),10)+t;0<i&&(g(i),e.val(i))},w=function(){var t=$("#t"+n+"-prev"),e=$("#t"+n+"-next"),i=$("#t"+n+"-page");u<=0?t.attr("disabled",!0):t.removeAttr("disabled"),l.length<s?e.attr("disabled",!0):e.removeAttr("disabled"),u<=0&&l.length<s?i.attr("disabled",!0):i.removeAttr("disabled")};$("#t"+n+"-page").keydown(window.keyIsNumber).change(function(){g(parseInt($(this).val(),10))}),$("#t"+n+"-next").click(function(){p(1)}),$("#t"+n+"-prev").click(function(){p(-1)}),w(),$("#t"+n+"-page-size").change(function(){var t=parseInt($(this).val(),10);!isNaN(t)&&0<t&&(s=t,u=0,$("#t"+n+"-page").val("1")),y()});var m,k,b=!1,T=!1,j=!1,x=!1,y=function(){if(j)x||(x=!0);else{j=!0;var e=f.find(".loading");e.show();var t="limit="+s;0<u&&(t+="&offset="+u),v.field&&(t+="&sort=","desc"===v.order&&(t+="-"),t+=v.field);for(var i=0;i<I.length;i++){var n=I[i];h.hasOwnProperty(n)&&""!==h[n]&&(t+="&"+n+"="+h[n])}a.load(function(t){j=!1,e.fadeOut(),x&&(y(),x=!1),t||(o(),b=!0,f.jsGrid("loadData"),w())},t)}},D=[{align:"center",css:"data-list-check",filtering:!1,sorting:!1,headerTemplate:function(){var t=$(d);return t.find("input").addClass("checkbox-all").on("change",function(){var t=$(this).is(":checked")?":not(:checked)":":checked";f.find(".data-list-check input"+t).next().click()}),t},filterTemplate:function(){return'<div class="spinner-circle-shadow loading"></div>'},itemTemplate:function(t,e){var i=$(d),n=e._id;return i.find("input").on("change",function(){$(this).is(":checked")?L(n):G(n)}),i}}],I=[];for(k=0;k<e.meta.fields.length;k++)if("_id"!==(m=e.meta.fields[k]))for(var O=0;O<l.length;O++){switch(typeof l[O][m]){case"undefined":continue;case"string":I.push(m)}O=l.length}for(k=0;k<I.length;k++)m=I[k],D.push({name:m,type:"text"}),h[m]="";D.push({css:"data-list-control",filtering:!1,sorting:!1,title:"#",filterTemplate:function(){return $("<div />",{class:"data-list-control-buttons",html:[$("<i />",{class:"fa fa-search",click:function(){f.jsGrid("loadData")}}),$("<i />",{class:"fa fa-filter",click:function(){f.jsGrid("clearFilter")}})]})},itemTemplate:function(){return"#"+(u+ ++i)}}),f.jsGrid({autoload:!0,filtering:!0,sorting:!0,confirmDeleting:!1,pageLoading:!0,pageSize:s,rowClick:function(t){var e=t.event.originalEvent||t.event;if(e){var i=e.target;if(i)switch(i.nodeName){case"TD":for(var n=0;n<i.classList.length;n++)if("data-list-check"===i.classList[n])return void $(i).find("label").click();break;case"LABEL":case"INPUT":case"DIV":case"SELECT":return}}window.location="/"+window.location.hash+"/"+t.item._id},controller:{loadData:function(t){if(b)b=!1;else if(T)y();else{var e=!1;for(var i in h)h.hasOwnProperty(i)&&t[i]!==h[i]&&(h[i]=t[i],e||(e=!0));t.sortField?v.field===t.sortField&&v.order===t.sortOrder||(v.field=t.sortField,v.order=t.sortOrder,e||(e=!0)):v.field&&(v.field=v.order=null,e||(e=!0)),e&&y()}return{data:l,itemsCount:l.length}}},onRefreshing:function(){i=0},fields:D}),$.getJSON("json/resources/"+c+".json",function(t){for(var e=0;e<I.length;e++){var i=I[e],n=t[i];n&&n.label&&f.jsGrid("fieldOption",i,"title",r(n.label))}});var E=[],L=function(t){E.push(t)},G=function(e){E=$.grep(E,function(t){return t!==e})};$("#t"+n+"-delete-list").click(function(){var e=E.length;if(0<e){f.find(".loading").show();var i=0,n=function(){var t=E[i];window.callApi(c+"/"+t+".json","DELETE",function(){++i===e?(b=!(T=!0),f.jsGrid("loadData"),E=[],f.find(".checkbox-all:checked").next().click()):n()})};n()}})}}();