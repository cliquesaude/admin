/*!
 * Copyright 2018 E-Com Club
 */
!function(){"use strict";var a=window.tabId,b=$("#"+a+"-tab-normal");window.renderContentIds(b);var c=window.i18n;$("#"+a+"-create").click(function(){window.location="/"+window.location.hash+"/new"});var d,e,f=window.routeParams[0],g=function(){d=window.tabData[a],e=d.result};if(g(),e.length){var h,i='<div class="custom-controls-stacked"><div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" /><label class="custom-control-label"> </label></div></div>',j=$("#"+a+"-resource-list"),k=0;h=d.meta.hasOwnProperty("limit")?d.meta.limit:1e3;var l,m,n={},o={field:null,order:null},p=!1,q=!1,r=!1,s=function(){if(q)r||(r=!0);else{var b="limit="+h;o.field&&(b+="&sort=","desc"===o.order&&(b+="-"),b+=o.field);for(var c=0;c<m.length;c++){var d=m[c];n.hasOwnProperty(d)&&""!==n[d]&&(b+="&"+d+"="+n[d])}var e=function(a){a||(g(),p=!0,j.jsGrid("loadData")),q=!1,r&&(s(),r=!1)};window.tabLoad[a](e,b),q=!0}},t=[{align:"center",css:"data-list-check",filtering:!1,sorting:!1,headerTemplate:function(){var b=$(i);return b.find("input").attr("id",a+"-check-all").on("change",function(){var a=$(this).is(":checked")?":not(:checked)":":checked";j.find(".data-list-check input"+a).next().click()}),b},itemTemplate:function(a,b){var c=$(i),d=b._id;return c.find("input").on("change",function(){$(this).is(":checked")?w(d):x(d)}),c}}];if(d.meta.hasOwnProperty("fields"))m=d.meta.fields;else{m=[];for(l in e[0])m.push(l)}for(var u=0;u<m.length;u++)"_id"!==(l=m[u])&&(t.push({name:l,type:"text"}),n[l]="");t.push({css:"data-list-control",filtering:!1,sorting:!1,title:"#",filterTemplate:function(){return $("<div />",{class:"data-list-control-buttons",html:[$("<i />",{class:"fa fa-search",click:function(){j.jsGrid("loadData")}}),$("<i />",{class:"fa fa-filter",click:function(){j.jsGrid("clearFilter")}})]})},itemTemplate:function(){return"#"+(0+ ++k)}}),j.jsGrid({autoload:!0,filtering:!0,sorting:!0,confirmDeleting:!1,pageLoading:!0,pageSize:h,rowClick:function(a){var b=a.event.originalEvent||a.event;if(b){var c=b.target;if(c)switch(c.nodeName){case"TD":for(var d=0;d<c.classList.length;d++)if("data-list-check"===c.classList[d])return void $(c).find("label").click();break;case"LABEL":case"INPUT":case"DIV":case"SELECT":return}}window.location="/"+window.location.hash+"/"+a.item._id},controller:{loadData:function(a){if(p)p=!1;else{var b=!1;for(var c in n)n.hasOwnProperty(c)&&a[c]!==n[c]&&(n[c]=a[c],b||(b=!0));a.sortField?o.field===a.sortField&&o.order===a.sortOrder||(o.field=a.sortField,o.order=a.sortOrder,b||(b=!0)):o.field&&(o.field=o.order=null,b||(b=!0)),b&&s()}return{data:e,itemsCount:e.length}}},onRefreshing:function(){k=0},fields:t}),$.getJSON("json/resources/"+f+".json",function(a){for(var b=0;b<m.length;b++){var d=m[b],e=a[d];e&&e.label&&j.jsGrid("fieldOption",d,"title",c(e.label))}});var v=[],w=function(a){v.push(a)},x=function(a){v=$.grep(v,function(b){return b!==a})};$("#"+a+"-delete").click(function(){v.length&&(j.jsGrid("loadData"),v=[],$("#"+a+"-check-all:checked").next().click())})}}();