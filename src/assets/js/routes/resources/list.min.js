/*!
 * Copyright 2018 E-Com Club
 */
!function(){"use strict";var a=window.tabId,b=window.Tabs[a],c=$("#"+a+"-tab-normal");window.renderContentIds(c);var d=window.i18n;$("#"+a+"-create").click(function(){window.location="/"+window.location.hash+"/new"});var e,f,g=b.slug,h=function(){e=b.data,f=e.result};if(h(),f.length){var i,j='<div class="custom-controls-stacked"><div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" /><label class="custom-control-label"> </label></div></div>',k=$("#"+a+"-resource-list"),l=0,m=0;i=e.meta.hasOwnProperty("limit")?e.meta.limit:1e3;var n={},o={field:null,order:null},p=function(a){m=(a-1)*i,y()},q=function(b){var c=$("#"+a+"-page"),d=parseInt(c.val(),10)+b;d>0&&(p(d),c.val(d))},r=function(){var b=$("#"+a+"-prev"),c=$("#"+a+"-next"),d=$("#"+a+"-page");m<=0?b.attr("disabled",!0):b.removeAttr("disabled"),f.length<i?c.attr("disabled",!0):c.removeAttr("disabled"),m<=0&&f.length<i?d.attr("disabled",!0):d.removeAttr("disabled")};$("#"+a+"-page").keydown(window.keyIsNumber).change(function(){p(parseInt($(this).val(),10))}),$("#"+a+"-next").click(function(){q(1)}),$("#"+a+"-prev").click(function(){q(-1)}),r(),$("#"+a+"-page-size").change(function(){var b=parseInt($(this).val(),10);!isNaN(b)&&b>0&&(i=b,m=0,$("#"+a+"-page").val("1")),y()});var s,t,u=!1,v=!1,w=!1,x=!1,y=function(){if(w)x||(x=!0);else{w=!0;var a=k.find(".loading");a.show();var c="limit="+i;m>0&&(c+="&offset="+m),o.field&&(c+="&sort=","desc"===o.order&&(c+="-"),c+=o.field);for(var d=0;d<A.length;d++){var e=A[d];n.hasOwnProperty(e)&&""!==n[e]&&(c+="&"+e+"="+n[e])}var f=function(b){w=!1,a.fadeOut(),x&&(y(),x=!1),b||(h(),u=!0,k.jsGrid("loadData"),r())};b.load(f,c)}},z=[{align:"center",css:"data-list-check",filtering:!1,sorting:!1,headerTemplate:function(){var a=$(j);return a.find("input").addClass("checkbox-all").on("change",function(){var a=$(this).is(":checked")?":not(:checked)":":checked";k.find(".data-list-check input"+a).next().click()}),a},filterTemplate:function(){return'<div class="spinner-circle-shadow loading"></div>'},itemTemplate:function(a,b){var c=$(j),d=b._id;return c.find("input").on("change",function(){$(this).is(":checked")?D(d):E(d)}),c}}],A=[];for(t=0;t<e.meta.fields.length;t++)if("_id"!==(s=e.meta.fields[t]))for(var B=0;B<f.length;B++){switch(typeof f[B][s]){case"undefined":continue;case"string":A.push(s)}B=f.length}for(t=0;t<A.length;t++)s=A[t],z.push({name:s,type:"text"}),n[s]="";z.push({css:"data-list-control",filtering:!1,sorting:!1,title:"#",filterTemplate:function(){return $("<div />",{class:"data-list-control-buttons",html:[$("<i />",{class:"fa fa-search",click:function(){k.jsGrid("loadData")}}),$("<i />",{class:"fa fa-filter",click:function(){k.jsGrid("clearFilter")}})]})},itemTemplate:function(){return l++,"#"+(m+l)}}),k.jsGrid({autoload:!0,filtering:!0,sorting:!0,confirmDeleting:!1,pageLoading:!0,pageSize:i,rowClick:function(a){var b=a.event.originalEvent||a.event;if(b){var c=b.target;if(c)switch(c.nodeName){case"TD":for(var d=0;d<c.classList.length;d++)if("data-list-check"===c.classList[d])return void $(c).find("label").click();break;case"LABEL":case"INPUT":case"DIV":case"SELECT":return}}window.location="/"+window.location.hash+"/"+a.item._id},controller:{loadData:function(a){if(u)u=!1;else if(v)y();else{var b=!1;for(var c in n)n.hasOwnProperty(c)&&a[c]!==n[c]&&(n[c]=a[c],b||(b=!0));a.sortField?o.field===a.sortField&&o.order===a.sortOrder||(o.field=a.sortField,o.order=a.sortOrder,b||(b=!0)):o.field&&(o.field=o.order=null,b||(b=!0)),b&&y()}return{data:f,itemsCount:f.length}}},onRefreshing:function(){l=0},fields:z}),$.getJSON("json/resources/"+g+".json",function(a){for(var b=0;b<A.length;b++){var c=A[b],e=a[c];e&&e.label&&k.jsGrid("fieldOption",c,"title",d(e.label))}});var C=[],D=function(a){C.push(a)},E=function(a){C=$.grep(C,function(b){return b!==a})};$("#"+a+"-delete-list").click(function(){var a=C.length;if(a>0){k.find(".loading").show();var b=0,c=function(){var d=C[b];window.callApi(g+"/"+d+".json","DELETE",function(){b++,b===a?(v=!0,u=!1,k.jsGrid("loadData"),C=[],k.find(".checkbox-all:checked").next().click()):c()})};c()}})}}();