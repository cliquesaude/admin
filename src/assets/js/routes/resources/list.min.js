/*!
 * Copyright 2018 E-Com Club
 */
!function(){"use strict";var a=window.tabId,b=$("#"+a+"-tab-normal");window.renderContentIds(b);var c=window.i18n;$("#"+a+"-create").click(function(){window.location="/"+window.location.hash+"/new"});var d,e,f=window.routeParams[0],g=function(){d=window.Tabs[a].data,e=d.result};if(g(),e.length){var h,i='<div class="custom-controls-stacked"><div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" /><label class="custom-control-label"> </label></div></div>',j=$("#"+a+"-resource-list"),k=0,l=0;h=d.meta.hasOwnProperty("limit")?d.meta.limit:1e3;var m={},n={field:null,order:null},o=function(a){l=(a-1)*h,x()},p=function(b){var c=$("#"+a+"-page"),d=parseInt(c.val(),10)+b;d>0&&(o(d),c.val(d))},q=function(){var b=$("#"+a+"-prev"),c=$("#"+a+"-next"),d=$("#"+a+"-page");l<=0?b.attr("disabled",!0):b.removeAttr("disabled"),e.length<h?c.attr("disabled",!0):c.removeAttr("disabled"),l<=0&&e.length<h?d.attr("disabled",!0):d.removeAttr("disabled")};$("#"+a+"-page").keydown(window.keyIsNumber).change(function(){o(parseInt($(this).val(),10))}),$("#"+a+"-next").click(function(){p(1)}),$("#"+a+"-prev").click(function(){p(-1)}),q(),$("#"+a+"-page-size").change(function(){var b=parseInt($(this).val(),10);!isNaN(b)&&b>0&&(h=b,l=0,$("#"+a+"-page").val("1")),x()});var r,s,t=!1,u=!1,v=!1,w=!1,x=function(){if(v)w||(w=!0);else{v=!0;var b=j.find(".loading");b.show();var c="limit="+h;l>0&&(c+="&offset="+l),n.field&&(c+="&sort=","desc"===n.order&&(c+="-"),c+=n.field);for(var d=0;d<z.length;d++){var e=z[d];m.hasOwnProperty(e)&&""!==m[e]&&(c+="&"+e+"="+m[e])}var f=function(a){v=!1,b.fadeOut(),w&&(x(),w=!1),a||(g(),t=!0,j.jsGrid("loadData"),q())};window.Tabs[a].load(f,c)}},y=[{align:"center",css:"data-list-check",filtering:!1,sorting:!1,headerTemplate:function(){var a=$(i);return a.find("input").addClass("checkbox-all").on("change",function(){var a=$(this).is(":checked")?":not(:checked)":":checked";j.find(".data-list-check input"+a).next().click()}),a},filterTemplate:function(){return'<div class="spinner-circle-shadow loading"></div>'},itemTemplate:function(a,b){var c=$(i),d=b._id;return c.find("input").on("change",function(){$(this).is(":checked")?C(d):D(d)}),c}}],z=[];for(s=0;s<d.meta.fields.length;s++)if("_id"!==(r=d.meta.fields[s]))for(var A=0;A<e.length;A++){switch(typeof e[A][r]){case"undefined":continue;case"string":z.push(r)}A=e.length}for(s=0;s<z.length;s++)r=z[s],y.push({name:r,type:"text"}),m[r]="";y.push({css:"data-list-control",filtering:!1,sorting:!1,title:"#",filterTemplate:function(){return $("<div />",{class:"data-list-control-buttons",html:[$("<i />",{class:"fa fa-search",click:function(){j.jsGrid("loadData")}}),$("<i />",{class:"fa fa-filter",click:function(){j.jsGrid("clearFilter")}})]})},itemTemplate:function(){return k++,"#"+(l+k)}}),j.jsGrid({autoload:!0,filtering:!0,sorting:!0,confirmDeleting:!1,pageLoading:!0,pageSize:h,rowClick:function(a){var b=a.event.originalEvent||a.event;if(b){var c=b.target;if(c)switch(c.nodeName){case"TD":for(var d=0;d<c.classList.length;d++)if("data-list-check"===c.classList[d])return void $(c).find("label").click();break;case"LABEL":case"INPUT":case"DIV":case"SELECT":return}}window.location="/"+window.location.hash+"/"+a.item._id},controller:{loadData:function(a){if(t)t=!1;else if(u)x();else{var b=!1;for(var c in m)m.hasOwnProperty(c)&&a[c]!==m[c]&&(m[c]=a[c],b||(b=!0));a.sortField?n.field===a.sortField&&n.order===a.sortOrder||(n.field=a.sortField,n.order=a.sortOrder,b||(b=!0)):n.field&&(n.field=n.order=null,b||(b=!0)),b&&x()}return{data:e,itemsCount:e.length}}},onRefreshing:function(){k=0},fields:y}),$.getJSON("json/resources/"+f+".json",function(a){for(var b=0;b<z.length;b++){var d=z[b],e=a[d];e&&e.label&&j.jsGrid("fieldOption",d,"title",c(e.label))}});var B=[],C=function(a){B.push(a)},D=function(a){B=$.grep(B,function(b){return b!==a})};$("#"+a+"-delete-list").click(function(){var a=B.length;if(a>0){j.find(".loading").show();var b=0,c=function(){var d=B[b];window.callApi(f+"/"+d+".json","DELETE",function(){b++,b===a?(u=!0,t=!1,j.jsGrid("loadData"),B=[],j.find(".checkbox-all:checked").next().click()):c()})};c()}})}}();