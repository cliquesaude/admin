!function(){"use strict";var n=window.tabId,a=window.Tabs[n],t=$("#t"+n+"-tab-normal");window.renderContentIds(t);var r=window.i18n;$("#t"+n+"-create").click(function(){window.location="/"+window.location.hash+"/new"});var e,o,l,s=a.slug;if((l="products"!==s?function(){e=a.data,o=e.result}:function(){e=a.data,o=e.hasOwnProperty("hits")&&Array.isArray(e.hits.hits)?e.hits.hits.map(function(t){return Object.assign(t._source,{_id:t._id})}):[]})(),o.length){var c,d='<div class="custom-controls-stacked"><div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" /><label class="custom-control-label"> </label></div></div>',f=$("#t"+n+"-resource-list"),i=0,u=0;c=e.hasOwnProperty("meta")?e.meta.hasOwnProperty("limit")?e.meta.limit:1e3:60;var h={},v={field:null,order:null},g=function(t){u=(t-1)*c,x()},p=function(t){var e=$("#t"+n+"-page"),i=parseInt(e.val(),10)+t;0<i&&(g(i),e.val(i))},m=function(){var t=$("#t"+n+"-prev"),e=$("#t"+n+"-next"),i=$("#t"+n+"-page");u<=0?t.attr("disabled",!0):t.removeAttr("disabled"),o.length<c?e.attr("disabled",!0):e.removeAttr("disabled"),u<=0&&o.length<c?i.attr("disabled",!0):i.removeAttr("disabled")};$("#t"+n+"-page").keydown(keyIsNumber).change(function(){g(parseInt($(this).val(),10))}),$("#t"+n+"-next").click(function(){p(1)}),$("#t"+n+"-prev").click(function(){p(-1)}),m(),$("#t"+n+"-page-size").change(function(){var t=parseInt($(this).val(),10);!isNaN(t)&&0<t&&(c=t,u=0,$("#t"+n+"-page").val("1")),x()});var w,k,b,y=!1,O=!1,j=!1,T=!1,x=function(){if(j)T||(T=!0);else{j=!0;var e=f.find(".loading");e.show();var t="limit="+c;0<u&&(t+="&offset="+u),v.field&&(t+="&sort=","desc"===v.order&&(t+="-"),t+=v.field);for(var i=0;i<b.length;i++){var n=b[i];h.hasOwnProperty(n)&&""!==h[n]&&(t+="&"+n+"="+h[n])}a.load(function(t){j=!1,e.fadeOut(),T&&(x(),T=!1),t||(l(),y=!0,f.jsGrid("loadData"),m())},t)}},D=[{align:"center",css:"data-list-check",filtering:!1,sorting:!1,headerTemplate:function(){var t=$(d);return t.find("input").addClass("checkbox-all").on("change",function(){var t=$(this).is(":checked")?":not(:checked)":":checked";f.find(".data-list-check input"+t).next().click()}),t},filterTemplate:function(){return'<div class="spinner-circle-shadow loading"></div>'},itemTemplate:function(t,e){var i=$(d),n=e._id;return i.find("input").on("change",function(){$(this).is(":checked")?E(n):L(n)}),i}}];if("products"!==s){for(b=[],k=0;k<e.meta.fields.length;k++)if("_id"!==(w=e.meta.fields[k]))for(var I=0;I<o.length;I++){switch(typeof o[I][w]){case"undefined":continue;case"string":b.push(w)}I=o.length}}else b=["name","sku"];for(k=0;k<b.length;k++)w=b[k],D.push({name:w,type:"text"}),h[w]="";D.push({css:"data-list-control",filtering:!1,sorting:!1,title:"#",filterTemplate:function(){return $("<div />",{class:"data-list-control-buttons",html:[$("<i />",{class:"fa fa-search",click:function(){f.jsGrid("loadData")}}),$("<i />",{class:"fa fa-filter",click:function(){f.jsGrid("clearFilter")}})]})},itemTemplate:function(){return"#"+(u+ ++i)}}),f.jsGrid({autoload:!0,filtering:!0,sorting:!0,confirmDeleting:!1,pageLoading:!0,pageSize:c,rowClick:function(t){var e=t.event.originalEvent||t.event;if(e){var i=e.target;if(i)switch(i.nodeName){case"TD":for(var n=0;n<i.classList.length;n++)if("data-list-check"===i.classList[n])return void $(i).find("label").click();break;case"LABEL":case"INPUT":case"DIV":case"SELECT":return}}window.location="/"+window.location.hash+"/"+t.item._id},controller:{loadData:function(t){if(y)y=!1;else if(O)x();else{var e=!1;for(var i in h)h.hasOwnProperty(i)&&t[i]!==h[i]&&(h[i]=t[i],e||(e=!0));t.sortField?v.field===t.sortField&&v.order===t.sortOrder||(v.field=t.sortField,v.order=t.sortOrder,e||(e=!0)):v.field&&(v.field=v.order=null,e||(e=!0)),e&&x()}return{data:o,itemsCount:o.length}}},onRefreshing:function(){i=0},fields:D}),$.getJSON("json/resources/"+s+".json",function(t){for(var e=0;e<b.length;e++){var i=b[e],n=t[i];n&&n.label&&f.jsGrid("fieldOption",i,"title",r(n.label))}});var A=[],E=function(t){A.push(t)},L=function(e){A=$.grep(A,function(t){return t!==e})};$("#t"+n+"-delete-list").click(function(){var e=A.length;if(0<e){f.find(".loading").show();var i=0,n=function(){var t=A[i];window.callApi(s+"/"+t+".json","DELETE",function(){++i===e?(y=!(O=!0),f.jsGrid("loadData"),A=[],f.find(".checkbox-all:checked").next().click()):n()})};n()}})}}();