/*!
 * Copyright 2018 E-Com Club
 */
"use strict";app.config({autoload:!0,provide:["jsgrid","summernote","dropzone","typeahead","bloodhound","tagsinput","mask","selectpicker"],googleApiKey:"",googleAnalyticsId:"",smoothScroll:!1,saveState:!1,cacheBust:""}),function(){window.startMony=function(a,b,c){var d=!1,e=a.store_id,f=a.name,g=b.name.split(" ");g=g[0];var h=b.email,i=b._id,j=c.access_token,k=function(a){if(l(a),!1===d){$("#mony").html(""),d=!0;var b,c=new Date,e=c.getHours();e<13?b="Bom dia":e>=13&&e<18?b="Boa tarde":e>=18&&(b="Boa noite"),b+=" "+g+", em que posso te ajudar?",l(b)}},l=function(a,b){if(a&&""!==a){var c;c=b?"media media-chat media-chat-reverse":"media media-chat";var d='<div class="'+c+'"><div class="media-body"><p>'+a+"</p></div></div>";$("#mony").append(d).scrollTop(9999)}};window.Mony.init(e,f,null,g,null,h,i,null,j,i,k);var m=function(){var a=$("#dock-chat .publisher-input"),b=a.val();""!==b&&(l(b,!0),window.Mony.sendMessage(b),a.val(""))};$("#dock-chat .publisher-btn").click(m),$("#dock-chat .publisher-input").keypress(function(a){13===a.which&&m()})},window.appReady=function(){"pt_br"===window.lang&&($.getScript("../assets/vendor/jsgrid/i18n/jsgrid-pt-br.js",function(){jsGrid.locale("pt-br")}),$.getScript("../assets/vendor/summernote/lang/summernote-pt-BR.js",function(){$.summernote.options.lang="pt-BR"})),$("select").selectpicker({style:"btn-light",noneSelectedText:"--"})},window.keyIsNumber=function(a){if(13!==a.which&&8!==a.which){var b=a.which?a.which:a.keyCode;return b>95&&b<106&&(b-=48),!isNaN(String.fromCharCode(b))||(a.preventDefault(),!1)}},window.fixScrollbars=function(a){a.find(".scrollable").perfectScrollbar({wheelPropagation:!1,wheelSpeed:.5})}}(),app.ready(function(){var a,b={},c=function(){for(var a in b)b.hasOwnProperty(a)&&sessionStorage.setItem(a,b[a]);$(window).off("beforeunload"),location.reload()},d=function(a){a&&console.error(a),alert(f({en_us:"Fatal error, restarting in 3 seconds",pt_br:"Erro fatal, reiniciando em 3 segundos"})),setTimeout(function(){c()},3e3)},e=localStorage.getItem("lang");e&&/^[a-z]{2}(_[a-z]{2})?$/.test(e)||(e="pt_br"),window.lang=e,a=$('#langs-menu [data-lang="'+e+'"]'),a.addClass("active"),$("#current-lang").find("img").attr("src",a.find("img").attr("src")).next().text(e.split("_")[0].toUpperCase()),$("#langs-menu > a").click(function(){localStorage.setItem("lang",$(this).data("lang")),c()});var f=function(a){return a.hasOwnProperty(e)?a[e]:a.en_us};window.i18n=f,$("head").append('<style type="text/css">.i18n > [data-lang="'+e+'"]{display: inline;}</style>'),$(".after-i18n").fadeIn();var g={home:f({en_us:"Home",pt_br:"Início"}),resources:f({en_us:"Resources",pt_br:"Recursos"}),channels:f({en_us:"Sales channels",pt_br:"Canais de venda"}),media:f({en_us:"Media",pt_br:"Mídia"}),go_to_store:f({en_us:"Go to store",pt_br:"Ir à loja"}),themes:f({en_us:"Themes",pt_br:"Temas"}),settings:f({en_us:"Settings",pt_br:"Configurações"}),unknown_error:f({en_us:"Unknown error, please try again",pt_br:"Erro desconhecido, por favor tente novamente"})},h=function(){$("div.toast.reveal").removeClass("reveal")},i=function(a){var b;"object"==typeof a&&null!==a&&(a.hasOwnProperty("user_message")?b=a.user_message[e]:a.hasOwnProperty("message")&&(b=a.message)),void 0!==b?console.log("API Error Code: "+a.error_code):b=g.unknown_error,app.toast(b,{duration:7e3})};if("boolean"==typeof login&&!0===login){!function(a){var b,c=function(){b=["../assets/img/bg/coffee.jpg","../assets/img/bg/notebook.jpg","../assets/img/bg/numbers.jpg","../assets/img/bg/pens.jpg","../assets/img/bg/table.jpg","../assets/img/bg/writer.jpg"]};c();var d=function(){var d=new Image;d.onload=function(){var b=this;$(a).fadeOut(1e3,function(){$(this).css("background-image","url("+b.src+")").fadeIn()})};var e=Math.floor(Math.random()*(b.length-1));d.src=b[e],b.splice(e,1),0===b.length&&c()};d(),setInterval(d,6e4)}("#full-bg");var j=function(){var a=[{msg:{en_us:"Start where you are. Use what you have. Do what you can.",pt_br:"Comece de onde você está. Use o que você tiver. Faça o que você puder."},author:"Arthur Ashe"},{msg:{en_us:"Success is the sum of repeated small efforts day after day.",pt_br:"O sucesso é a soma de pequenos esforços repetidos dia após dia."},author:"Robert Collier"},{msg:{en_us:"All progress takes place outside the comfort zone.",pt_br:"Todo progresso acontece fora da zona de conforto."},author:"Michael John Bobak"},{msg:{en_us:"Courage is the resistance and mastery of fear, not its absence.",pt_br:"Coragem é a resistência e o domínio do medo, não a ausência dele."},author:"Mark Twain"},{msg:{en_us:"The only place where success comes before work is in the dictionary.",pt_br:"O único lugar em que o sucesso vem antes do trabalho é no dicionário."},author:"Vidal Sassoon"},{msg:{en_us:"To dream small and big requires the same work.",pt_br:"Sonhar grande e sonhar pequeno dá o mesmo trabalho."},author:"Jorge Paulo Lemann"},{msg:{en_us:"If you want to live and are curious, sleeping is not the most important thing.",pt_br:"Se você tem vontade de viver e curiosidade, dormir não é a coisa mais importante."},author:"Martha Stewart"},{msg:{en_us:"Do or do not, there is no try.",pt_br:"Faça ou não faça. Tentativas não existem."},author:"Yoda"},{msg:{en_us:"You don't need a company with 100 people to develop this idea.",pt_br:"Você não precisa de uma equipe de 100 pessoas para desenvolver uma ideia."},author:"Larry Page"},{msg:{en_us:"Do not let what you cannot do interfere with what you can do.",pt_br:"Não deixe o que você não pode fazer interferir no que você pode fazer."},author:"John Wooden"},{msg:{en_us:"Winners never quit and quitters never win.",pt_br:"Vencedores nunca desistem e quem desiste nunca vence."},author:"Vince Lombardi"}];return a[Math.floor(Math.random()*(a.length-1))]}();a=$("#quote-of-day"),a.find('[data-lang="en_us"]').text('"'+j.msg.en_us+'"'),a.find('[data-lang="pt_br"]').text('"'+j.msg.pt_br+'"'),a.find("cite").text(j.author);var k=localStorage.getItem("username");k&&$("#username").val(k),$("#username, #password").change(function(){""!==$(this).val()&&$(this).parent().addClass("do-float")}).trigger("change"),$("#login-form").submit(function(){if(!$(this).hasClass("ajax")){h();var a=$("#username").val(),b=md5($("#password").val());$("#remember").is(":checked")?localStorage.setItem("username",a):localStorage.removeItem("username");var c=$(this);c.addClass("ajax");var d=function(a,b,d){403!==a.status&&console.error(d),i(a.responseJSON),c.removeClass("ajax")};$.ajax({url:"https://api.e-com.plus/v1/_login.json?username",method:"POST",dataType:"json",contentType:"application/json; charset=UTF-8",headers:{"X-Store-ID":1},data:JSON.stringify({username:a,pass_md5_hash:b})}).done(function(b){console.log("Logged");var c=b.store_id;localStorage.setItem("store_id",c),$.ajax({url:"https://api.e-com.plus/v1/_authenticate.json",method:"POST",dataType:"json",contentType:"application/json; charset=UTF-8",headers:{"X-Store-ID":c},data:JSON.stringify({_id:b._id,api_key:b.api_key})}).done(function(b){sessionStorage.setItem("my_id",b.my_id),sessionStorage.setItem("access_token",b.access_token),sessionStorage.setItem("expires",b.expires),sessionStorage.setItem("username",a);var c=sessionStorage.getItem("go_to");c?sessionStorage.removeItem("go_to"):c="/",window.location=c}).fail(d)}).fail(d)}}),$(document).keypress(function(a){13===a.which&&$("#login-form").submit()})}else{var l=localStorage.getItem("store_id");if(b.my_id=b.access_token=null,l>0&&(b.my_id=sessionStorage.getItem("my_id"),b.access_token=sessionStorage.getItem("access_token")),!b.my_id||!b.access_token)return sessionStorage.setItem("go_to",window.location.href),void(window.location="/pages/login.html");$("#dashboard").fadeIn(),console.log("Hello #"+b.my_id+"\nStore #"+l),sessionStorage.removeItem("my_id"),sessionStorage.removeItem("access_token");var m={"X-Store-ID":l,"X-My-ID":b.my_id,"X-Access-Token":b.access_token},n=[],o=!1,p={},q=function(){if(n.length){var a=n.shift();setTimeout(function(){q()},500);var b=a.options;b.dataType="json",b.data&&(b.contentType="application/json; charset=UTF-8");var c=a.callback,d=$.ajax(b);d.done(function(a){"function"==typeof c?c(null,a):console.log(a)}),d.fail(function(a,b,d){var e=a.responseJSON;"function"==typeof c&&c(d,e),i(e),a.status>=500&&(console.log("API request with internal error response:"),console.log(a))})}else o=!1},r=function(a,b,c){b&&(a.data=JSON.stringify(b)),n.push({options:a,callback:c}),o||(o=!0,q())},s=function(a,b,c,d,e){var f=Date.now();p[f]={uri:a,method:b,callback:c,bodyObject:d};var g=b+" "+a;d&&(g+="\n"+JSON.stringify(d,null,2));var h=$("#modal-confirm-request");h.find("#api-request-control").data("request-id",f),h.find(".modal-body > p").text(e).next("pre").children("code").text(g),h.modal("show")},t=function(a,b,c,d){h();var e="https://api.e-com.plus/v1/"+a;switch(b){case"GET":case"POST":case"PATCH":case"PUT":break;case"DELETE":return void s(e,b,c,d,f({en_us:"You are going to delete a resource permanently, are you sure?",pt_br:"Você vai excluir um recurso permanentemente, tem certeza?"}));default:return void app.toast(f({en_us:"Invalid request method",pt_br:"Método de requisição inválido"}))}return"string"!=typeof a||""===a?void app.toast(f({en_us:"Invalid request endpoint",pt_br:"O endpoint da requisição é inválido"})):/^\$update\.json/.test(a)?void s(e,b,c,d,f({en_us:"You are going to do a bulk update, are you sure?",pt_br:"Você vai fazer uma atualização em massa, tem certeza?"})):void r({url:e,headers:m,method:b},d,c)},u=function(a,b,c,d){var e="https://e-com.plus/api/v1/"+a;"GET"===b&&(e+="?store_id="+l),r({url:e,method:b},d,c)},v="https://apx-storage.e-com.plus/"+l+"/api/v1/",w=function(a,b,c){var d,e=v;if(a){if(e+="s3/"+a+".json",d="POST",/^delete/.test(a))return void s(e,d,b,c,f({en_us:"You are going to delete files permanently, are you sure?",pt_br:"Você vai excluir arquivos permanentemente, tem certeza?"}))}else d="GET";r({url:e,headers:m,method:d},c,b)};window.callApi=t,window.callStorageApi=w,window.tabData={},window.tabCommit={},window.tabLoad={},window.loadContent=function(a,b){b.hide();var c=b.closest(".ajax-content");c.addClass("ajax"),$.ajax({url:a,dataType:"html",timeout:6e3}).done(function(a){b.html(a).fadeIn()}).fail(function(a,b,c){app.toast(f({en_us:a.status+" error, cannot load HTML content",pt_br:"Erro "+a.status+", não foi possível carregar o conteúdo HTML"}))}).always(function(){setTimeout(function(){c.removeClass("ajax")},400)})};var x=function(a,b){var c=a.closest("#api-request-control").data("request-id");if(c&&p.hasOwnProperty(c))if(b){var d=p[c],e={url:d.uri,headers:m,method:d.method};r(e,d.bodyObject,d.callback),delete p[c]}else{var f=p[c].callback;"function"==typeof f&&f(new Error("Request rejected"),null)}};$("#confirm-api-request").click(function(){x($(this),!0)}),$("#discard-api-request").click(function(){x($(this),!1)}),$(window).on("beforeunload",function(a){var b="Are you sure you want to leave?";return a.returnValue=b,b});var y,z,A={},B=null,C=!1,D=!1,E=function(a,b){if(!0!==C){var c=Date.now();B=c,A[B]={tabTitle:null,routesHistory:[],saveAction:!1,actionTitle:null},$("#route-content").append('<div id="app-tab-'+c+'"></div>');var d=$("#new-nav-item").clone().attr("id","app-nav-"+c);d.prependTo("#app-nav-tabs").toggle("slide"),d.children("a").attr("data-tab",c).click(F).click(),d.children(".close-tab").click(function(){G(c)}),b&&("#/new"===window.location.hash?K():window.location="/#/new")}"function"==typeof a&&a()},F=function(){if(!0!==C){B=parseInt($(this).attr("data-tab"),10);var a=function(){var a=$("#app-tab-"+B),b=a.children();b.hide(),a.addClass("app-current-tab"),b.fadeIn(100),I(A[B].tabTitle);var c=A[B].hash;void 0!==c&&(""===c&&(c="#/"),c!==window.location.hash&&(D=!0,window.location="/"+c))},b=$("#route-content > .app-current-tab");b.length?($("#app-nav-tabs .active").removeClass("active"),b.children().fadeOut(200,function(){b.removeClass("app-current-tab"),a()})):a(),$(this).addClass("active")}};$("#new-tab").click(function(){E(null,!0)});var G=function(a){if(!0!==C){var b=A[a];if(b){if(!0===b.unsavedChanges)return $("#app-nav-"+a+" > a").click(),y=null,void setTimeout(function(){$("#modal-unsaved").modal("show")},100);if(delete A[a],delete window.tabData[a],delete window.tabCommit[a],delete window.tabLoad[a],a===B){var c=Object.keys(A);0===c.length?E(null,!0):$("#app-nav-"+c[c.length-1]+" > a").click()}$("#app-tab-"+a).remove(),$("#app-nav-"+a).toggle("slide",function(){$(this).remove()})}}};$("#close-current-tab").click(function(){G(B)});var H=function(a,b){if(!b){if(!0===C)return;null!==B&&A[B].routesHistory.push(a)}C=!0,window.routeParams=[];for(var c=a.split("/"),d="routes/"+c[0]+".html",e=1;e<c.length;e++)""!==c[e]&&window.routeParams.push(c[e]);$("#router > .loading").show(),$.ajax({url:d,dataType:"html",timeout:1e4}).done(function(a){var c=$("#app-tab-"+B);window.tabId=B,window.elTab=c,b||(z=setTimeout(function(){H("408",!0)},1e4)),c.html(a)}).fail(function(a,b,c){if(404===a.status)window.e404();else{var d;switch(b){case"abort":d="400";break;case"timeout":d="504";break;default:console.error(c),d="500"}H(d,!0)}})};window.renderContentIds=function(a){var b=window.tabId;a||(a=window.elTab),a.find("[data-id]").each(function(){$(this).attr("id",b+"-"+$(this).data("id"))}),a.find("[data-id-href]").each(function(){$(this).attr("href","#"+b+"-"+$(this).data("id-href"))})},window.routeReady=function(a){C=!1,clearTimeout(z),z=null,void 0!==a&&$("#app-nav-"+window.tabId+" > a").text(a),$("#router > .loading").fadeOut(),window.elTab.children().fadeIn(),A[B].tabTitle=a,I(a)};var I=function(a){a||(a="Dashboard"),document.title=a+" · E-Com Plus"};window.e404=function(){H("404",!0)};var J=function(a){if("#/new"!==a)for(var b in A)if(A.hasOwnProperty(b)&&A[b].hash===a)return $("#app-nav-"+b+" > a").click(),Q(),!1;return!0},K=function(){var a=window.location.hash,b=a.slice(2);if(""===b)return void(window.location="/#/home");var c=A[B];if(D)D=!1;else{if(!J(a))return;if(!0===C&&L())return;if(!0===c.unsavedChanges&&L())return $("#modal-unsaved").modal("show"),void(y=b);H(b),c&&c.saveAction&&(c.saveAction=!1,c.saveCallback=c.actionTitle=null)}c&&(c.hash=a,Q())};$(window).on("hashchange",K);var L=function(){if(null!==B){var a=A[B].routesHistory;if(a.length>0)return D=!0,window.location="/#/"+a[a.length-1],!0}return!1};$(".previous-route").click(function(){var a="/#/";if(null!==B){var b=A[B].routesHistory;if(b.length-2>=0){b.pop();a+=b.pop()}}window.location=a}),$("#ignore-unsaved").click(function(){var a=A[B];a&&(a.unsavedChanges=!1,y?window.location="/#/"+y:G(B))});var M=function(){var a=A[B];a.unsavedChanges=!1,$("#action-save").attr("disabled",!0),a&&"function"==typeof a.saveCallback&&a.saveCallback(function(a){if(a===B){var b=$("#action-todo"),c=$("#action-done");b.fadeOut(200,function(){c.fadeIn(400,function(){setTimeout(function(){c.fadeOut(200,function(){b.fadeIn()})},800)})})}})};$("#action-save").click(M);var N=!1,O=function(){var a=A[B];if(a){if(null===a.actionTitle){var b=!0;if(window.elTab){var c=window.elTab.find("input.action-title");if(c.length){var d=function(b){a.actionTitle=b,$("#action-title").text(b)};c.change(function(){d($(this).val())}),d(""),b=!1}}!0===b&&$("#action-title").text("")}else $("#action-title").text(a.actionTitle);!1===a.unsavedChanges?$("#action-save").attr("disabled",!0):$("#action-save").removeAttr("disabled")}$("#topbar-action").fadeIn(),N=!0},P=function(){$("#topbar-action").fadeOut(),N=!1},Q=function(){var a=A[B];a&&(a.saveAction?O():N&&P())};window.setSaveAction=function(a,b){var c=A[B];if(c){if(a){c.unsavedChanges=!1;try{a.submit(M)}catch(a){console.error(a)}}c.saveAction=!0,c.saveCallback=b,O()}},window.triggerUnsaved=function(a){var b=A[a];b&&!0!==b.unsavedChanges&&(b.unsavedChanges=!0,$("#action-save").removeAttr("disabled"))},window.apiResources={products:{label:{en_us:"Products",pt_br:"Produtos"},icon:"tags"},orders:{label:{en_us:"Orders",pt_br:"Pedidos"},icon:"rocket"},brands:{label:{en_us:"Brands",pt_br:"Marcas"},icon:"trademark"},categories:{label:{en_us:"Categories",pt_br:"Categorias"},icon:"bookmark"},collections:{label:{en_us:"Collections",pt_br:"Coleções"},icon:"th-large"},grids:{label:{en_us:"Grids",pt_br:"Grades"},icon:"filter"},customers:{label:{en_us:"Customers",pt_br:"Clentes"},icon:"users"},carts:{label:{en_us:"Carts",pt_br:"Carrinhos"},icon:"shopping-cart"},authentications:{label:{en_us:"Users",pt_br:"Usuários"},icon:"id-card"}};!function(){var a="";for(var b in window.apiResources)if(window.apiResources.hasOwnProperty(b)){var c=window.apiResources[b];a+='<li class="menu-item"><a class="menu-link" href="/#/resources/'+b+'"><span class="icon fa fa-'+c.icon+'"></span><span class="title">'+f(c.label)+"</span></a></li>"}var d='<li class="menu-item"><a class="menu-link" href="/#/"><span class="icon fa fa-home"></span><span class="title">'+g.home+'</span></a></li><li class="menu-item"><a class="menu-link" href="javascript:;"><span class="icon fa fa-database"></span><span class="title">'+g.resources+'</span><span class="arrow"></span></a><ul class="menu-submenu">'+a+'</ul></li><li class="menu-item"><a class="menu-link" href="/#/apps"><span class="icon fa fa-puzzle-piece"></span><span class="title">Apps</span></a></li><li class="menu-item"><a class="menu-link" href="javascript:;" onclick="initStorageLib()" data-toggle="quickview" data-target="#qv-storage"><span class="icon fa fa-picture-o"></span><span class="title">'+g.media+'</span></a></li><li class="menu-item"><a class="menu-link" href="/#/settings"><span class="icon fa fa-cogs"></span><span class="title">'+g.settings+'</span></a></li><li class="menu-category" onclick="newChannel()">'+g.channels+'<i class="fa fa-plus-circle"></i></li>';$("#sidebar").append(d),$(".sidebar-toggler").is(":visible")&&sidebar.unfold()}();var R=[],S=function(){var a=$("#sidebar");a.find(".li-channel").remove();for(var b=0;b<R.length;b++){var c,d=R[b],e="/#/channels/"+d.id;c=d.domains.length?"https://"+d.domains[d.domains.length-1]:"#";var f=$("<li />",{class:"menu-item li-channel",html:'<a class="menu-link" href="javascript:;"><span class="icon fa fa-shopping-bag"></span><span class="title">'+d.title+'</span><span class="arrow"></span></a><ul class="menu-submenu"><li class="menu-item"><a class="menu-link" href="'+c+'" target="_blank"><span class="icon fa fa-eye"></span><span class="title">'+g.go_to_store+'</span></a></li><li class="menu-item"><a class="menu-link" href="'+e+'/themes"><span class="icon fa fa-paint-brush"></span><span class="title">'+g.themes+'</span></a></li><li class="menu-item"><a class="menu-link" href="'+e+'/settings"><span class="icon fa fa-wrench"></span><span class="title">'+g.settings+"</span></a></li></ul>"});a.append(f),f.slideDown("slow")}};window.newChannel=function(){R.length&&$("#channel-price").show(),$("#modal-channel").modal("show")},w(null,function(a,b){if(a)console.error(a);else if(b.host){var c="https://"+b.host+"/",d=null;window.setImagesCallback=function(a){d=a,e=[]};var e=[],g=function(a){"function"==typeof d&&(d(a,e),d=null)};$("#uploads-done").click(function(){g()});var h={zoom:{path:""},small:{size:100,path:"imgs/100px/"},normal:{size:400,path:"imgs/400px/"},big:{size:700,path:"imgs/700px/"}},j=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c].replace(/^.*(@.*)$/,"$1");for(var e in h)h.hasOwnProperty(e)&&b.push({Key:h[e].path+d})}var f={Delete:{Objects:b,Quiet:!0}},g=$("#storage-content").closest(".ajax-content");g.addClass("ajax"),w("deleteObjects",function(a,b){a||p(),g.removeClass("ajax")},f)},k=function(){var a=[];return $("#storage-content a.active").each(function(){var b=$(this).data("key");b&&a.push(b)}),a},l=function(){$("#storage-content a.active").removeClass("active")};$("#storage-select").click(function(){var a=k();if(a.length){for(var b=0;b<a.length;b++){var d=a[b].replace(/^.*(@.*)$/,"$1"),f={};for(var i in h)h.hasOwnProperty(i)&&(f[i]={url:c+h[i].path+d});e.push(f)}l()}g()}),$("#storage-delete").click(function(){var a=k();a.length?(j(a),l()):app.toast(f({en_us:"No image selected to delete",pt_br:"Nenhuma imagem selecionada para deletar"}))});var n,o;$("#load-storage").click(function(){p(o)});var p=function(a){var b=$("#storage-content"),d=b.closest(".ajax-content");a||b.html(""),d.addClass("ajax");var e=$("#load-storage");e.attr("disabled",!0);var f={Prefix:h.normal.path,MaxKeys:15};a&&(f.Marker=a),w("listObjects",function(a,f){if(!a){var g=f.Contents;if(Array.isArray(g)){var h="",i=g.length,j=0,k=function(){++j>=i&&(n=f.IsTruncated,n&&(e.removeAttr("disabled"),f.NextMarker&&(o=f.NextMarker)),d.removeClass("ajax"),b.append(h).find(".storage-object").fadeIn())};if(i>0)for(var l=0;l<i;l++)!function(){var a=g[l].Key,b=new Image;b.onload=function(){h+='<div class="masonry-item storage-object"><a href="javascript:;" onclick="$(this).toggleClass(\'active\')" data-key="'+a+'"><img src="'+this.src+'"></a></div>',k()},b.src=c+a}();else k()}}},f)},q=new Dropzone("#dropzone",{url:v+"upload.json",headers:m});q.on("complete",function(a){try{var b=JSON.parse(a.xhr.responseText)}catch(b){return i(),void console.error(new Error("Upload filed"),a)}if("success"!==a.status&&i(b),"function"==typeof d&&"image/"===a.type.substr(0,6)&&b.key&&"success"===a.status){var f,g={};for(f in h)h.hasOwnProperty(f)&&(g[f]={url:c+h[f].path+b.key});if(a.height&&a.width){var j=a.width,k=a.height;g.zoom.size=j+"x"+k;for(f in h)if(h.hasOwnProperty(f)){var l=h[f].size;l&&(g[f].size=j>k?l+"x"+Math.round(k*l/j):Math.round(j*l/k)+"x"+l)}}if(a.name){var m=a.name.replace(/\.[^.]+$/,"");for(f in g)g.hasOwnProperty(f)&&(g[f].alt=m)}e.push(g)}}),window.upload=function(){q.removeAllFiles(),$("#modal-uploads").modal("show")};var r=null;window.editImage=function(a){r=a,$("#modal-edit-image").modal("show").find("input").val("")},$("#edit-image").click(function(){if("function"==typeof r){var a={};$("#modal-edit-image input").each(function(){var b=$(this).val().trim();""!==b&&(a[$(this).attr("name")]=b)}),r(null,a)}}),$("#remove-image").click(function(){"function"==typeof r&&r(null,!1)}),window.initStorageLib=function(){void 0===o&&p()}}else console.log("Unexpected Storage API response:",b)});var T,U;t("stores/me.json","GET",function(a,b){a?d(a):(T=b,t("authentications/me.json","GET",function(a,b){a?d(a):(U=b,W(),V())}))});var V=function(){t("@me.json","GET",function(a,b){a||console.log(b)}),u("channels.json","GET",function(a,b){if(!a&&(R=b.result,R.length)){for(var c=0;c<R.length;c++)R[c].domains=[];u("domains.json","GET",function(a,b){if(!a){for(var c=b.result,d=0;d<c.length;d++){for(var e=c[d].id,f=0;f<R.length;f++)c[d].channel_id===R[f].id&&R[f].domains.push(e);window.shopDomain||-1!==e.indexOf(".e-com.plus")&&d!==c.length-1||(window.shopDomain=e)}S()}})}})},W=function(){E(function(){K()}),$(".qv-close").click(function(){quickview.close($(this).closest(".quickview"))}),$(".logout").click(function(){$("#modal-logout").modal("show")}),$("#logout").click(function(){$(window).off("beforeunload"),window.location="/"}),$("#new-channel").click(function(){var a={};$("#modal-channel").find("input,select").each(function(){var b=$(this).attr("name"),c=$(this).val();b&&c&&(a[b]=c)}),t("@channels.json","POST",function(a){a||(V(),$("#modal-channel input").val(""))},a)});var a=!1,c=function(a){J(a)&&E(function(){window.location.hash===a?K():window.location="/"+a})};$(document).mousedown(function(b){return(b.ctrlKey||2===b.which)&&(a=!0),!0}),$(document).click(function(b){if(!0===a){a=!1;var d,e;for(d=b.target;d&&void 0===e;)switch(d.nodeName){case"A":e=d;break;case"DIV":case"P":case"BUTTON":case"BODY":d=!1;break;default:d=d.parentElement}if(void 0===e||"string"!=typeof e.href)return!0;switch(e.href){case"javascript:;":case"#":return b.preventDefault(),!0}var f=e.href.split(window.location.origin+"/#");if(2===f.length){b.preventDefault();var g="#"+f[1];"#"!==g&&c(g)}}});var d={},e={},f=function(a){switch(Object.keys(d).length){case 1:switch(a.keyCode){case 37:$("#app-nav-"+B).prev().children("a").click();break;case 39:var b=$("#app-nav-"+B).next();"new-nav-item"!==b.attr("id")&&b.children("a").click();break;case 84:E(null,!0);break;case 87:G(B);break;case 83:a.preventDefault(),$("#app-search").focus();break;case 81:$(".topbar img.avatar").click();break;case 77:dock.toggleMinimize("#dock-chat")}break;case 2:var c,e=function(){switch(a.keyCode){case 80:return"/#/resources/products";case 79:return"/#/resources/orders";case 73:return"/#/resources/categories";case 85:return"/#/resources/customers";case 89:return"/#/resources/brands";case 84:return"/#/resources/carts";case 82:return"/#/resources/grids";case 69:return"/#/resources/collections";case 87:return"/#/resources/authentications"}};if(0===d[71])switch(a.keyCode){case 72:window.location="/#/";break;case 83:window.location="/#/settings";break;case 65:window.location="/#/apps";break;default:c=e(),c&&(window.location=c)}else 0===d[65]&&(c=e())&&(window.location=c+"/new");break;case 3:0===d[66]&&1===d[89]&&2===d[69]&&$("#logout").click()}};$(document).keydown(function(a){return"BODY"!==a.target.nodeName?27!==a.keyCode||void $(a.target).blur():!0===e[a.keyCode]||void(void 0!==d[a.keyCode]?(f(a),e[a.keyCode]=!0):d[a.keyCode]=Object.keys(d).length)}).keyup(function(a){if("BODY"!==a.target.nodeName)return!0;!0!==e[a.keyCode]?void 0!==d[a.keyCode]&&f(a):delete e[a.keyCode],delete d[a.keyCode]}),window.startMony(T,U,b)};window.appReady()}});