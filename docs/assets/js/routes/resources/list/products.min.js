!function(){"use strict";var w,k,a=window.tabId,e=window.Tabs[a],M=$("#products-list-container"),q=M.find("#products-list-results"),C=M.find("#load-products"),P=window.i18n,s=function(){w=e.data,k=w.hits.hits.map(function(a){return Object.assign({_id:a._id},a._source)})};if(s(),k.length){var n="",O=[],j=0,A=0,r={},t=function(a){var t;""!==n?(t={bool:{must:{multi_match:{query:n,fields:["name","keywords"]}}}},O.length&&(t.bool.filter=O)):O.length&&(t={bool:{filter:O}});M.addClass("ajax"),a?j++:j=0,e.load(function(){s(),o()},t,r,j)};C.click(function(){t(!0)});var S=$("<div>"),N=$("<form>",{action:"javascript:;",submit:t,html:['<div class="form-group"><input class="form-control text-monospace" placeholder="SKU" type="text" name="sku" data-filter="term"/></div>',S,'<label class="i18n"><span data-lang="en_us">Price</span><span data-lang="pt_br">Preço</span></label><div class="flexbox"><div class="form-group"><input class="form-control" type="tel" name="price" data-opt="gte" data-filter="range" data-is-number="true" data-money="true"/><small class="form-text i18n"><span data-lang="en_us">Minimun</span><span data-lang="pt_br">Mínimo</span></small></div><div class="form-group"><input class="form-control" type="tel" name="price" data-opt="lte" data-filter="range" data-is-number="true" data-money="true"/><small class="form-text i18n"><span data-lang="en_us">Maximum</span><span data-lang="pt_br">Máximo</span></small></div></div><label class="i18n"><span data-lang="en_us">Quantity</span><span data-lang="pt_br">Quantidade</span></label><div class="flexbox"><div class="form-group"><input class="form-control" type="number" name="quantity" data-opt="gte" data-filter="range" data-is-number="true"/><small class="form-text i18n"><span data-lang="en_us">Minimun</span><span data-lang="pt_br">Mínimo</span></small></div><div class="form-group"><input class="form-control" type="number" name="quantity" data-opt="lte" data-filter="range" data-is-number="true"/><small class="form-text i18n"><span data-lang="en_us">Maximum</span><span data-lang="pt_br">Máximo</span></small></div></div>']}),i=function(){O=[],t()};M.find("#clear-products-filters").click(i);var l=$("#qvx");l.find("#qvx-title").text(P({en_us:"Filter products",pt_br:"Filtrar produtos"})),l.find("#qvx-body").html(N),l.find("#qvx-footer").html([$("<button>",{class:"btn btn-success mr-2",click:function(){t(),quickview.close(l)},html:P({en_us:"Apply filters",pt_br:"Aplicar filtros"})}),$("<button>",{class:"btn btn-warning",click:function(){i(),quickview.close(l)},html:P({en_us:"Clear",pt_br:"Limpar"})})]);var o=function(){for(var a=[],t=k.length,e=w.hits.total,s=w.aggregations,n=0;n<t;n++){var r,i,l=k[n],o="/"+window.location.hash+"/"+l._id;r=l.price?formatMoney(l.price,l.currency_id):P({en_us:"No price",pt_br:"Sem preço"}),i=l.quantity?l.quantity+" un":"∞";var c="";if(l.pictures&&l.pictures.length){var d=l.pictures[0],u=d.small;if(!u)for(var p in d)if(d.hasOwnProperty(p)&&"_id"!==p){u=d[p];break}u&&(c='<img src="'+u.url+'">')}var m=$("<div />",{class:"col",html:'<a href="'+o+'" class="item-picture">'+c+'</a><div class="item-info"><a href="'+o+'">'+l.name+'</a><div class="item-price">'+r+'</div><div class="item-qnt">'+i+'</div></div><div class="custom-controls-stacked"><div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input"><label class="custom-control-label text-monospace">'+l.sku+"</label></div></div>"});a.push(m)}0===j?0<e?q.html($("<div>",{class:"row row-products",html:a})):q.html(""):q.children(".row").append(a),t<e?(C.removeAttr("disabled"),0===j&&(A=t)):C.attr("disabled",!0);var f=M.find("#products-list-info");0===e?f.hide():(f.show(),f.find("#products-list-count").text(A*j+t),f.find("#products-list-total").text(e),f.find("#products-avg-price").text(formatMoney(s.avg_price.value)+" ("+formatMoney(s.min_price.value)+" - "+formatMoney(s.max_price.value)+")")),S.html("");var v={"brands.name":{label:P({en_us:"Brands",pt_br:"Marcas"})},"categories.name":{label:P({en_us:"Categories",pt_br:"Categorias"})},status:{label:"Status"}};for(var b in v)if(v.hasOwnProperty(b)&&s.hasOwnProperty(b)){var h=v[b],g=s[b].buckets;if(g.length){var _="";for(n=0;n<g.length;n++){var x=g[n].key;_+='<option value="'+x+'" data-subtext="('+g[n].doc_count+')">'+x+"</option>"}var y=$("<select />",{multiple:!0,"data-live-search":!0,class:"form-control",name:b,html:_});S.prepend($("<div />",{class:"form-group selectpicker-default",html:y})),y.selectpicker({style:"btn-light",noneSelectedText:h.label,windowPadding:70})}}M.removeClass("ajax"),handleInputs(N,function(a,t){var e=a.attr("name"),s=a.data("opt"),n=a.data("filter")||"terms",r=a.val();Array.isArray(r)?r.length||(r=null):(r=a.data("is-number")?stringToNumber(r):"number"===a.attr("type")?parseFloat(r):r.trim(),(isNaN(r)||""===r)&&(r=null));for(var i=0;i<O.length;i++){var l=O[i][n];if(l&&l.hasOwnProperty(e))return void(s?null!==r?l[e][s]=r:(delete l[e][s],Object.keys(l[e]).length||O.splice(i,1)):null!==r?l[e]=r:O.splice(i,1))}if(null!==r){var o={};o[n]={},s?(o[n][e]={},o[n][e][s]=r):o[n][e]=r,O.push(o)}})},c=M.find("#search-products"),d=c.find("input");d.attr("placeholder",P({en_us:"Polo Shirt",pt_br:"Camisa Polo"})),c.submit(function(){n=d.val().trim(),t()}),M.find("#order-products a").click(function(){var a;$(this).hasClass("active")?(a="asc",$(this).find("i").removeClass("fa-caret-down text-warning").addClass("fa-caret-up text-info")):(a="desc",$(this).parent().children(".active").removeClass("active").find("i").remove(),$(this).addClass("active").append($("<i>",{class:"ml-1 fa fa-caret-down text-warning"}))),(r={})[$(this).data("field")]={order:a},t()}),o()}}();