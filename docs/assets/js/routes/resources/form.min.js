!function(){"use strict";var a=window.tabId,i=window.Tabs[a],e=$("#t"+a+"-tab-normal"),n=e.children("form");window.renderContentIds(e);var o,r,y=window.i18n,s=function(e,t,i,a){n.addClass("ajax");window.callApi(e,t,function(e,t){n.removeClass("ajax"),e||i(t)},a)},x=i.commit,k=function(){return i.data},l=i.slug,m=i.resourceId,c=!!n.find('[name="slug"]').length;if(m){r=l+"/"+m+".json";var t=function(){s(r,"DELETE",function(e){window.location="/#/resources/"+l})};if($("#t"+a+"-delete").click(t),e.find(".delete-resource").click(t).fadeIn(),$("#t"+a+"-duplicate").click(function(){s(l+".json","POST",function(e){window.location="/#/resources/"+l+"/"+e._id},k())}),$("#t"+a+"-new").click(function(){window.location="/#/resources/"+l+"/new"}),c){var f=function(e){if(window.shopDomain&&k().slug){var t="https://"+window.shopDomain+"/"+k().slug;e&&(t=e+encodeURIComponent(t)),newTabLink(t)}else app.toast(y({en_us:"No link to share",pt_br:"Nenhum link para compartilhar"}))};$("#t"+a+"-view").click(function(){f()}),$("#t"+a+"-facebook").click(function(){f("https://www.facebook.com/sharer.php?u=")}),$("#t"+a+"-whatsapp").click(function(){var e;e=$(window).width()<480?"api":"web",f("https://"+e+".whatsapp.com/send?text=")})}else $("#t"+a+"-view, #t"+a+"-facebook, #t"+a+"-whatsapp").remove();if($("#t"+a+"-nav .edit-btn").fadeIn(),i.state.pagination){var u=$("#t"+a+"-pagination-next"),d=$("#t"+a+"-pagination-prev");0===i.state.page&&d.addClass("disabled"),i.pagination=i.state.pagination,d.click(function(){i.pagination(!0)}),u.click(function(){i.pagination()}).closest(".pagination-arrows").fadeIn()}}else o=!0,r=l+".json";var h=0,g=0,v=function(){if(h<=++g){var p,m=function(e,t){if(""===(t=t.trim()))return null;if(e.data("json")){var i;try{i=JSON.parse(t)}catch(e){i=!1}return i}return t},e=function(e,t){if(p){var i=e.attr("name");if(i&&""!==i){var a,n=k(),o=i.split(".");if(o.length){var r,s=e.data("object-id");for(a=0;""!==o[a]&&(0<a&&(n=n[i]),r?(i=parseInt(o[a],10),r=!1):(/\[\]$/.test(o[a])&&(r=!0,o[a]=o[a].slice(0,-2)),i=o[a])),a!==o.length-1;){if(n.hasOwnProperty(i)||(n[i]=s?[{_id:s}]:r?[]:{}),s){for(var l=0;l<n[i].length;l++)if(n[i][l]._id===s){o.splice(a+1,0,l),s=null;break}s&&(n[i].push({_id:s}),o.splice(a+1,0,n[i].length-1),s=null)}a++}}var c=function(){if(Array.isArray(n)?n.splice(i,1):delete n[i],o.length){n=k();for(var e=0;e<o.length-1;e++){var t=o[e];Object.keys(n[t]).length?n=n[t]:delete n[t]}}};if(t)n[i]=e.is(":checked");else{var f,u=e.data("value")||e.val();if(e.hasClass("colorpicker")&&!/^#[a-f0-9]{6}$/.test(u)&&""!==u)return void setTimeout(function(){e.trigger("change")},200);if("string"==typeof u)if((f=e.data("is-number")?stringToNumber(u):"number"===e.attr("type")?parseFloat(u):m(e,u))||0===f)if(e.data("object-assign"))Object.assign(n[i],f);else{if(Array.isArray(n))for(;n.length<i;)n.push(f);n[i]=f}else{if(null!==f&&!isNaN(f))return;c()}else if(Array.isArray(u)){var d=[];for(a=0;a<u.length;a++)(f=m(e,u[a]))&&d.push(f);if(d.length)n[i]=d;else{if(!n.hasOwnProperty(i))return;c()}}}x(k(),!0)}}};i.inputToData=e,handleInputs(n,e);var t=function(){o||setupInputValues(n,k()),n.find(".tagsinput").tagsinput(),n.find("select:not(.tagsinput)").selectpicker({style:"btn-light",noneSelectedText:"--",windowPadding:70});var b=n.find(".html-editor");if(b.length){var i=!1;b.summernote({toolbar:[["style",["style"]],["font",["bold","italic","underline","strikethrough","clear"]],["color",["color"]],["insert",["picture","link","video","hr","table"]],["paragraph",["ul","ol","paragraph"]],["misc",["codeview","help"]]],height:300,dialogsFade:!0,callbacks:{onChange:function(e){i=!0;var t=e.trim();"<div>"!==t.substring(0,5)&&b.summernote("code","<div><br></div>"+t)},onBlur:function(){i&&(b.trigger("change"),i=!1)}}})}n.find('input[type="file"]').each(function(){var e,d,p,m,h,g;e=(d=$(this).attr("multiple"))?((m=$(this).data("max"))||(m=50),y({en_us:"Select images",pt_br:"Selecionar imagens"})):(m=1,y({en_us:"Select image",pt_br:"Selecionar imagem"})),h=$(this).attr("name"),p=$(this).data("thumbnails");var t=function(e,a,t){if(!e){var i=k();if(i.hasOwnProperty(h)){var n=function(e){if(e){if(!p){var t=e.url;e={zoom:e},-1!==t.indexOf("digitaloceanspaces.com/@")?e.normal={url:t.replace(/^((https?:)?\/\/[^/]+\/)(.*)$/,"$1imgs/400px/$3")}:e.normal=e.zoom}a.push(e)}};if(d)for(g=0;g<i[h].length;g++){n(i[h][g])}else a.length||n(i[h])}if(!a.length)return;if(a.length>m&&(d?(p&&a.splice(m,a.length-m),app.toast(y({en_us:"A maximum of "+m+" images will be selected",pt_br:"No máximo "+m+" imagens serão selecionadas"}))):app.toast(y({en_us:"Only one image will be selected",pt_br:"Apenas uma imagem será selecionada"}))),!v){w.addClass("ajax");var o=w.children(".images-list");o.html("");var r=0,s=0,c=[],f=function(){++s===r&&(o.prepend(c),w.removeClass("ajax"),1<s&&window.Sortable.create(o[0],{onUpdate:function(e){var t=k(),i=t[h].splice(e.oldIndex,1)[0];i&&(t[h].splice(e.newIndex,0,i),x(t,!0))}}))};if(!t){if(d){i[h]=[];var l=randomObjectId();for(g=0;g<a.length;g++){var u;(u=p?a[g]:a[g].zoom)._id||(u._id=objectIdPad(l,""+g)),i[h].push(u)}}else i[h]=p?a[0]:a[0].zoom;x(i,!0)}}for(g=0;g<a.length&&g<m;g++)!function(){var i,l;if(i=v?a[g].zoom.url:(r++,a[g].normal.url),v||c.push($("<span />",{html:'<img src="'+i+'"><i class="fa fa-cog"></i>',click:(l=h,function(e){e.stopPropagation();var o=$(this),r=k(),s=r[l];Array.isArray(s)&&(s=s[o.index()]),window.editImage(function(e,t){if(!e){if(!1===t)Array.isArray(r[l])?r[l].splice(o.index(),1):delete r[l],o.toggle("slide",function(){$(this).remove()});else if("object"==typeof s)for(var i in t){var a=t[i];if(a)if(s.hasOwnProperty("zoom"))if("size"!==i)for(var n in s)s.hasOwnProperty(n)&&(s[n][i]=a);else s.zoom[i]=a;else s[i]=a}x(r,!0)}},s.zoom||s)})})),v)b.summernote("insertImage","/assets/img/util/loading.gif",function(e){var t=new Image;t.onload=function(){e.attr("src",i),b.summernote("insertText"," ")},t.src=i,e.css("max-width","100%")});else{var e=new Image;e.onload=function(){f(),clearTimeout(t)};var t=setTimeout(f,5e3);e.src=i}}()}},v=$(this).hasClass("note-image-input"),w=$("<div/>",{class:"select-image scrollable scrollable-x ajax-content",html:'<div class="ajax-overlay"><div class="spinner-circle-material"></div></div><div class="images-list"></div><p><i class="fa fa-picture-o"></i>&nbsp; '+e+"</p>",click:function(){var e;e=v?(n.find(".note-editor .modal.show").modal("hide"),400):100,window.setImagesCallback(t),setTimeout(function(){window.upload()},e)}});$(this).replaceWith(w),o||t(null,[],!0)}),setTimeout(function(){window.setSaveAction(n,function(i){setTimeout(function(){var e,t=k();o?(e="POST",t.name&&!t.slug&&c&&(t.slug=clearAccents(t.name.toLowerCase(),"-").replace(/[^a-z0-9-_./]/g,""))):e="PUT";s(r,e,function(e){"function"==typeof i&&i(a),o&&e._id&&(window.location="/#/resources/"+l+"/"+e._id)},t)},200)})},200),p=!0,fixScrollbars(n),n.removeClass("ajax ajax-cards")};i.wait?(i.$form=n,i.formSetup=function(){setTimeout(t,100)},"function"==typeof i.continue&&i.continue()):setTimeout(t,200)}},p=n.find("select").filter(function(){return $(this).data("fill")});p.length?p.each(function(){var e=$(this).data("fill");h++;var f=[$(this)];n.find('select[data-fill-same="'+$(this).attr("name")+'"]').each(function(){f.push($(this))});var u,d,t=e+".json?sort="+($(this).data("sort")||"name"),p=$(this).data("properties");p&&(d=!0,t+="&fields="+p,(u=$(this).data("subtext-property"))&&(t+=","+u)),window.callApi(t,"GET",function(e,t){if(!e){var i=t.result;if(i)for(var a=0;a<i.length;a++){var n=i[a];if(n._id!==m){var o,r;if(d)r=p?getProperties(n,p):n,o=JSON.stringify(r);else o=n._id;var s={value:o,text:cutString(n.name,42,"...")};if(u){var l=getFromDotNotation(n,u);l&&(s["data-subtext"]=cutString(l,45,"..."))}for(var c=0;c<f.length;c++)$("<option />",s).appendTo(f[c])}}}v()})}):v()}();