!function(){"use strict";var a=window.tabId,p=window.Tabs[a],d=p.commit,h=function(){return p.data};p.continue=function(){p.formSetup();var t=p.$form,l=t.find("#t"+a+"-cart-items"),o=t.find("#t"+a+"-cart-items-count"),s=t.find("#t"+a+"-cart-subtotal"),f=function(){setTimeout(function(){var t=h(),i=t.items,n=0,e=0;if(i)for(var a=0;a<i.length;a++){var r=i[a];n+=r.quantity,e+=r[void 0!==r.final_price?"final_price":"price"]*r.quantity}o.text(n),s.text(formatMoney(e)),t.subtotal!==e&&(t.subtotal=e,d(t,!0))},150)},i=function(i,t){var a=i._id,n=function(t){return $("<a>",{href:"/#/resources/products/"+i.product_id,html:t})},e="",r=i.picture;if(r){var o=r.small||r[Object.keys(r)[0]];o&&(e=n('<img src="'+o.url+'">')).addClass("cart-item-picture")}var s=$("<input>",{class:"form-control w-80px",name:"items.quantity",type:"number",min:0,max:9999999,step:"any"}).change(f),c=$("<input>",{class:"form-control w-120px",name:"items."+(void 0!==i.final_price?"final_price":"price"),type:"tel","data-is-number":"true","data-money":"true"}).change(f),m=$("<i>",{class:"py-10 pr-10 remove fa fa-trash"}).click(function(){for(var t=h(),i=t.items,n=0;n<i.length;n++){var e=i[n];if(e&&e._id===a){i.splice(n,1),d(t,!0),f();break}}u.remove()}),u=$("<tr>",{html:[$("<th>",{scope:"row",html:[m,t+1]}),$("<td>",{html:n(i.sku||"")}),$("<td>",{html:s}),$("<td>",{html:c}),$("<td>",{html:$("<input>",{class:"form-control",name:"items.name",type:"text"})}),$("<td>",{html:e})]});l.append(u),u.find("input").data("object-id",a),handleInputs(u,p.inputToData),setupInputValues(u,i,"items.")},n=h().items;if(n&&n.length){for(var e=0;e<n.length;e++)i(n[e],e);f()}t.find("#t"+a+"-new-cart-item").typeahead({hint:!0,highlight:!0,minLength:3},{name:"items",source:function(t,i,o){var n="items.json?q="+encodeURIComponent("name:"+t+" OR sku:"+t+" OR variation.sku:"+t);window.callSearchApi(n,"GET",function(t,i){if(!t&&i.hits)for(var n=0;n<i.hits.hits.length;n++){var e=i.hits.hits[n]._source;if(o([e.name+" ("+e.sku+")"]),e.variations)for(var a=0;a<e.variations.length;a++){var r=e.variations[n];o(["  / "+r.name+" ("+r.sku+")"])}}})}})}}();