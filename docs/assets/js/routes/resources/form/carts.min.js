!function(){"use strict";var a=window.tabId,l=window.Tabs[a],_=l.commit,y=function(){return l.data};l.continue=function(){l.formSetup();var t=l.$form,f=t.find("#t"+a+"-cart-items"),c=t.find("#t"+a+"-cart-items-count"),s=t.find("#t"+a+"-cart-subtotal"),d=function(){setTimeout(function(){var t=y(),i=t.items,e=0,r=0;if(i)for(var a=0;a<i.length;a++){var n=i[a];e+=n.quantity,r+=n[void 0!==n.final_price?"final_price":"price"]*n.quantity}c.text(e),s.text(formatMoney(r)),t.subtotal!==r&&(t.subtotal=r,_(t,!0))},150)},p=function(i,t){var a=i._id,e=function(t){return $("<a>",{href:"/#/resources/products/"+i.product_id,html:t})},r="",n=i.picture;if(n){var c=n.small||n[Object.keys(n)[0]];c&&(r=e('<img src="'+c.url+'">')).addClass("cart-item-picture")}var s=$("<input>",{class:"form-control w-80px",name:"items.quantity",type:"number",min:0,max:9999999,step:"any"}).change(d),o=$("<input>",{class:"form-control w-120px",name:"items."+(void 0!==i.final_price?"final_price":"price"),type:"tel","data-is-number":"true","data-money":"true"}).change(d),u=$("<i>",{class:"py-10 pr-10 remove fa fa-trash"}).click(function(){for(var t=y(),i=t.items,e=0;e<i.length;e++){var r=i[e];if(r&&r._id===a){i.splice(e,1),_(t,!0),d();break}}m.remove()}),m=$("<tr>",{html:[$("<th>",{scope:"row",html:[u,t+1]}),$("<td>",{html:e(i.sku||"")}),$("<td>",{html:s}),$("<td>",{html:o}),$("<td>",{html:$("<input>",{class:"form-control",name:"items.name",type:"text"})}),$("<td>",{html:r})]});f.append(m),m.find("input").data("object-id",a),handleInputs(m,l.inputToData),setupInputValues(m,i,"items.")},i=y().items;if(i&&i.length){for(var e=0;e<i.length;e++)p(i[e],e);d()}var v=[],h=t.find("#t"+a+"-new-cart-item");h.typeahead({hint:!0,highlight:!0,minLength:3},{name:"items",source:function(t,i,c){t=t.replace(/([()])/g,"\\$1").replace(/(^|\s)(AND|OR|\/)(\s|$)/g," ");var e="items.json?q="+encodeURIComponent("sku:"+t+" OR name:"+t);window.callSearchApi(e,"GET",function(t,i){if(!t&&i.hits){v=i.hits.hits;for(var e=0;e<v.length;e++){var r=v[e]._source;if(c([r.name+" ("+r.sku+")"]),r.variations)for(var a=0;a<r.variations.length;a++){var n=r.variations[a];c(["  / "+n.name+" ("+n.sku+")"])}}}})}});var r=function(){var t=h.val().match(/^.*\s\((.*)\)$/);if(t){var i=t[1];if(i&&v.length){for(var e,r,a=0;a<v.length;a++){var n=v[a],c=n._source;if(c.sku!==i){if(c.variations)for(var s=0;s<c.variations.length;s++)if(c.variations[s].sku===i){r=c.variations[s];break}if(!r)continue}(e=c)._id=n._id;break}if(e){var o={_id:randomObjectId(),sku:i,product_id:e._id};if(e.currency_symbol&&(o.currency_symbol=e.currency_symbol),e.currency_id&&(o.currency_id=e.currency_id),r){if(r.picture_id&&e.pictures)for(a=0;a<e.pictures.length;a++){var u=e.pictures[a];if(u._id===r.picture_id){r.pictures=[u];break}}o.variation_id=r._id,e=Object.assign(e,r)}o.price=e.price,o.quantity=e.quantity,o.name=e.name,e.pictures&&e.pictures.length&&(o.picture=e.pictures[0],delete o.picture._id);var m=y(),f=m.items;f||(f=m.items=[]);var l=f.length;f[l]=o,_(m),p(o,l),d()}}}};t.find("#t"+a+"-add-cart-item").click(r),h.keydown(function(t){switch(t.which){case 13:t.preventDefault(),r()}})}}();