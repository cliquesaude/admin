!function(){"use strict";var a=window.tabId,p=window.Tabs[a],d=p.commit,h=function(){return p.data};p.continue=function(){p.formSetup();var t=p.$form,l=t.find("#t"+a+"-cart-items"),o=t.find("#t"+a+"-cart-items-count"),s=t.find("#t"+a+"-cart-subtotal"),f=function(){setTimeout(function(){var t=h(),i=t.items,e=0,n=0;if(i)for(var a=0;a<i.length;a++){var r=i[a];e+=r.quantity,n+=r[void 0!==r.final_price?"final_price":"price"]*r.quantity}o.text(e),s.text(formatMoney(n)),t.subtotal!==n&&(t.subtotal=n,d(t,!0))},150)},i=function(i,t){var a=i._id,e=function(t){return $("<a>",{href:"/#/resources/products/"+i.product_id,html:t})},n="",r=i.picture;if(r){var o=r.small||r[Object.keys(r)[0]];o&&(n=e('<img src="'+o.url+'">')).addClass("cart-item-picture")}var s=$("<input>",{class:"form-control w-80px",name:"items.quantity",type:"number",min:0,max:9999999,step:"any"}).change(f),c=$("<input>",{class:"form-control w-120px",name:"items."+(void 0!==i.final_price?"final_price":"price"),type:"tel","data-is-number":"true","data-money":"true"}).change(f),m=$("<i>",{class:"py-10 pr-10 remove fa fa-trash"}).click(function(){for(var t=h(),i=t.items,e=0;e<i.length;e++){var n=i[e];if(n&&n._id===a){i.splice(e,1),d(t,!0),f();break}}u.remove()}),u=$("<tr>",{html:[$("<th>",{scope:"row",html:[m,t+1]}),$("<td>",{html:e(i.sku||"")}),$("<td>",{html:s}),$("<td>",{html:c}),$("<td>",{html:$("<input>",{class:"form-control",name:"items.name",type:"text"})}),$("<td>",{html:n})]});l.append(u),u.find("input").data("object-id",a),handleInputs(u,p.inputToData),setupInputValues(u,i,"items.")},e=h().items;if(e&&e.length){for(var n=0;n<e.length;n++)i(e[n],n);f()}t.find("#t"+a+"-new-cart-item").typeahead({hint:!0,highlight:!0,minLength:3},{name:"items",source:function(t,i,o){t=t.replace(/[()/]/g,"").replace(/(AND|OR)/g," ");var e="items.json?q="+encodeURIComponent("name:"+t+" OR sku:"+t+" OR variation.sku:"+t);window.callSearchApi(e,"GET",function(t,i){if(!t&&i.hits)for(var e=0;e<i.hits.hits.length;e++){var n=i.hits.hits[e]._source;if(o([n.name+" ("+n.sku+")"]),n.variations)for(var a=0;a<n.variations.length;a++){var r=n.variations[e];o(["  / "+r.name+" ("+r.sku+")"])}}})}})}}();