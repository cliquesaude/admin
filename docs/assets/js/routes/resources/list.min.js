!function(){"use strict";var i=window.tabId,r=window.Tabs[i],e=$("#t"+i+"-tab-normal");window.renderContentIds(e);var o=window.i18n;$("#t"+i+"-create").click(function(){window.location="/"+window.location.hash+"/new"});var t,a,n=r.slug,l=function(){t=r.data,a=t.result.map(function(e){var t={};for(var n in e){var i=e[n];if("object"!=typeof i||null===i||Array.isArray(i))t[n]=i;else for(var r in i)i.hasOwnProperty(r)&&(t[n+"/"+r]=i[r])}return t})};if(l(),a.length){var s,c='<div class="custom-controls-stacked"><div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" /><label class="custom-control-label"> </label></div></div>',d=$("#t"+i+"-resource-list"),f=0,u=0;s=t.meta.hasOwnProperty("limit")?t.meta.limit:1e3;var h={},v={field:null,order:null},p=function(e){u=(e-1)*s,j()},g=function(e){var t=$("#t"+i+"-page"),n=parseInt(t.val(),10)+e;0<n&&(p(n),t.val(n))},m=function(){var e=$("#t"+i+"-prev"),t=$("#t"+i+"-next"),n=$("#t"+i+"-page");u<=0?e.attr("disabled",!0):e.removeAttr("disabled"),a.length<s?t.attr("disabled",!0):t.removeAttr("disabled"),u<=0&&a.length<s?n.attr("disabled",!0):n.removeAttr("disabled")};$("#t"+i+"-page").keydown(window.keyIsNumber).change(function(){p(parseInt($(this).val(),10))}),$("#t"+i+"-next").click(function(){g(1)}),$("#t"+i+"-prev").click(function(){g(-1)}),m(),$("#t"+i+"-page-size").change(function(){var e=parseInt($(this).val(),10);!isNaN(e)&&0<e&&(s=e,u=0,$("#t"+i+"-page").val("1")),j()});var w,k,b=!1,y=!1,I=!1,T=!1,j=function(){if(I)T||(T=!0);else{I=!0;var t=d.find(".loading");t.show();var e="limit="+s;0<u&&(e+="&offset="+u),v.field&&(e+="&sort=","desc"===v.order&&(e+="-"),e+=v.field);for(var n=0;n<O.length;n++){var i=O[n];h.hasOwnProperty(i)&&""!==h[i]&&(e+="&"+i+"="+h[i])}r.load(function(e){I=!1,t.fadeOut(),T&&(j(),T=!1),e||(l(),b=!0,d.jsGrid("loadData"),m())},e)}},x=[{align:"center",css:"data-list-check",filtering:!1,sorting:!1,headerTemplate:function(){var e=$(c);return e.find("input").addClass("checkbox-all").on("change",function(){var e=$(this).is(":checked")?":not(:checked)":":checked";return setTimeout(function(){d.find(".data-list-check input"+e).next().click()},50),!0}),e},filterTemplate:function(){return'<div class="spinner-circle-shadow loading"></div>'},itemTemplate:function(e,t){var n=$(c),i=t._id;return n.find("input").on("change",function(){$(this).is(":checked")?G(i):L(i)}),n}}],O=[];for(k=0;k<a.length;k++)for(w in a[k])if("_id"!==w)switch(typeof a[k][w]){case"undefined":continue;case"string":case"number":for(var A=!1,D=0;D<O.length;D++)if(O[D]===w){A=!0;break}A||(O.push(w),x.push({name:w,type:"text"}),h[w]="")}x.push({css:"data-list-control",filtering:!1,sorting:!1,title:"#",filterTemplate:function(){return $("<div />",{class:"data-list-control-buttons",html:[$("<i />",{class:"fa fa-search",click:function(){d.jsGrid("loadData")}}),$("<i />",{class:"fa fa-filter",click:function(){d.jsGrid("clearFilter")}})]})},itemTemplate:function(){return"#"+(u+ ++f)}}),d.jsGrid({autoload:!0,filtering:!0,sorting:!0,confirmDeleting:!1,pageLoading:!0,pageSize:s,rowClick:function(e){var t=e.event.originalEvent||e.event;if(t){var n=t.target;if(n)switch(n.nodeName){case"TD":for(var i=0;i<n.classList.length;i++)if("data-list-check"===n.classList[i])return void $(n).find("label").click();break;case"LABEL":case"INPUT":case"DIV":case"SELECT":return}}window.location="/"+window.location.hash+"/"+e.item._id},controller:{loadData:function(e){if(b)b=!1;else if(y)j();else{var t=!1;for(var n in h)h.hasOwnProperty(n)&&e[n]!==h[n]&&(h[n]=e[n],t||(t=!0));e.sortField?v.field===e.sortField&&v.order===e.sortOrder||(v.field=e.sortField,v.order=e.sortOrder,t||(t=!0)):v.field&&(v.field=v.order=null,t||(t=!0)),t&&j()}return{data:a,itemsCount:a.length}}},onRefreshing:function(){f=0},fields:x}),$.getJSON("json/resources/"+n+".json",function(e){for(var t=0;t<O.length;t++){var n,i=O[t],r=i.split("/");if(1===r.length)n=e[i];else{n=e[r[0]];for(var a=1;a<r.length;a++){if(!n||!n.properties){n=null;break}n=n.properties[r[a]]}}n&&n.label&&d.jsGrid("fieldOption",i,"title",o(n.label))}});var G=function(e){r.selectedItems.push(e)},L=function(t){r.selectedItems=$.grep(r.selectedItems,function(e){return e!==t})};r.deleteItems=function(){return d.find(".loading").show(),function(){b=!(y=!0),d.jsGrid("loadData"),d.find(".checkbox-all:checked").next().click()}}}setTimeout(function(){window.unsetSaveAction()},200)}();