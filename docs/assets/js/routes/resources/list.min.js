!function(){"use strict";var i=window.tabId,g=window.Tabs[i],c=$("#t"+i+"-tab-normal");window.renderContentIds(c);var w=window.i18n,d="/"+window.location.hash+"/";$("#t"+i+"-create").click(function(){window.location=d+"new"});var t,f,u=g.slug,s=function(){t=g.data,f=t.result.map(function(t,e){var n={_index:e};for(var i in t){var a=t[i];if("object"!=typeof a||null===a||Array.isArray(a))n[i]=a;else for(var r in a)a.hasOwnProperty(r)&&(n[i+"/"+r]=a[r])}return n})};if(s(),f.length){var p,b='<div class="custom-controls-stacked"><div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" /><label class="custom-control-label"> </label></div></div>',h=$("#t"+i+"-resource-list"),k=0,y=0;p=t.meta.hasOwnProperty("limit")?t.meta.limit:1e3;var v={},x="updated_at",T="desc",_={field:x,order:T},a=function(t){("number"!=typeof t||isNaN(t)||t<1)&&(t=1),y=(t-1)*p,O()},e=function(t){var e=$("#t"+i+"-page"),n=parseInt(e.val(),10)+t;0<n&&(a(n),e.val(n))},I=function(){var t=$("#t"+i+"-prev"),e=$("#t"+i+"-next"),n=$("#t"+i+"-page");y<=0?t.attr("disabled",!0):t.removeAttr("disabled"),f.length<p?e.attr("disabled",!0):e.removeAttr("disabled"),y<=0&&f.length<p?n.attr("disabled",!0):n.removeAttr("disabled"),n.val(Math.ceil(y/p)+1)};$("#t"+i+"-page").keydown(window.keyIsNumber).change(function(){a(parseInt($(this).val(),10))}),$("#t"+i+"-next").click(function(){e(1)}),$("#t"+i+"-prev").click(function(){e(-1)}),I(),g.pagination=function(t){e(t?-1:1)},$("#t"+i+"-page-size").change(function(){var t=parseInt($(this).val(),10);!isNaN(t)&&0<t&&(p=t,y=0,$("#t"+i+"-page").val("1")),O()});var j=!1,A=!1,o=!1,m=!1,O=function(e){if(o)m||(m=!0);else{var n;o=!0,e||(n=h.find(".loading")).show();var t="limit="+p;0<y&&(t+="&offset="+y),_.field&&(t+="&sort=","desc"===_.order&&(t+="-"),t+=_.field.replace("/","."));for(var i=0;i<P.length;i++){var a=P[i],r=v[a];if(r&&""!==r){var l=a.replace("/",".");/([0-9]+)?>>([0-9]+)?/.test(r)?(""!==(r=r.split(">>"))[0]&&(t+="&"+l+">="+r[0]),""!==r[1]&&(t+="&"+l+"<="+r[1])):t+="&"+l+"="+r}}g.load(function(t){o=!1,"function"!=typeof e?(n.fadeOut(),m&&(O(),m=!1),t||(s(),j=!0,h.jsGrid("loadData"),I())):e()},t)}},D=!1,N=$("<i>",{click:function(){h.jsGrid("loadData")}}),S=function(){N.attr("class","fa fa-"+(D?"pencil text-primary":"search")),h.find(".data-list-range").attr("disabled",D)};S(),g.editItemsCallback=function(){return h.find(".loading").show(),function(){j=!(A=!0),h.jsGrid("loadData"),h.find(".checkbox-all:checked").next().click(),D=!1,S()}};var C=[],P=[],G=[];$.getJSON("json/misc/config_lists.json",function(e){var m=e[u];if(m){C.push({align:"center",css:"data-list-check",filtering:!1,sorting:!1,headerTemplate:function(){var t=$(b);return t.find("input").addClass("checkbox-all").on("change",function(){var t=$(this).is(":checked")?":not(:checked)":":checked",e=h.find(".loading");return e.show(),setTimeout(function(){h.find(".data-list-check input"+t).next().click(),e.hide()},50),!0}),t},filterTemplate:function(){var t=$("<div>",{class:"data-list-control-buttons",html:[N,$("<i>",{class:"fa fa-filter",click:function(){h.jsGrid("clearFilter")}})]});return $("<div>",{class:"data-list-control",html:[t,'<div class="spinner-circle-shadow loading"></div>']})},itemTemplate:function(t,e){var n=$(b),i=e._id,a=n.find("input");-1<$.inArray(i,g.selectedItems)&&a.prop("checked",!0),k++,n.attr("title","#"+(y+k)),a.on("change",function(){var e,t;$(this).is(":checked")?(t=i,g.selectedItems.push(t),D||(D=!0,S())):(e=i,g.selectedItems=$.grep(g.selectedItems,function(t){return t!==e}),!g.selectedItems.length&&D&&(D=!1,S()))});var r=m._hidden_fields;if(!r)return n;for(var l=[],s=0;s<r.length;s++){var o=r[s];if(e[o])if(Array.isArray(e[o])){if(m[o]&&m[o].template)for(var c=0;c<e[o].length;c++){var d=e[o][c],f=m[o].template;for(var u in d)if(d.hasOwnProperty(u)){var p=new RegExp("{{"+u+"}}","g");f=f.replace(p,d[u])}f=f.replace(/{{\S+}}/g," - "),l.push($("<div>",{html:f}))}}else{var h=e[o];"money"===m[o].type&&(h=formatMoney(h)),l.push($("<span>",{text:w(m[o].label)+": "+h}))}}var v=$("<div>",{class:"data-list-accordion",html:l});return $("<div>",{class:"data-list-extend",html:[n,$("<i>",{class:"ti-angle-down"}).one("click",function(){$(this).closest("tr").append(v)}).click(function(t){t.stopPropagation();var e=$(this);v.slideToggle(400,function(){e.attr("class",$(this).is(":visible")?"ti-angle-up":"ti-angle-down")})})]})}});for(var t=function(t,e){t.filterTemplate=function(){var n=$("<input>",{type:"hidden"});this.filterControl=n;var t={class:"data-list-range",keydown:function(t){switch(t.which){case 13:$(this).trigger("change")}},change:function(){var t=stringToNumber(i.val())||"",e=stringToNumber(a.val())||"";n.val(""!==t||""!==e?t+">>"+e:""),h.jsGrid("loadData")},type:"tel",placeholder:w({en_us:"min",pt_br:"mín"})},i=$("<input>",t),a=$("<input>",Object.assign(t,{placeholder:w({en_us:"max",pt_br:"máx"})}));return e&&(i.inputMoney(!0),a.inputMoney(!0)),$("<div>",{html:[i,a]})}},n=0;n<m._fields.length;n++){var i=m._fields[n],a=m[i]||{};P.push(i);var l={name:i,type:"text",title:w(a.label||e._labels[i])};if(0===n)l.itemTemplate=function(t,e){if(t&&e)return $("<a>",{text:t,href:d+e._id})};else switch(a.type){case"link":l.itemTemplate=function(t){if(t){var e=t.length;return $("<a>",{text:32<e?t.substr(0,12)+"..."+t.substr(e-20):t,href:t,target:"_blank"})}};break;case"bold":!function(t,i,a){var r=function(t){var e=a[t]||{},n=i+" text-"+(e.class||"muted");return $("<span>",{class:n,text:w(e.text)||t})};l.itemTemplate=function(t){if(t)return r(t)},l.filterTemplate=function(){var t=[$("<option>",{text:"--",value:"",selected:!0})];for(var e in a)a.hasOwnProperty(e)&&t.push($("<option>",{text:e,value:e,"data-content":r(e).prop("outerHTML")}));var n=$("<select>",{class:"hidden",html:t,change:function(){h.jsGrid("loadData")}});return this.filterControl=n,setTimeout(function(){n.selectpicker({noneSelectedText:"--",windowPadding:70,container:c})},200),n}}(0,a.type,a.enum);break;case"money":l.itemTemplate=function(t){return formatMoney(t)},t(l,!0)}a.width&&(l.css="data-list-fixed",l.width=a.width),a.cutString&&(l.itemTemplate=function(e){return function(t){return t.length<=e?t:'<abbr title="'+t+'">'+cutString(t,e)+"</abbr>"}}(a.cutString)),a.range?t(l):G.push(i),C.push(l),v[i]=""}}var r=function(t,n,i){return{name:t,type:"text",title:w(e._labels[t]),filtering:!1,css:"data-list-fixed",width:i?110:90,itemTemplate:function(t){var e=t?formatDate(t,n):t;return i?$("<span>",{text:e,class:"fw-400"}):e}}},s=r("created_at"),o=r("updated_at",["day","month","hour","minute"],!0);C.push(s,o),h.jsGrid({autoload:!0,filtering:!0,sorting:!0,confirmDeleting:!1,pageLoading:!0,pageSize:p,rowClick:function(t){var e=t.event.originalEvent||t.event;if(e){var n=e.target;if(n)switch(n.nodeName){case"TD":for(var i=0;i<n.classList.length;i++)if("data-list-check"===n.classList[i])return void $(n).find("label").click();break;case"LABEL":case"INPUT":case"DIV":case"SELECT":case"A":return}}var a=t.item;window.location=d+a._id,p=1,g.state.page=y+a._index,g.state.pagination=function(t){-1<(y=g.state.page+(t?-1:1))&&(g.state.page=y,O(function(){var t=g.data.result;t&&t.length&&(window.location=d+t[0]._id)}))}},controller:{loadData:function(t){if(j)j=!1;else if(A)O(),A=!1;else{var e,n=!1;if(D){for(var i={},a=0;a<G.length;a++)if(""!==t[e=G[a]]){var r=e.split("/"),l=r[0];if(1<r.length){i[l]={};for(var s=1,o=i[l];s<r.length-1;)o[r[s]]={},s++;o[r[s]]=t[e]}else i[l]=t[e]}g.editItems(i)}else for(e in v)v.hasOwnProperty(e)&&t[e]!==v[e]&&(v[e]=t[e],n||(n=!0));t.sortField||(t.sortField=x,t.sortOrder=T),_.field===t.sortField&&_.order===t.sortOrder||(_.field=t.sortField,_.order=t.sortOrder,n||(n=!0)),n&&(y=0,I(),O())}return{data:f,itemsCount:f.length}}},onRefreshing:function(){k=0},fields:C})})}setTimeout(function(){window.unsetSaveAction()},200)}();