!function(){"use strict";var i=window.tabId,m=window.Tabs[i],c=$("#t"+i+"-tab-normal");window.renderContentIds(c);var w=window.i18n,d="/"+window.location.hash+"/";$("#t"+i+"-create").click(function(){window.location=d+"new"});var t,u,f=m.slug,l=function(){t=m.data,u=t.result.map(function(t,e){var a={_index:e};for(var i in t){var n=t[i];if("object"!=typeof n||null===n||Array.isArray(n))a[i]=n;else for(var r in n)n.hasOwnProperty(r)&&(a[i+"/"+r]=n[r])}return a})};if(l(),u.length){var h,b='<div class="custom-controls-stacked"><div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" /><label class="custom-control-label"> </label></div></div>',p=$("#t"+i+"-resource-list"),k=0,y=0;h=t.meta.hasOwnProperty("limit")?t.meta.limit:1e3;var v={},x="updated_at",T="desc",_={field:x,order:T},n=function(t){("number"!=typeof t||isNaN(t)||t<1)&&(t=1),y=(t-1)*h,S()},e=function(t){var e=$("#t"+i+"-page"),a=parseInt(e.val(),10)+t;0<a&&(n(a),e.val(a))},I=function(){var t=$("#t"+i+"-prev"),e=$("#t"+i+"-next"),a=$("#t"+i+"-page");y<=0?t.attr("disabled",!0):t.removeAttr("disabled"),u.length<h?e.attr("disabled",!0):e.removeAttr("disabled"),y<=0&&u.length<h?a.attr("disabled",!0):a.removeAttr("disabled"),a.val(Math.ceil(y/h)+1)};$("#t"+i+"-page").keydown(window.keyIsNumber).change(function(){n(parseInt($(this).val(),10))}),$("#t"+i+"-next").click(function(){e(1)}),$("#t"+i+"-prev").click(function(){e(-1)}),I(),m.pagination=function(t){e(t?-1:1)},$("#t"+i+"-page-size").change(function(){var t=parseInt($(this).val(),10);!isNaN(t)&&0<t&&(h=t,y=0,$("#t"+i+"-page").val("1")),S()});var O=!1,j=!1,o=!1,g=!1,S=function(e){if(o)g||(g=!0);else{var a;o=!0,e||(a=p.find(".loading")).show();var t="limit="+h;0<y&&(t+="&offset="+y),_.field&&(t+="&sort=","desc"===_.order&&(t+="-"),t+=_.field.replace("/","."));for(var i=0;i<P.length;i++){var n=P[i],r=v[n];if(r&&""!==r){var s=n.replace("/",".");/([0-9]+)?>>([0-9]+)?/.test(r)?(""!==(r=r.split(">>"))[0]&&(t+="&"+s+">="+r[0]),""!==r[1]&&(t+="&"+s+"<="+r[1])):t+="&"+s+"="+r}}m.load(function(t){o=!1,"function"!=typeof e?(a.fadeOut(),g&&(S(),g=!1),t||(l(),O=!0,p.jsGrid("loadData"),I())):e()},t)}},A=!1,D=$("<i>",{click:function(){p.jsGrid("loadData")}}),N=function(){D.attr("class","fa fa-"+(A?"pencil text-primary":"search")),p.find(".data-list-range").attr("disabled",A)};N(),m.editItemsCallback=function(){return p.find(".loading").show(),function(){O=!(j=!0),p.jsGrid(A?"clearFilter":"loadData"),p.find(".checkbox-all:checked").next().click(),A=!1,N()}};var C=[],P=[],E=[];$.getJSON("json/misc/config_lists.json",function(n){var g=n[f];if(g){C.push({align:"center",css:"data-list-check",filtering:!1,sorting:!1,headerTemplate:function(){var t=$(b);return t.find("input").addClass("checkbox-all").on("change",function(){var t=$(this).is(":checked")?":not(:checked)":":checked",e=p.find(".loading");return e.show(),setTimeout(function(){p.find(".data-list-check input"+t).next().click(),e.hide()},50),!0}),t},filterTemplate:function(){var t=$("<div>",{class:"data-list-control-buttons",html:[D,$("<i>",{class:"fa fa-filter",click:function(){p.jsGrid("clearFilter")}})]});return $("<div>",{class:"data-list-control",html:[t,'<div class="spinner-circle-shadow loading"></div>']})},itemTemplate:function(t,e){var a=$(b),i=e._id,n=a.find("input");-1<$.inArray(i,m.selectedItems)&&n.prop("checked",!0),k++,a.attr("title","#"+(y+k)),n.on("change",function(){var e,t;$(this).is(":checked")?(t=i,m.selectedItems.push(t),A||(A=!0,N())):(e=i,m.selectedItems=$.grep(m.selectedItems,function(t){return t!==e}),!m.selectedItems.length&&A&&(A=!1,N()))});var r=g._hidden_fields;if(!r)return a;for(var s=[],l=0;l<r.length;l++){var o=r[l];if(e[o])if(Array.isArray(e[o])){if(g[o]&&g[o].template)for(var c=0;c<e[o].length;c++){var d=e[o][c],u=g[o].template;for(var f in d)if(d.hasOwnProperty(f)){var h=new RegExp("{{"+f+"}}","g");u=u.replace(h,d[f])}u=u.replace(/{{\S+}}/g," - "),s.push($("<div>",{html:u}))}}else{var p=e[o];"money"===g[o].type&&(p=formatMoney(p)),s.push($("<span>",{text:w(g[o].label)+": "+p}))}}var v=$("<div>",{class:"data-list-accordion",html:s});return $("<div>",{class:"data-list-extend",html:[a,$("<i>",{class:"ti-angle-down"}).one("click",function(){$(this).closest("tr").append(v)}).click(function(t){t.stopPropagation();var e=$(this);v.slideToggle(400,function(){e.attr("class",$(this).is(":visible")?"ti-angle-up":"ti-angle-down")})})]})}});for(var r=function(t,r){t.filterTemplate=function(){var a=$("<input>",{type:"hidden"}),t=function(){var t=i.data("value")||i.val()||"",e=n.data("value")||n.val()||"";a.val(""!==t||""!==e?t+">>"+e:""),p.jsGrid("loadData")};this.filterControl=a;var e={class:"data-list-range",keydown:function(t){switch(t.which){case 13:$(this).trigger("change")}},type:"tel",placeholder:w({en_us:"min",pt_br:"mín"})},i=$("<input>",e),n=$("<input>",Object.assign(e,{placeholder:w({en_us:"max",pt_br:"máx"})}));return"function"==typeof r&&(r(i,0),r(n,1)),i.change(t),n.change(t),$("<div>",{html:[i,n]})}},t=0;t<g._fields.length;t++){var e=g._fields[t],a=g[e]||{};P.push(e);var s={name:e,type:"text",title:w(a.label||n._labels[e])};if(0===t)"_id"!==e?s.itemTemplate=function(t,e){if(t&&e)return $("<a>",{text:t,href:d+e._id})}:(s.itemTemplate=function(t){if(t)return $("<a>",{text:"#"+k,href:d+t})},s.title="#",s.filtering=!1,s.sorting=!1,a.width=60);else switch(a.type){case"link":s.itemTemplate=function(t){if(t){var e=t.length;return $("<a>",{text:32<e?t.substr(0,12)+"..."+t.substr(e-20):t,href:t,target:"_blank"})}};break;case"bold":!function(t,i,n){var r=function(t){var e=n[t]||{},a=i+" text-"+(e.class||"muted");return $("<span>",{class:a,text:w(e.text)||t})};s.itemTemplate=function(t){if(void 0!==t)return r("string"==typeof t?t:t.toString())},s.filterTemplate=function(){var t=[$("<option>",{text:"--",value:"",selected:!0})];for(var e in n)n.hasOwnProperty(e)&&t.push($("<option>",{text:e,value:e,"data-content":r(e).prop("outerHTML")}));var a=$("<select>",{class:"hidden",html:t,change:function(){p.jsGrid("loadData")}});return this.filterControl=a,setTimeout(function(){a.selectpicker({noneSelectedText:"--",windowPadding:70,container:c})},200),a}}(0,a.type,a.enum);break;case"money":s.itemTemplate=function(t){return formatMoney(t)},r(s,function(t){t.inputMoney(!0),t.change(function(){$(this).data("value",stringToNumber($(this).val()))})})}a.width&&(s.css="data-list-fixed",s.width=a.width),a.cutString&&(s.itemTemplate=function(e){return function(t){return t.length<=e?t:'<abbr title="'+t+'">'+cutString(t,e)+"</abbr>"}}(a.cutString)),a.range?r(s):E.push(e),C.push(s),v[e]=""}}var i=function(t,a,i){v[t]="",P.push(t);var e={name:t,type:"text",title:w(n._labels[t]),css:"data-list-fixed",width:i?110:90,itemTemplate:function(t){var e=t?formatDate(t,a):t;return i?$("<span>",{text:e,class:"fw-400"}):e}};return r(e,function(e,a){e.change(function(){var t=$(this).datepicker("getDate");t&&!isNaN(t.getTime())&&(1===a&&t.setHours(23,59,59),$(this).data("value",t.toISOString()))}),1===a&&setTimeout(function(){var t=e.parent();t.datepicker({inputs:t.children("input")})},300)}),e},l=i("created_at"),o=i("updated_at",["day","month","hour","minute"],!0);C.push(l,o),p.jsGrid({autoload:!0,filtering:!0,sorting:!0,confirmDeleting:!1,pageLoading:!0,pageSize:h,rowClick:function(t){var e=t.event.originalEvent||t.event;if(e){var a=e.target;if(a)switch(a.nodeName){case"TD":for(var i=0;i<a.classList.length;i++)if("data-list-check"===a.classList[i])return void $(a).find("label").click();break;case"LABEL":case"INPUT":case"DIV":case"SELECT":case"A":return}}var n=t.item;window.location=d+n._id,h=1,m.state.page=y+n._index,m.state.pagination=function(t){-1<(y=m.state.page+(t?-1:1))&&(m.state.page=y,S(function(){var t=m.data.result;t&&t.length&&(window.location=d+t[0]._id)}))}},controller:{loadData:function(t){if(O)O=!1;else if(j)S(),j=!1;else{var e,a=!1,i=!1;if(A){for(var n={},r=0;r<E.length;r++)if(""!==t[e=E[r]]){switch(t[e]){case"true":t[e]=!0;break;case"false":t[e]=!1}var s=e.split("/"),l=s[0];if(1<s.length){n[l]={};for(var o=1,c=n[l];o<s.length-1;)c[s[o]]={},o++;c[s[o]]=t[e]}else n[l]=t[e]}Object.keys(n).length&&(m.editItems(n),i=!0)}else for(e in v)v.hasOwnProperty(e)&&t[e]!==v[e]&&(v[e]=t[e],a||(a=!0));t.sortField||(t.sortField=x,t.sortOrder=T),_.field===t.sortField&&_.order===t.sortOrder||(_.field=t.sortField,_.order=t.sortOrder,a||(a=!0)),a?(y=0,I(),S()):A&&!i&&app.toast(w({en_us:"Edit the header fields to modify the selected items",pt_br:"Edite os campos no cabeçalho para alterar os itens selecionados"}))}return{data:u,itemsCount:u.length}}},onRefreshing:function(){k=0},fields:C})})}setTimeout(function(){window.unsetSaveAction()},200)}();