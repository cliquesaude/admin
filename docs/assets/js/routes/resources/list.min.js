!function(){"use strict";var n=window.tabId,s=window.Tabs[n],t=$("#t"+n+"-tab-normal");window.renderContentIds(t);var o=window.i18n,l="/"+window.location.hash+"/";$("#t"+n+"-create").click(function(){window.location=l+"new"});var e,c,d=s.slug,r=function(){e=s.data,c=e.result.map(function(t,e){var i={_index:e};for(var n in t){var a=t[n];if("object"!=typeof a||null===a||Array.isArray(a))i[n]=a;else for(var r in a)a.hasOwnProperty(r)&&(i[n+"/"+r]=a[r])}return i})};if(r(),c.length){var f,a='<div class="custom-controls-stacked"><div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" /><label class="custom-control-label"> </label></div></div>',u=$("#t"+n+"-resource-list"),p=0,v=0;f=e.meta.hasOwnProperty("limit")?e.meta.limit:1e3;var m={},h={field:null,order:null},g=function(t){("number"!=typeof t||isNaN(t)||t<1)&&(t=1),v=(t-1)*f,_()},i=function(t){var e=$("#t"+n+"-page"),i=parseInt(e.val(),10)+t;0<i&&(g(i),e.val(i))},w=function(){var t=$("#t"+n+"-prev"),e=$("#t"+n+"-next"),i=$("#t"+n+"-page");v<=0?t.attr("disabled",!0):t.removeAttr("disabled"),c.length<f?e.attr("disabled",!0):e.removeAttr("disabled"),v<=0&&c.length<f?i.attr("disabled",!0):i.removeAttr("disabled"),i.val(Math.ceil(v/f)+1)};$("#t"+n+"-page").keydown(window.keyIsNumber).change(function(){g(parseInt($(this).val(),10))}),$("#t"+n+"-next").click(function(){i(1)}),$("#t"+n+"-prev").click(function(){i(-1)}),w(),s.pagination=function(t){i(t?-1:1)},$("#t"+n+"-page-size").change(function(){var t=parseInt($(this).val(),10);!isNaN(t)&&0<t&&(f=t,v=0,$("#t"+n+"-page").val("1")),_()});var b,k=!1,y=!1,x=!1,T=!1,_=function(e){if(x)T||(T=!0);else{var i;x=!0,e||(i=u.find(".loading")).show();var t="limit="+f;0<v&&(t+="&offset="+v),h.field&&(t+="&sort=","desc"===h.order&&(t+="-"),t+=h.field);for(var n=0;n<j.length;n++){var a=j[n];m.hasOwnProperty(a)&&""!==m[a]&&(t+="&"+a+"="+m[a])}s.load(function(t){x=!1,"function"!=typeof e?(i.fadeOut(),T&&(_(),T=!1),t||(r(),k=!0,u.jsGrid("loadData"),w())):e()},t)}},I=[{align:"center",css:"data-list-check",filtering:!1,sorting:!1,headerTemplate:function(){var t=$(a);return t.find("input").addClass("checkbox-all").on("change",function(){var t=$(this).is(":checked")?":not(:checked)":":checked";return setTimeout(function(){u.find(".data-list-check input"+t).next().click()},50),!0}),t},filterTemplate:function(){return'<div class="spinner-circle-shadow loading"></div>'},itemTemplate:function(t,e){var i=$(a),n=e._id;return i.find("input").on("change",function(){$(this).is(":checked")?A(n):D(n)}),i}}],j=[];$.getJSON("json/misc/config_lists.json",function(t){var e=t[d];if(e)for(var i=0;i<e._fields.length;i++){var n=e._fields[i],a=e[n];j.push(n);var r={name:n,type:"text",title:o(a?a.label:t._labels[n])};if(0===i)r.itemTemplate=function(t,e){if(t&&e)return $("<a>",{text:t,href:l+e._id})};else if(a)switch(a.type){case"link":r.itemTemplate=function(t){if(t){var e=t.length;return $("<a>",{text:32<e?t.substr(0,12)+"..."+t.substr(e-20):t,href:t,target:"_blank"})}};break;case"badge":case"bold":r.itemTemplate=function(n,a){return function(t){if(t){var e=a[t]||{},i=n+" ";return i+="badge"===n?n+"-"+(e.class||"primary"):"text-"+(e.class||"muted"),$("<span>",{class:i,text:o(e.text)||t})}}}(a.type,a.enum);break;case"money":r.itemTemplate=r.itemTemplate=function(t){return formatMoney(t)}}a&&a.width&&(r.css="data-list-fixed",r.width=a.width),I.push(r),m[n]=""}I.push({name:"updated_at",type:"text",title:o(t._labels.updated_at),filtering:!1,itemTemplate:function(t){return t?formatDate(t):t}},{css:"data-list-control",filtering:!1,sorting:!1,title:"#",filterTemplate:function(){return $("<div>",{class:"data-list-control-buttons",html:[$("<i>",{class:"fa fa-search",click:function(){u.jsGrid("loadData")}}),$("<i>",{class:"fa fa-filter",click:function(){u.jsGrid("clearFilter")}})]})},itemTemplate:function(){return"#"+(v+ ++p)}}),u.jsGrid({autoload:!0,filtering:!0,sorting:!0,confirmDeleting:!1,pageLoading:!0,pageSize:f,rowClick:function(t){var e=t.event.originalEvent||t.event;if(e){var i=e.target;if(i)switch(i.nodeName){case"TD":for(var n=0;n<i.classList.length;n++)if("data-list-check"===i.classList[n])return void $(i).find("label").click();break;case"LABEL":case"INPUT":case"DIV":case"SELECT":case"A":return}}var a=t.item;window.location=l+a._id,f=1,s.state.page=v+a._index,s.state.pagination=function(t){-1<(v=s.state.page+(t?-1:1))&&(s.state.page=v,_(function(){var t=s.data.result;t&&t.length&&(window.location=l+t[0]._id)}))}},controller:{loadData:function(t){if(b)b=!1;else if(k)k=!1;else if(y)_();else{var e=!1;for(var i in m)m.hasOwnProperty(i)&&t[i]!==m[i]&&(m[i]=t[i],e||(e=!0));t.sortField?h.field===t.sortField&&h.order===t.sortOrder||(h.field=t.sortField,h.order=t.sortOrder,e||(e=!0)):(h.field="updated_at",h.order="desc",e||(e=!0)),e&&(v=0,w(),_())}return{data:c,itemsCount:c.length}}},onRefreshing:function(){p=0},fields:I}),b=!0,u.jsGrid("sort","updated_at","desc")});var A=function(t){s.selectedItems.push(t)},D=function(e){s.selectedItems=$.grep(s.selectedItems,function(t){return t!==e})};s.deleteItems=function(){return u.find(".loading").show(),function(){k=!(y=!0),u.jsGrid("loadData"),u.find(".checkbox-all:checked").next().click()}}}setTimeout(function(){window.unsetSaveAction()},200)}();