!function(){"use strict";var i=window.tabId,a=window.Tabs[i],e=$("#t"+i+"-tab-normal");window.renderContentIds(e);var r=window.i18n;$("#t"+i+"-create").click(function(){window.location="/"+window.location.hash+"/new"});var t,l,n=a.slug,o=function(){t=a.data,l=t.result};if(o(),l.length){var c,s='<div class="custom-controls-stacked"><div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" /><label class="custom-control-label"> </label></div></div>',d=$("#t"+i+"-resource-list"),f=0,u=0;c=t.meta.hasOwnProperty("limit")?t.meta.limit:1e3;var h={},v={field:null,order:null},g=function(e){u=(e-1)*c,j()},p=function(e){var t=$("#t"+i+"-page"),n=parseInt(t.val(),10)+e;0<n&&(g(n),t.val(n))},m=function(){var e=$("#t"+i+"-prev"),t=$("#t"+i+"-next"),n=$("#t"+i+"-page");u<=0?e.attr("disabled",!0):e.removeAttr("disabled"),l.length<c?t.attr("disabled",!0):t.removeAttr("disabled"),u<=0&&l.length<c?n.attr("disabled",!0):n.removeAttr("disabled")};$("#t"+i+"-page").keydown(window.keyIsNumber).change(function(){g(parseInt($(this).val(),10))}),$("#t"+i+"-next").click(function(){p(1)}),$("#t"+i+"-prev").click(function(){p(-1)}),m(),$("#t"+i+"-page-size").change(function(){var e=parseInt($(this).val(),10);!isNaN(e)&&0<e&&(c=e,u=0,$("#t"+i+"-page").val("1")),j()});var w,k,b=!1,I=!1,x=!1,T=!1,j=function(){if(x)T||(T=!0);else{x=!0;var t=d.find(".loading");t.show();var e="limit="+c;0<u&&(e+="&offset="+u),v.field&&(e+="&sort=","desc"===v.order&&(e+="-"),e+=v.field);for(var n=0;n<O.length;n++){var i=O[n];h.hasOwnProperty(i)&&""!==h[i]&&(e+="&"+i+"="+h[i])}a.load(function(e){x=!1,t.fadeOut(),T&&(j(),T=!1),e||(o(),b=!0,d.jsGrid("loadData"),m())},e)}},y=[{align:"center",css:"data-list-check",filtering:!1,sorting:!1,headerTemplate:function(){var e=$(s);return e.find("input").addClass("checkbox-all").on("change",function(){var e=$(this).is(":checked")?":not(:checked)":":checked";d.find(".data-list-check input"+e).next().click()}),e},filterTemplate:function(){return'<div class="spinner-circle-shadow loading"></div>'},itemTemplate:function(e,t){var n=$(s),i=t._id;return n.find("input").on("change",function(){$(this).is(":checked")?G(i):L(i)}),n}}],O=[];for(k=0;k<t.meta.fields.length;k++)if("_id"!==(w=t.meta.fields[k]))for(var D=0;D<l.length;D++){switch(typeof l[D][w]){case"undefined":continue;case"string":O.push(w)}D=l.length}for(k=0;k<O.length;k++)w=O[k],y.push({name:w,type:"text"}),h[w]="";y.push({css:"data-list-control",filtering:!1,sorting:!1,title:"#",filterTemplate:function(){return $("<div />",{class:"data-list-control-buttons",html:[$("<i />",{class:"fa fa-search",click:function(){d.jsGrid("loadData")}}),$("<i />",{class:"fa fa-filter",click:function(){d.jsGrid("clearFilter")}})]})},itemTemplate:function(){return"#"+(u+ ++f)}}),d.jsGrid({autoload:!0,filtering:!0,sorting:!0,confirmDeleting:!1,pageLoading:!0,pageSize:c,rowClick:function(e){var t=e.event.originalEvent||e.event;if(t){var n=t.target;if(n)switch(n.nodeName){case"TD":for(var i=0;i<n.classList.length;i++)if("data-list-check"===n.classList[i])return void $(n).find("label").click();break;case"LABEL":case"INPUT":case"DIV":case"SELECT":return}}window.location="/"+window.location.hash+"/"+e.item._id},controller:{loadData:function(e){if(b)b=!1;else if(I)j();else{var t=!1;for(var n in h)h.hasOwnProperty(n)&&e[n]!==h[n]&&(h[n]=e[n],t||(t=!0));e.sortField?v.field===e.sortField&&v.order===e.sortOrder||(v.field=e.sortField,v.order=e.sortOrder,t||(t=!0)):v.field&&(v.field=v.order=null,t||(t=!0)),t&&j()}return{data:l,itemsCount:l.length}}},onRefreshing:function(){f=0},fields:y}),$.getJSON("json/resources/"+n+".json",function(e){for(var t=0;t<O.length;t++){var n=O[t],i=e[n];i&&i.label&&d.jsGrid("fieldOption",n,"title",r(i.label))}});var G=function(e){a.selectedItems.push(e)},L=function(t){a.selectedItems=$.grep(a.selectedItems,function(e){return e!==t})};a.deleteItems=function(){return d.find(".loading").show(),function(){b=!(I=!0),d.jsGrid("loadData"),d.find(".checkbox-all:checked").next().click()}}}}();