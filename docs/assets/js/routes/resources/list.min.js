!function(){"use strict";var i=window.tabId,o=window.Tabs[i],t=$("#t"+i+"-tab-normal");window.renderContentIds(t);var l=window.i18n;$("#t"+i+"-create").click(function(){window.location="/"+window.location.hash+"/new"});var e,a,n=o.slug,r=function(){e=o.data,a=e.result.map(function(t,e){var n={_index:e};for(var i in t){var a=t[i];if("object"!=typeof a||null===a||Array.isArray(a))n[i]=a;else for(var r in a)a.hasOwnProperty(r)&&(n[i+"/"+r]=a[r])}return n})};if(r(),a.length){var c,s='<div class="custom-controls-stacked"><div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" /><label class="custom-control-label"> </label></div></div>',d=$("#t"+i+"-resource-list"),f=0,u=0;c=e.meta.hasOwnProperty("limit")?e.meta.limit:1e3;var v={},h={field:null,order:null},p=function(t){u=(t-1)*c,T()},g=function(t){var e=$("#t"+i+"-page"),n=parseInt(e.val(),10)+t;0<n&&(p(n),e.val(n))},m=function(){var t=$("#t"+i+"-prev"),e=$("#t"+i+"-next"),n=$("#t"+i+"-page");u<=0?t.attr("disabled",!0):t.removeAttr("disabled"),a.length<c?e.attr("disabled",!0):e.removeAttr("disabled"),u<=0&&a.length<c?n.attr("disabled",!0):n.removeAttr("disabled")};$("#t"+i+"-page").keydown(window.keyIsNumber).change(function(){p(parseInt($(this).val(),10))}),$("#t"+i+"-next").click(function(){g(1)}),$("#t"+i+"-prev").click(function(){g(-1)}),m(),o.pagination=function(t){g(t?-1:1)},$("#t"+i+"-page-size").change(function(){var t=parseInt($(this).val(),10);!isNaN(t)&&0<t&&(c=t,u=0,$("#t"+i+"-page").val("1")),T()});var w,k,b=!1,y=!1,I=!1,x=!1,T=function(t){if(I)x||(x=!0);else{I=!0;var e=d.find(".loading");e.show();var n="limit="+c;0<u&&(n+="&offset="+u),h.field&&(n+="&sort=","desc"===h.order&&(n+="-"),n+=h.field);for(var i=0;i<O.length;i++){var a=O[i];v.hasOwnProperty(a)&&""!==v[a]&&(n+="&"+a+"="+v[a])}"function"!=typeof t&&(t=function(t){I=!1,e.fadeOut(),x&&(T(),x=!1),t||(r(),b=!0,d.jsGrid("loadData"),m())}),o.load(t,n)}},j=[{align:"center",css:"data-list-check",filtering:!1,sorting:!1,headerTemplate:function(){var t=$(s);return t.find("input").addClass("checkbox-all").on("change",function(){var t=$(this).is(":checked")?":not(:checked)":":checked";return setTimeout(function(){d.find(".data-list-check input"+t).next().click()},50),!0}),t},filterTemplate:function(){return'<div class="spinner-circle-shadow loading"></div>'},itemTemplate:function(t,e){var n=$(s),i=e._id;return n.find("input").on("change",function(){$(this).is(":checked")?G(i):L(i)}),n}}],O=[];for(k=0;k<a.length;k++)for(w in a[k])if("_"!==w[0])switch(typeof a[k][w]){case"undefined":continue;case"string":case"number":for(var A=!1,D=0;D<O.length;D++)if(O[D]===w){A=!0;break}A||(O.push(w),j.push({name:w,type:"text"}),v[w]="")}j.push({css:"data-list-control",filtering:!1,sorting:!1,title:"#",filterTemplate:function(){return $("<div />",{class:"data-list-control-buttons",html:[$("<i />",{class:"fa fa-search",click:function(){d.jsGrid("loadData")}}),$("<i />",{class:"fa fa-filter",click:function(){d.jsGrid("clearFilter")}})]})},itemTemplate:function(){return"#"+(u+ ++f)}}),d.jsGrid({autoload:!0,filtering:!0,sorting:!0,confirmDeleting:!1,pageLoading:!0,pageSize:c,rowClick:function(t){var e=t.event.originalEvent||t.event;if(e){var n=e.target;if(n)switch(n.nodeName){case"TD":for(var i=0;i<n.classList.length;i++)if("data-list-check"===n.classList[i])return void $(n).find("label").click();break;case"LABEL":case"INPUT":case"DIV":case"SELECT":return}}var a=t.item,r="/"+window.location.hash+"/";window.location=r+a._id,u=a._index,c=1,o.state.pagination=function(t){-1<(u+=t?-1:1)&&T(function(){var t=o.data.result;t&&t.length&&(window.location=r+t[0]._id)})}},controller:{loadData:function(t){if(b)b=!1;else if(y)T();else{var e=!1;for(var n in v)v.hasOwnProperty(n)&&t[n]!==v[n]&&(v[n]=t[n],e||(e=!0));t.sortField?h.field===t.sortField&&h.order===t.sortOrder||(h.field=t.sortField,h.order=t.sortOrder,e||(e=!0)):h.field&&(h.field=h.order=null,e||(e=!0)),e&&T()}return{data:a,itemsCount:a.length}}},onRefreshing:function(){f=0},fields:j}),$.getJSON("json/resources/"+n+".json",function(t){for(var e=0;e<O.length;e++){var n,i=O[e],a=i.split("/");if(1===a.length)n=t[i];else{n=t[a[0]];for(var r=1;r<a.length;r++){if(!n||!n.properties){n=null;break}n=n.properties[a[r]]}}n&&n.label&&d.jsGrid("fieldOption",i,"title",l(n.label))}});var G=function(t){o.selectedItems.push(t)},L=function(e){o.selectedItems=$.grep(o.selectedItems,function(t){return t!==e})};o.deleteItems=function(){return d.find(".loading").show(),function(){b=!(y=!0),d.jsGrid("loadData"),d.find(".checkbox-all:checked").next().click()}}}setTimeout(function(){window.unsetSaveAction()},200)}();