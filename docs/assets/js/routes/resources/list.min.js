!function(){"use strict";var i=window.tabId,r=window.Tabs[i],t=$("#t"+i+"-tab-normal");window.renderContentIds(t);var o=window.i18n,s="/"+window.location.hash+"/";$("#t"+i+"-create").click(function(){window.location=s+"new"});var e,a,c=r.slug,l=function(){e=r.data,a=e.result.map(function(t,e){var n={_index:e};for(var i in t){var a=t[i];if("object"!=typeof a||null===a||Array.isArray(a))n[i]=a;else for(var r in a)a.hasOwnProperty(r)&&(n[i+"/"+r]=a[r])}return n})};if(l(),a.length){var d,f='<div class="custom-controls-stacked"><div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" /><label class="custom-control-label"> </label></div></div>',u=$("#t"+i+"-resource-list"),n=0,v=0;d=e.meta.hasOwnProperty("limit")?e.meta.limit:1e3;var h={},g={field:null,order:null},p=function(t){v=(t-1)*d,_()},m=function(t){var e=$("#t"+i+"-page"),n=parseInt(e.val(),10)+t;0<n&&(p(n),e.val(n))},w=function(){var t=$("#t"+i+"-prev"),e=$("#t"+i+"-next"),n=$("#t"+i+"-page");v<=0?t.attr("disabled",!0):t.removeAttr("disabled"),a.length<d?e.attr("disabled",!0):e.removeAttr("disabled"),v<=0&&a.length<d?n.attr("disabled",!0):n.removeAttr("disabled")};$("#t"+i+"-page").keydown(window.keyIsNumber).change(function(){p(parseInt($(this).val(),10))}),$("#t"+i+"-next").click(function(){m(1)}),$("#t"+i+"-prev").click(function(){m(-1)}),w(),r.pagination=function(t){m(t?-1:1)},$("#t"+i+"-page-size").change(function(){var t=parseInt($(this).val(),10);!isNaN(t)&&0<t&&(d=t,v=0,$("#t"+i+"-page").val("1")),_()});var k,b,x=!1,y=!1,T=!1,I=!1,_=function(e){if(T)I||(I=!0);else{var n;T=!0,e||(n=u.find(".loading")).show();var t="limit="+d;0<v&&(t+="&offset="+v),g.field&&(t+="&sort=","desc"===g.order&&(t+="-"),t+=g.field);for(var i=0;i<O.length;i++){var a=O[i];h.hasOwnProperty(a)&&""!==h[a]&&(t+="&"+a+"="+h[a])}r.load(function(t){T=!1,"function"!=typeof e?(n.fadeOut(),I&&(_(),I=!1),t||(l(),x=!0,u.jsGrid("loadData"),w())):e()},t)}},j=[{align:"center",css:"data-list-check",filtering:!1,sorting:!1,headerTemplate:function(){var t=$(f);return t.find("input").addClass("checkbox-all").on("change",function(){var t=$(this).is(":checked")?":not(:checked)":":checked";return setTimeout(function(){u.find(".data-list-check input"+t).next().click()},50),!0}),t},filterTemplate:function(){return'<div class="spinner-circle-shadow loading"></div>'},itemTemplate:function(t,e){var n=$(f),i=e._id;return n.find("input").on("change",function(){$(this).is(":checked")?C(i):P(i)}),n}}],O=[],A=!0;for(b=0;b<a.length;b++)for(k in a[b])if("_"!==k[0]){var D=typeof a[b][k];switch(D){case"undefined":continue;case"string":case"number":for(var G=!1,L=0;L<O.length;L++)if(O[L]===k){G=!0;break}if(!G){O.push(k);var N={name:k,type:"text",title:" "};A&&"string"===D?A=!(N.itemTemplate=function(t,e){return $("<a>",{text:e[k],href:s+e._id})}):N.itemTemplate=function(t){if(/https?:\/\/\S+$/.test(t)){var e=t.length;return $("<a>",{text:32<e?t.substr(0,12)+"..."+t.substr(e-20):t,href:t,target:"_blank"})}return t},j.push(N),h[k]=""}}}j.push({css:"data-list-control",filtering:!1,sorting:!1,title:"#",filterTemplate:function(){return $("<div />",{class:"data-list-control-buttons",html:[$("<i />",{class:"fa fa-search",click:function(){u.jsGrid("loadData")}}),$("<i />",{class:"fa fa-filter",click:function(){u.jsGrid("clearFilter")}})]})},itemTemplate:function(){return"#"+(v+ ++n)}}),u.jsGrid({autoload:!0,filtering:!0,sorting:!0,confirmDeleting:!1,pageLoading:!0,pageSize:d,rowClick:function(t){var e=t.event.originalEvent||t.event;if(e){var n=e.target;if(n)switch(n.nodeName){case"TD":for(var i=0;i<n.classList.length;i++)if("data-list-check"===n.classList[i])return void $(n).find("label").click();break;case"LABEL":case"INPUT":case"DIV":case"SELECT":case"A":return}}var a=t.item;window.location=s+a._id,d=1,r.state.page=v+a._index,r.state.pagination=function(t){-1<(v=r.state.page+(t?-1:1))&&(r.state.page=v,_(function(){var t=r.data.result;t&&t.length&&(window.location=s+t[0]._id)}))}},controller:{loadData:function(t){if(x)x=!1;else if(y)_();else{var e=!1;for(var n in h)h.hasOwnProperty(n)&&t[n]!==h[n]&&(h[n]=t[n],e||(e=!0));t.sortField?g.field===t.sortField&&g.order===t.sortOrder||(g.field=t.sortField,g.order=t.sortOrder,e||(e=!0)):g.field&&(g.field=g.order=null,e||(e=!0)),e&&_()}return{data:a,itemsCount:a.length}}},onRefreshing:function(){n=0},fields:j}),$.getJSON("json/misc/config_lists.json",function(t){for(var e=0;e<O.length;e++){var n=O[e],i=t.headers,a=i[c][n]||i._general[n];a&&u.jsGrid("fieldOption",n,"title",o(a))}});var C=function(t){r.selectedItems.push(t)},P=function(e){r.selectedItems=$.grep(r.selectedItems,function(t){return t!==e})};r.deleteItems=function(){return u.find(".loading").show(),function(){x=!(y=!0),u.jsGrid("loadData"),u.find(".checkbox-all:checked").next().click()}}}setTimeout(function(){window.unsetSaveAction()},200)}();