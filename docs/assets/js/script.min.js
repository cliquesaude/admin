"use strict";app.config({autoload:!0,provide:["jsgrid","summernote","dropzone","typeahead","bloodhound","tagsinput","selectpicker","colorpicker"],googleApiKey:"",googleAnalyticsId:"",smoothScroll:!1,saveState:!1,cacheBust:""}),function(){var s;window.startMony=function(e,a,n){var t={storeId:e.store_id,name:a.name,gender:null,email:a.email,language:"pt_br"===window.lang?"Português":"English",myId:a._id};window.Mony.init(t,n.access_token,function(e,a){e?console.error(e):o(a)});var o=function(e,a){if(e&&""!==e){var n="media media-chat ",t='<div class="'+(n+=a?"media-chat-reverse":"media-chat-default")+'"><div class="media-body"><p>'+e+"</p></div></div>";$("#mony").append(t).scrollTop(9999)}},s=function(){var e=$("#dock-chat .publisher-input"),a=e.val();""!==a&&(o(a,!0),window.Mony.sendMessage(a),e.val(""))};$("#dock-chat .publisher-btn").click(s),$("#dock-chat .publisher-input").keypress(function(e){13===e.which&&s()})},window.appReady=function(){s="pt_br"===window.lang?($.getScript("/assets/vendor/jsgrid/i18n/jsgrid-pt-br.js",function(){jsGrid.locale("pt-br")}),$.getScript("/assets/vendor/summernote/lang/summernote-pt-BR.js",function(){$.summernote.options.lang="pt-BR"}),","):".",$("select").selectpicker({style:"btn-light",noneSelectedText:"--",windowPadding:70}),$("#topbar-action-toggle").click(function(){var e=$("#topbar-action");e.hasClass("h-auto")?e.hide().removeClass("h-auto").slideDown(200,function(){$(this).find("#topbar-action-body").hide().removeClass("hidden").fadeIn()}):e.slideUp(200,function(){$(this).find("#topbar-action-body").addClass("hidden"),$(this).addClass("h-auto").fadeIn()})}),$.fn.selectRange=function(e,a){var n=$(this)[0];if(n)if(n.setSelectionRange)n.focus(),n.setSelectionRange(e,a);else if(n.createTextRange){var t=n.createTextRange();t.collapse(!0),t.moveEnd("character",a),t.moveStart("character",e),t.select()}else n.selectionStart&&(n.selectionStart=e,n.selectionEnd=a)},$.fn.inputMoney=function(e){var a=formatMoney(0);e||$(this).attr("placeholder",a);var n={prefix:a.replace(/0.*/,""),allowNegative:!0,decimal:s};n.thousands="."===s?",":".",$(this).maskMoney(n)}};var c=function(e){return e||(e=window.lang),e=e?e.replace("_","-"):"pt-BR"};window.keyIsNumber=function(e){if(13!==e.which&&8!==e.which){var a=e.which?e.which:e.keyCode;return 95<a&&a<106&&(a-=48),!isNaN(String.fromCharCode(a))||(e.preventDefault(),!1)}},window.fixScrollbars=function(e){e.find(".scrollable").each(function(){$(this).hasClass("scrollable-x")&&$(this).hover(function(){$(this).find(".ps-scrollbar-x-rail").is(":visible")||$(this).scrollLeft(1)})}).perfectScrollbar({wheelPropagation:!1,wheelSpeed:.5})},window.formatMoney=function(a,e,n){var t;e||(e="BRL"),n=c(n);try{t=a.toLocaleString(n,{style:"currency",currency:e})}catch(e){t=a}return t},window.formatDate=function(e,a,n){n=c(n);var t=new Date(e);if(t&&!isNaN(t.getTime()))try{var o,s;s=a?(o=["day","month","year","hour","minute"],"2-digit"):(o=["day","month","year","hour","minute","second"],"numeric");for(var i={},r=0;r<o.length;r++)i[o[r]]=s;return t.toLocaleDateString(n,i)}catch(e){}return e},window.stringToNumber=function(e){return"."!==s&&(e=e.replace(/\./g,"").replace(s,".")),-1===(e=e.replace(/[^0-9-.]/g,"")).indexOf(".")?parseInt(e,10):parseFloat(e)},window.numberToString=function(e,a,n){var t,o;a?(t=e.toString(),o="."!==s?(t=t.replace(".",s),"."):",",t=t.replace(/\B(?=(\d{3})+(?!\d))/g,o),n&&-1===t.indexOf(s)&&(t+=s+"00")):t=parseInt(e,10).toString();return t},window.newTabLink=function(e){var a=window.open(e,"_blank");a&&a.focus()},window.cutString=function(e,a,n){if(a<e.length){var t=e.substr(0,a+1);return t=t.substr(0,t.lastIndexOf(" ")),n?t+n:t}return e},window.getFromDotNotation=function(e,a){var n=a.split(".");if(n.length<=1)return e[a];for(var t=0;t<n.length;t++){if("object"!=typeof e||null===e)return;e=e[n[t]]}return e},window.getProperties=function(e,a){for(var n=a.split(","),t={},o=0;o<n.length;o++){var s=n[o];t[s]=e[s]}return t},window.clearAccents=function(e,a){return e=e.replace(/[çć]/g,"c").replace(/[ÇĆ]/g,"C").replace(/[áâãà]/g,"a").replace(/[ÁÂÃÀ]/g,"A").replace(/[éêẽ]/g,"e").replace(/[ÉÊẼ]/g,"E").replace(/[íîĩ]/g,"i").replace(/[ÍÎĨ]/g,"I").replace(/[óôõ]/g,"o").replace(/[ÓÔÕ]/g,"O").replace(/[úûõ]/g,"u").replace(/[ÚÛŨ]/g,"U"),a&&("string"!=typeof a&&(a=""),e=e.replace(/[\s\n]/g,a)),e},window.normalizeString=function(e){return clearAccents(e.toLowerCase(),"_")},window.randomInt=function(e,a){return Math.floor(Math.random()*(a-e))+e},window.objectIdPad=function(e,a){return e.substring(0,24-a.length)+a},window.randomObjectId=function(){for(var e=randomInt(1e4,99999)+"0"+Date.now();e.length<24;)e+="0";return e},window.substringMatcher=function(s){return function(e,a){var n,t,o;n="function"==typeof s?s():s,t=[],o=new RegExp(e,"i"),$.each(n,function(e,a){o.test(a)&&t.push(a)}),a(t)}},window.handleInputs=function(i,r){i.find('input[type="checkbox"]').change(function(){r($(this),!0)}),i.find('input[type="radio"]').change(function(){var e=i.find('input[name="'+$(this).attr("name")+'"]:checked');r(e);var a=e.data("disable");a&&i.find('[name="'+a+'"]').each(function(){$(this).data("enable-value")===e.val()?$(this).removeAttr("disabled").focus():$(this).attr("disabled",!0).val("").trigger("change")})}),i.find('input[type="text"],select,textarea').change(function(){r($(this));var e=$(this).data("fill-field");if(e){var a=i.find('[name="'+e+'"]'),n=$(this).val(),t=a.data("fill-clear-accents");t&&(n=clearAccents(n,t)),"lower"===a.data("fill-case")&&(n=n.toLowerCase());var o=a.data("fill-pattern");o&&(n=n.replace(new RegExp(o,"g"),""));var s=a.attr("maxlength");s&&(n=n.substr(0,parseInt(s,10))),a.val(n).trigger("change")}}),i.find('input[type="tel"],input[type="number"]').change(function(){r($(this))}),i.find("input[data-money]").inputMoney(),i.find('input[type="number"]').keydown(function(e){var a=[46,8,9,27,13],n=$(this).attr("step");!n||"any"!==n&&-1===n.indexOf(".")||a.push(110,188,190);var t=$(this).attr("min");(!t||parseInt(t,10)<0)&&a.push(109,173,189),-1!==$.inArray(e.keyCode,a)||-1!==$.inArray(e.keyCode,[65,67,86,88])&&(!0===e.ctrlKey||!0===e.metaKey)||35<=e.keyCode&&e.keyCode<=40||(e.shiftKey||e.keyCode<48||57<e.keyCode)&&(e.keyCode<96||105<e.keyCode)&&e.preventDefault()})},window.setupInputValues=function(e,a,n,t){for(var o in n||(n=""),a){var s,i=a[o],r=e.find('[name="'+n+o+'"]:not(:disabled)');if(t&&(r=r.filter(function(){return $(this).data("object-id")===t})),r.length){if(!r.is("input:file"))switch(typeof i){case"string":"radio"!==r.attr("type")?r.val(i):r.filter(function(){return $(this).val()===i}).click();break;case"number":r.data("money")?r.val(formatMoney(i)):"number"===r.attr("type")?r.val(i):r.val(numberToString(i,!r.data("integer")));break;case"object":if(Array.isArray(i))if(r.hasClass("tagsinput"))!function(a,n){setTimeout(function(){for(var e=0;e<n.length;e++)a.tagsinput("add",n[e])},400)}(r,i);else{var c=[];for(s=0;s<i.length;s++){var l=i[s];"string"!=typeof l?c.push(JSON.stringify(l)):c.push(l)}r.val(c)}else null!==i&&r.val(JSON.stringify(i));break;case"boolean":i?r.attr("checked",!0):r.removeAttr("checked")}}else if("object"==typeof i&&null!==i){var u=n+o+".";if(Array.isArray(i)){if(i[0]&&"object"==typeof i[0]&&i[0]._id)for(s=0;s<i.length;s++)setupInputValues(e,i[s],u,i[s]._id)}else setupInputValues(e,i,u)}}},window.getCombinations=function(e,a,n,t){void 0===a&&(a=0),n||(n=[]),t||(t={});var o=Object.keys(e),s=o[a],i=e[s];if(Array.isArray(i))for(var r=0;r<i.length;r++)if(t[s]=i[r],a+1<o.length)getCombinations(e,a+1,n,t);else{var c=Object.assign({},t);n.push(c)}return n}}(),app.ready(function(){var e,r={},a=function(){for(var e in r)r.hasOwnProperty(e)&&sessionStorage.setItem(e,r[e]);$(window).off("beforeunload"),location.reload()},n=function(e){e&&console.error(e),alert(h({en_us:"Fatal error, restarting in 3 seconds",pt_br:"Erro fatal, reiniciando em 3 segundos"})),setTimeout(function(){a()},3e3)},t=localStorage.getItem("lang");t&&/^[a-z]{2}(_[a-z]{2})?$/.test(t)||(t="pt_br"),window.lang=t,(e=$('#langs-menu [data-lang="'+t+'"]')).addClass("active"),$("#current-lang").find("img").attr("src",e.find("img").attr("src")).next().text(t.split("_")[0].toUpperCase()),$("#langs-menu > a").click(function(){localStorage.setItem("lang",$(this).data("lang")),a()});var h=function(e){if("object"==typeof e&&null!==e){if(e.hasOwnProperty("en_us"))return e.hasOwnProperty(t)?e[t]:e.en_us;for(var a in e)e.hasOwnProperty(a)&&(e[a]=h(e[a]))}return e};window.i18n=h,$("head").append('<style type="text/css">.i18n > [data-lang="'+t+'"]{display: inline;}</style>'),$(".after-i18n").fadeIn();var c={home:h({en_us:"Home",pt_br:"Início"}),resources:h({en_us:"Resources",pt_br:"Recursos"}),channels:h({en_us:"Sales channels",pt_br:"Canais de venda"}),media:h({en_us:"Media",pt_br:"Mídia"}),go_to_store:h({en_us:"Go to store",pt_br:"Ir à loja"}),themes:h({en_us:"Themes",pt_br:"Temas"}),settings:h({en_us:"Settings",pt_br:"Configurações"}),all_the:h({en_us:"All the",pt_br:"Todos os"}),create:h({en_us:"Add",pt_br:"Adicionar"}),unknown_error:h({en_us:"Unknown error, please try again",pt_br:"Erro desconhecido, por favor tente novamente"})},s=function(){$("div.toast.reveal").removeClass("reveal")},o=app.toast;app.toast=function(e){if("string"!=typeof e&&e)try{e=JSON.stringify(e)}catch(e){return void console.error(e)}o(e)};var i,m=function(e){var a;"object"==typeof e&&null!==e&&(e.hasOwnProperty("user_message")?a=e.user_message[t]:e.hasOwnProperty("message")&&(a=e.message)),void 0!==a?console.log("API Error Code: "+e.error_code):a=c.unknown_error,app.toast(a,{duration:7e3})};if("boolean"==typeof login&&!0===login){!function(n){var t,o=function(){t=["/assets/img/bg/coffee.jpg","/assets/img/bg/notebook.jpg","/assets/img/bg/numbers.jpg","/assets/img/bg/pens.jpg","/assets/img/bg/table.jpg","/assets/img/bg/writer.jpg"]};o();var e=function(){var e=new Image;e.onload=function(){var e=this;$(n).fadeOut(1e3,function(){$(this).css("background-image","url("+e.src+")").fadeIn()})};var a=Math.floor(Math.random()*(t.length-1));e.src=t[a],t.splice(a,1),0===t.length&&o()};e(),setInterval(e,6e4)}("#full-bg");var l=(i=[{msg:{en_us:"Start where you are. Use what you have. Do what you can.",pt_br:"Comece de onde você está. Use o que você tiver. Faça o que você puder."},author:"Arthur Ashe"},{msg:{en_us:"Success is the sum of repeated small efforts day after day.",pt_br:"O sucesso é a soma de pequenos esforços repetidos dia após dia."},author:"Robert Collier"},{msg:{en_us:"All progress takes place outside the comfort zone.",pt_br:"Todo progresso acontece fora da zona de conforto."},author:"Michael John Bobak"},{msg:{en_us:"Courage is the resistance and mastery of fear, not its absence.",pt_br:"Coragem é a resistência e o domínio do medo, não a ausência dele."},author:"Mark Twain"},{msg:{en_us:"The only place where success comes before work is in the dictionary.",pt_br:"O único lugar em que o sucesso vem antes do trabalho é no dicionário."},author:"Vidal Sassoon"},{msg:{en_us:"To dream small and big requires the same work.",pt_br:"Sonhar grande e sonhar pequeno dá o mesmo trabalho."},author:"Jorge Paulo Lemann"},{msg:{en_us:"If you want to live and are curious, sleeping is not the most important thing.",pt_br:"Se você tem vontade de viver e curiosidade, dormir não é a coisa mais importante."},author:"Martha Stewart"},{msg:{en_us:"Do or do not, there is no try.",pt_br:"Faça ou não faça. Tentativas não existem."},author:"Yoda"},{msg:{en_us:"You don't need a company with 100 people to develop this idea.",pt_br:"Você não precisa de uma equipe de 100 pessoas para desenvolver uma ideia."},author:"Larry Page"},{msg:{en_us:"Do not let what you cannot do interfere with what you can do.",pt_br:"Não deixe o que você não pode fazer interferir no que você pode fazer."},author:"John Wooden"},{msg:{en_us:"Winners never quit and quitters never win.",pt_br:"Vencedores nunca desistem e quem desiste nunca vence."},author:"Vince Lombardi"}])[Math.floor(Math.random()*(i.length-1))];(e=$("#quote-of-day")).find('[data-lang="en_us"]').text('"'+l.msg.en_us+'"'),e.find('[data-lang="pt_br"]').text('"'+l.msg.pt_br+'"'),e.find("cite").text(l.author);var u=localStorage.getItem("username");u&&$("#username").val(u),$("#username, #password").change(function(){""!==$(this).val()&&$(this).parent().addClass("do-float")}).trigger("change"),$("#login-form").submit(function(){if(!$(this).hasClass("ajax")){s();var t=$("#username").val(),e=md5($("#password").val());$("#remember").is(":checked")?localStorage.setItem("username",t):localStorage.removeItem("username");var o=$(this);o.addClass("ajax");var n=function(e,a,n){403!==e.status&&console.error(n),m(e.responseJSON),o.removeClass("ajax")};$.ajax({url:"https://api.e-com.plus/v1/_login.json?username",method:"POST",dataType:"json",contentType:"application/json; charset=UTF-8",headers:{"X-Store-ID":1},data:JSON.stringify({username:t,pass_md5_hash:e})}).done(function(e){console.log("Logged");var a=e.store_id;localStorage.setItem("store_id",a),$.ajax({url:"https://api.e-com.plus/v1/_authenticate.json",method:"POST",dataType:"json",contentType:"application/json; charset=UTF-8",headers:{"X-Store-ID":a},data:JSON.stringify({_id:e._id,api_key:e.api_key})}).done(function(n){$.ajax({url:"https://admin.e-com.plus/session/new",method:"PUT",contentType:"application/json; charset=UTF-8",headers:{"X-Store-ID":a,"X-My-ID":n.my_id,"X-Access-Token":n.access_token},xhrFields:{withCredentials:!0}}).always(function(){var e=window.location.search.split("?service=")[1];if(e&&""!==e)window.location="https://"+e+".e-com.plus";else{sessionStorage.setItem("my_id",n.my_id),sessionStorage.setItem("access_token",n.access_token),sessionStorage.setItem("expires",n.expires),sessionStorage.setItem("username",t);var a=sessionStorage.getItem("go_to");a?sessionStorage.removeItem("go_to"):a="/",window.location=a}})}).fail(n)}).fail(n)}}),$(document).keypress(function(e){13===e.which&&$("#login-form").submit()})}else{var d=localStorage.getItem("store_id");if(r.my_id=r.access_token=null,0<d&&(r.my_id=sessionStorage.getItem("my_id"),r.access_token=sessionStorage.getItem("access_token")),!r.my_id||!r.access_token)return sessionStorage.setItem("go_to",window.location.href),void(window.location="/pages/login.html");$("#dashboard").fadeIn(),console.log("Hello #"+r.my_id+"\nStore #"+d),sessionStorage.removeItem("my_id"),sessionStorage.removeItem("access_token");var v={"X-Store-ID":d,"X-My-ID":r.my_id,"X-Access-Token":r.access_token},f=[],p=!1,g={},w=function(){if(f.length){var e=f.shift();setTimeout(function(){w()},500);var a=e.options;a.dataType="json",a.data&&(a.contentType="application/json; charset=UTF-8");var o=e.callback,n=$.ajax(a);n.done(function(e){"function"==typeof o?o(null,e):console.log(e)}),n.fail(function(e,a,n){var t=e.responseJSON;"function"==typeof o&&o(n,t),m(t),500<=e.status&&(console.log("API request with internal error response:"),console.log(e))})}else p=!1},b=function(e,a,n){a&&(e.data=JSON.stringify(a)),f.push({options:e,callback:n}),p||(p=!0,w())},y=function(e,a,n,t,o){var s=Date.now();g[s]={uri:e,method:a,callback:n,bodyObject:t};var i=a+" "+e;t&&(i+="\n"+JSON.stringify(t,null,2)),setTimeout(function(){var e=$("#modal-confirm-request");e.find("#api-request-control").data("request-id",s),console.log("Confirm request",i),null===I?(e.find(".modal-body > p").text(o),e.modal("show")):j()},400)},k=function(e,a,n,t){s();var o="https://api.e-com.plus/v1/"+e;switch(a){case"GET":case"POST":case"PATCH":case"PUT":break;case"DELETE":return void y(o,a,n,t,h({en_us:"You are going to delete a resource permanently, are you sure?",pt_br:"Você vai excluir um recurso permanentemente, tem certeza?"}));default:return void app.toast(h({en_us:"Invalid request method",pt_br:"Método de requisição inválido"}))}if("string"==typeof e&&""!==e){if(/^\$update\.json/.test(e))return I=null,void y(o,a,n,t,h({en_us:"You are going to do a bulk update, are you sure?",pt_br:"Você vai fazer uma atualização em massa, tem certeza?"}));b({url:o,headers:v,method:a},t,n)}else app.toast(h({en_us:"Invalid request endpoint",pt_br:"O endpoint da requisição é inválido"}))},_=function(e,a,n,t){var o="https://e-com.plus/api/v1/"+e;"GET"===a&&(o+="?store_id="+d),b({url:o,method:a},t,n)},C="https://apx-storage.e-com.plus/"+d+"/api/v1/",T=function(e,a,n){var t,o=C;if(e){if(o+="s3/"+e+".json",t="POST",/^delete/.test(e))return void y(o,t,a,n,h({en_us:"You are going to delete files permanently, are you sure?",pt_br:"Você vai excluir arquivos permanentemente, tem certeza?"}))}else t="GET";b({url:o,headers:v,method:t},n,a)};window.callApi=k,window.callStorageApi=T,window.callSearchApi=function(e,a,n,t){b({url:"https://apx-search.e-com.plus/api/v1/"+e,headers:{"X-Store-ID":d},method:a},t,n)},window.Tabs={},window.loadContent=function(e,a){a.hide();var n=a.closest(".ajax-content");n.addClass("ajax"),$.ajax({url:e,dataType:"html",timeout:6e3}).done(function(e){a.html(e).fadeIn()}).fail(function(e,a,n){app.toast(h({en_us:e.status+" error, cannot load HTML content",pt_br:"Erro "+e.status+", não foi possível carregar o conteúdo HTML"}))}).always(function(){setTimeout(function(){n.removeClass("ajax")},400)})};var S,I=null,j=function(e){var a=$("#api-request-control").data("request-id");if(a&&g.hasOwnProperty(a)){var n=g[a],t=n.callback;if(n.callback=function(e,a){null!==I&&(S=setTimeout(function(){I=null},500)),"function"==typeof t&&t(e,a)},S&&(clearTimeout(S),S=null),void 0!==e?I=$("#skip-next-confirms").is(":checked")?e:null:e=I,e){var o={url:n.uri,headers:v,method:n.method};b(o,n.bodyObject,n.callback),delete g[a]}else setTimeout(function(){n.callback(new Error("Request rejected"),null)},200)}};$("#confirm-api-request").click(function(){j(!0)}),$("#discard-api-request").click(function(){j(!1)}),$(window).on("beforeunload",function(e){var a="Are you sure you want to leave?";return e.returnValue=a});var x,O,A={},P=null,M=!1,q=!1,D=function(e,a){if(!0!==M){var n=Date.now();A[P=n]={tabTitle:null,routesHistory:[],saveAction:!1,actionTitle:null},$("#route-content").append('<div id="app-tab-'+n+'"></div>');var t=$("#new-nav-item").clone().attr("id","app-nav-"+n);t.prependTo("#app-nav-tabs").toggle("slide"),t.children("a").attr("data-tab",n).click(N).click(),t.children(".close-tab").click(function(){z(n)}),a&&("#/new"===window.location.hash?J():window.location="/#/new")}"function"==typeof e&&e()},N=function(){if(!0!==M){P=parseInt($(this).attr("data-tab"),10);var e=function(){var e=$("#app-tab-"+P),a=e.children();a.hide(),e.addClass("app-current-tab"),a.fadeIn(100),U(A[P].tabTitle);var n=A[P].hash;void 0!==n&&(""===n&&(n="#/"),n!==window.location.hash&&(q=!0,window.location="/"+n))},a=$("#route-content > .app-current-tab");a.length?($("#app-nav-tabs .active").removeClass("active"),a.children().fadeOut(200,function(){a.removeClass("app-current-tab"),e()})):e(),$(this).addClass("active")}};$("#new-tab").click(function(){D(null,!0)});var z=function(e){if(!0!==M){var a=A[e];if(a){if(!0===a.unsavedChanges)return $("#app-nav-"+e+" > a").click(),x=null,void setTimeout(function(){$("#modal-unsaved").modal("show")},100);if(delete A[e],delete window.Tabs[e],e===P){var n=Object.keys(A);0===n.length?D(null,!0):$("#app-nav-"+n[n.length-1]+" > a").click()}$("#app-tab-"+e).remove(),$("#app-nav-"+e).toggle("slide",function(){$(this).remove()})}}};$("#close-current-tab").click(function(){z(P)});var E=function(e,n){if(!n){if(!0===M)return;null!==P&&A[P].routesHistory.push(e)}M=!0,window.routeParams=[];for(var a=e.split("/"),t="routes/"+a[0]+".html",o=1;o<a.length;o++)""!==a[o]&&window.routeParams.push(a[o]);$("#router > .loading").show(),$.ajax({url:t,dataType:"html",timeout:1e4}).done(function(e){var a=$("#app-tab-"+P);window.tabId=P,window.elTab=a,window.Tabs[P]={state:window.Tabs[P]?window.Tabs[P].state:{}},n||(O=setTimeout(function(){E("408",!0)},1e4)),a.html(e)}).fail(function(e,a,n){if(404===e.status)window.e404();else{var t;switch(a){case"abort":t="400";break;case"timeout":t="504";break;default:console.error(n),t="500"}E(t,!0)}})},R=function(e){var a=window.Tabs[P].pagination;"function"==typeof a&&a(e)};window.renderContentIds=function(e){var a=window.tabId;e||(e=window.elTab);var n="t"+a+"-";e.find("[data-id]").each(function(){$(this).attr("id",n+$(this).data("id"))}),e.find("[data-id-href]").each(function(){$(this).attr("href","#"+n+$(this).data("id-href"))})},window.routeReady=function(e){M=!1,clearTimeout(O),O=null,void 0!==e&&$("#app-nav-"+window.tabId+" > a").text(e),$("#router > .loading").fadeOut(),window.elTab.children().fadeIn(),A[P].tabTitle=e,U(e)};var U=function(e){e||(e="Dashboard"),document.title=e+" · E-Com Plus"};window.e404=function(){E("404",!0)};var L=function(e){if("#/new"!==e)for(var a in A)if(A.hasOwnProperty(a)&&A[a].hash===e)return $("#app-nav-"+a+" > a").click(),X(),!1;return!0},J=function(){var e=window.location.hash,a=e.slice(2);if(""!==a){var n=A[P];if(q)q=!1;else{if(!L(e))return;if(!0===M&&B())return;if(!0===n.unsavedChanges&&B())return $("#modal-unsaved").modal("show"),void(x=a);E(a),n&&n.saveAction&&(n.saveAction=!1,n.saveCallback=n.actionTitle=null)}n&&(n.hash=e,X())}else window.location="/#/home"};$(window).on("hashchange",J);var B=function(){if(null!==P){var e=A[P].routesHistory;if(0<e.length)return q=!0,window.location="/#/"+e[e.length-1],!0}return!1};$(".previous-route").click(function(){var e="/#/";if(null!==P){var a=A[P].routesHistory;if(0<=a.length-2)a.pop(),e+=a.pop()}window.location=e}),$("#ignore-unsaved").click(function(){var e=A[P];e&&(e.unsavedChanges=!1,x?window.location="/#/"+x:z(P))});var V=function(){var e=A[P];if(e){var a=function(){e.unsavedChanges=!1,e&&"function"==typeof e.saveCallback&&e.saveCallback(function(e){if(e===P){var a=$("#action-todo"),n=$("#action-done");a.fadeOut(200,function(){n.fadeIn(400,function(){setTimeout(function(){n.fadeOut(200,function(){a.fadeIn()})},800)})})}})};e.unsavedChanges?a():setTimeout(function(){e.unsavedChanges?a():app.toast(h({en_us:"Nothing to save",pt_br:"Não há alteração a ser salva"}))},300)}};$("#action-save").click(V);var F=!1,G=function(){var a=A[P];if(a)if(null===a.actionTitle){var e=!0;if(window.elTab){var n=window.elTab.find("input.action-title");if(n.length){var t=function(e){a.actionTitle=e,$("#action-title").text(e)};n.change(function(){t($(this).val())}),t(n.val()),e=!1}}!0===e&&$("#action-title").text("")}else $("#action-title").text(a.actionTitle);$("#topbar-action").fadeIn(),F=!0},H=function(){$("#topbar-action").fadeOut(),F=!1},X=function(){var e=A[P];e&&(e.saveAction?G():F&&H(),function(){var e,a=$("#sidebar"),n=a.find(".menu-link").filter(function(){return"/#/"===$(this).attr("href").slice(0,3)}),t=function(e,a){e[a]("active"),e.parent(".menu-submenu").parent()[a]("active")};if(t(n.parent(".active"),"removeClass"),n.each(function(){if($(this).attr("href")==="/"+window.location.hash)return t($(this).parent(),"addClass"),!(e=!0)}),!e&&window.routeParams.length){var o=a.find('li[data-route-param="'+window.routeParams[0]+'"]');o.length&&t(o,"addClass")}}())};window.setSaveAction=function(e,a){var n=A[P];if(n){if(e){n.unsavedChanges=!1;try{e.submit(V)}catch(e){console.error(e)}}n.saveAction=!0,n.saveCallback=a,G()}},window.unsetSaveAction=function(){var e=A[P];e&&(e.saveAction=!1,e.saveCallback=null,H())},window.triggerUnsaved=function(e){var a=A[e];a&&!0!==a.unsavedChanges&&(a.unsavedChanges=!0)},window.apiResources={products:{label:{en_us:"Products",pt_br:"Produtos"},icon:"tag"},orders:{label:{en_us:"Orders",pt_br:"Pedidos"},icon:"inbox"},brands:{label:{en_us:"Brands",pt_br:"Marcas"},icon:"trademark"},categories:{label:{en_us:"Categories",pt_br:"Categorias"},icon:"bookmark"},collections:{label:{en_us:"Collections",pt_br:"Coleções"},icon:"th-large"},grids:{label:{en_us:"Grids",pt_br:"Grades"},icon:"filter"},customers:{label:{en_us:"Customers",pt_br:"Clientes"},icon:"users"},carts:{label:{en_us:"Carts",pt_br:"Carrinhos"},icon:"shopping-cart"},authentications:{label:{en_us:"Users",pt_br:"Usuários"},icon:"id-card"}};!function(){var e=function(e,a){var n,t="";if(a)for(var o=0;o<a.length;o++){var s=a[o];t+='<li class="menu-item" data-route-param="'+s+'"><a class="menu-link" href="/#/resources/'+s+'"><span class="icon fa fa-'+(n=window.apiResources[s]).icon+'"></span><span class="title">'+h(n.label)+"</span></a></li>"}n=window.apiResources[e];var i=h(n.label),r=i.toLowerCase();return'<li class="menu-item" id="'+e+'-menu" data-route-param="'+e+'"><a class="menu-link" href="javascript:;"><span class="icon fa fa-'+n.icon+'"></span><span class="title">'+i+'</span><span class="arrow"></span></a><ul class="menu-submenu"><li class="menu-item"><a class="menu-link" href="/#/resources/'+e+'"><span class="icon fa fa-th-list"></span><span class="title">'+c.all_the+" "+r+'</span></a></li><li class="menu-item"><a class="menu-link" href="/#/resources/'+e+'/new"><span class="icon fa fa-plus"></span><span class="title">'+c.create+" "+r.slice(0,-1)+"</span></a></li>"+t+"</ul></li>"},a='<li class="menu-item"><a class="menu-link" href="/#/home"><span class="icon fa fa-home"></span><span class="title">'+c.home+"</span></a></li>"+e("orders",["customers","carts"])+e("products",["brands","categories","collections","grids"])+'<li class="menu-item"><a class="menu-link" href="/#/apps"><span class="icon fa fa-puzzle-piece"></span><span class="title">Apps</span></a></li><li class="menu-item"><a class="menu-link" href="javascript:;" onclick="initStorageLib()" data-toggle="quickview" data-target="#qv-storage"><span class="icon fa fa-picture-o"></span><span class="title">'+c.media+'</span></a></li><li class="menu-item"><a class="menu-link" href="/#/settings"><span class="icon fa fa-cogs"></span><span class="title">'+c.settings+'</span></a></li><li class="menu-category" onclick="newChannel()">'+c.channels+'<i class="fa fa-plus-circle"></i></li>',n=$("#sidebar");n.append(a);var t=$("<span />",{class:"badge badge-primary"});n.find("#orders-menu > a > .title").after(t);var o=function(){k("$count.json","POST",function(e,a){e||t.text(a.count)},{resource:"orders"})};setTimeout(function(){o(),setInterval(o,6e4)},600),$(".sidebar-toggler").is(":visible")&&sidebar.unfold()}();var K,Y,W=[];window.newChannel=function(){if(W.length){var e=K.$main.additional_channels_cost;if(void 0===e)return;var a=$("#channel-price");a.children("strong").text(window.formatMoney(e)),a.show()}$("#modal-channel").modal("show")},T(null,function(e,a){if(e)console.error(e);else if(a.host){var d="https://"+a.host+"/",c=null;window.setImagesCallback=function(e){c=e,l=[]};var l=[],s=function(e){"function"==typeof c&&(c(e,l),c=null)};$("#uploads-done").click(function(){s()});var f,p={zoom:{path:""},small:{size:100,path:"imgs/100px/"},normal:{size:400,path:"imgs/400px/"},big:{size:700,path:"imgs/700px/"}},i=function(){var a=[];return $("#storage-content a.active").each(function(){var e=$(this).data("key");e&&a.push(e)}),a},r=function(){$("#storage-content a.active").removeClass("active")};$("#storage-select").click(function(){var e=i();if(e.length){for(var a=0;a<e.length;a++){var n=e[a].replace(/^.*(@.*)$/,"$1"),t={};for(var o in p)p.hasOwnProperty(o)&&(t[o]={url:d+p[o].path+n});l.push(t)}r()}s()}),$("#storage-delete").click(function(){var e=i();e.length?(!function(e){for(var a=[],n=0;n<e.length;n++){var t=e[n].replace(/^.*(@.*)$/,"$1");for(var o in p)p.hasOwnProperty(o)&&a.push({Key:p[o].path+t})}var s={Delete:{Objects:a,Quiet:!0}},i=$("#storage-content").closest(".ajax-content");i.addClass("ajax");T("deleteObjects",function(e,a){e||u(),i.removeClass("ajax")},s)}(e),r()):app.toast(h({en_us:"No image selected to delete",pt_br:"Nenhuma imagem selecionada para deletar"}))}),$("#load-storage").click(function(){u(f)});var u=function(e){var c=$("#storage-content"),l=c.closest(".ajax-content");e||c.html(""),l.addClass("ajax");var u=$("#load-storage");u.attr("disabled",!0);var a={Prefix:p.normal.path,MaxKeys:15};e&&(a.Marker=e);T("listObjects",function(e,a){if(!e){var n=a.Contents;if(Array.isArray(n)){var t="",o=n.length,s=0,i=function(){o<=++s&&(a.IsTruncated&&(u.removeAttr("disabled"),a.NextMarker&&(f=a.NextMarker)),l.removeClass("ajax"),c.append(t).find(".storage-object").fadeIn())};if(0<o)for(var r=0;r<o;r++)!function(){var e=n[r].Key,a=new Image;a.onload=function(){t+='<div class="masonry-item storage-object"><a href="javascript:;" onclick="$(this).toggleClass(\'active\')" data-key="'+e+'"><img src="'+this.src+'"></a></div>',i()},a.src=d+e}();else i()}}},a)},n=new Dropzone("#dropzone",{url:C+"upload.json",headers:v});n.on("complete",function(a){try{var e=JSON.parse(a.xhr.responseText)}catch(e){return m(),void console.error(new Error("Upload filed"),a)}if("success"!==a.status&&m(e),"function"==typeof c&&"image/"===a.type.substr(0,6)&&e.key&&"success"===a.status){var n,t={};for(n in p)p.hasOwnProperty(n)&&(t[n]={url:d+p[n].path+e.key});if(a.height&&a.width){var o=a.width,s=a.height;for(n in t.zoom.size=o+"x"+s,p)if(p.hasOwnProperty(n)){var i=p[n].size;i&&(t[n].size=s<o?i+"x"+Math.round(s*i/o):Math.round(o*i/s)+"x"+i)}}if(a.name){var r=a.name.replace(/\.[^.]+$/,"");for(n in t)t.hasOwnProperty(n)&&(t[n].alt=r)}l.push(t)}}),window.upload=function(){n.removeAllFiles(),$("#modal-uploads").modal("show")};var t=null;window.editImage=function(e,a){t=e;var n=$("#modal-edit-image");a?n.find("input").each(function(){var e=a[$(this).attr("name")];e?$(this).val(e):$(this).val("")}):n.find("input").val(""),n.modal("show")},$("#edit-image").click(function(){if("function"==typeof t){var a={};$("#modal-edit-image input").each(function(){var e=$(this).val().trim();""!==e&&(a[$(this).attr("name")]=e)}),t(null,a)}}),$("#remove-image").click(function(){"function"==typeof t&&t(null,!1)}),window.initStorageLib=function(){void 0===f&&u()}}else console.log("Unexpected Storage API response:",a)}),k("stores/me.json","GET",function(e,a){e?n(e):(K=a,k("authentications/me.json","GET",function(e,a){e?n(e):(Y=a,Z(),Q())}))});var Q=function(){_("channels.json","GET",function(e,a){if(!e&&(W=a.result).length){for(var n=0;n<W.length;n++)W[n].domains=[];_("domains.json","GET",function(e,a){if(!e){for(var n=a.result,t=0;t<n.length;t++){for(var o=n[t].id,s=0;s<W.length;s++)n[t].channel_id===W[s].id&&W[s].domains.push(o);window.shopDomain||-1!==o.indexOf(".e-com.plus")&&t!==n.length-1||(window.shopDomain=o)}!function(){var e=$("#sidebar");e.find(".li-channel").remove();for(var a=0;a<W.length;a++){var n,t=W[a],o="/#/channels/"+t.id;n=t.domains.length?"https://"+t.domains[t.domains.length-1]:"#";var s=$("<li />",{class:"menu-item li-channel",html:'<a class="menu-link" href="javascript:;"><span class="icon fa fa-shopping-bag"></span><span class="title">'+t.title+'</span><span class="arrow"></span></a><ul class="menu-submenu"><li class="menu-item"><a class="menu-link" href="'+n+'" target="_blank"><span class="icon fa fa-eye"></span><span class="title">'+c.go_to_store+'</span></a></li><li class="menu-item"><a class="menu-link" href="'+o+'/themes"><span class="icon fa fa-paint-brush"></span><span class="title">'+c.themes+'</span></a></li><li class="menu-item"><a class="menu-link" href="'+o+'/settings"><span class="icon fa fa-wrench"></span><span class="title">'+c.settings+"</span></a></li></ul>"});e.append(s),s.slideDown("slow")}}()}})}})},Z=function(){D(function(){J()}),$(".qv-close").click(function(){quickview.close($(this).closest(".quickview"))}),$(".logout").click(function(){$("#modal-logout").modal("show")}),$("#logout").click(function(){$(window).off("beforeunload"),window.location="/"}),$("#new-channel").click(function(){var n={};$("#modal-channel").find("input,select").each(function(){var e=$(this).attr("name"),a=$(this).val();e&&a&&(n[e]=a)});k("@channels.json","POST",function(e){e||(Q(),$("#modal-channel input").val(""))},n)});var i=!1;$(document).mousedown(function(e){return(e.ctrlKey||2===e.which)&&(i=!0),!0}),$(document).click(function(e){if(!0===i){var a,n;for(i=!1,a=e.target;a&&void 0===n;)switch(a.nodeName){case"A":n=a;break;case"DIV":case"P":case"BUTTON":case"BODY":a=!1;break;default:a=a.parentElement}if(void 0===n||"string"!=typeof n.href)return!0;switch(n.href){case"javascript:;":case"#":return e.preventDefault(),!0}var t=n.href.split(window.location.origin+"/#");if(2===t.length){e.preventDefault();var o="#"+t[1];"#"!==o&&L(s=o)&&D(function(){window.location.hash===s?J():window.location="/"+s})}}var s});var o=$("#app-search");o.attr("placeholder",h({en_us:"Search",pt_br:"Pesquisar"}));var s={},a={},n=function(e){switch(Object.keys(s).length){case 1:switch(e.keyCode){case 37:$("#app-nav-"+P).prev().children("a").click();break;case 39:var a=$("#app-nav-"+P).next();"new-nav-item"!==a.attr("id")&&a.children("a").click();break;case 84:D(null,!0);break;case 87:z(P);break;case 83:e.preventDefault(),o.focus();break;case 81:$(".topbar img.avatar").click();break;case 77:dock.toggleMinimize("#dock-chat"),$("#mony-publish input").focus();break;case 74:R(!0);break;case 75:R()}break;case 2:var n,t=function(){switch(e.keyCode){case 80:return"/#/resources/products";case 79:return"/#/resources/orders";case 73:return"/#/resources/categories";case 85:return"/#/resources/customers";case 89:return"/#/resources/brands";case 84:return"/#/resources/carts";case 82:return"/#/resources/grids";case 69:return"/#/resources/collections";case 87:return"/#/resources/authentications"}};if(0===s[71])switch(e.keyCode){case 72:window.location="/#/home";break;case 83:window.location="/#/settings";break;case 65:window.location="/#/apps";break;default:(n=t())&&(window.location=n)}else 0===s[65]&&(n=t())&&(window.location=n+"/new");break;case 3:0===s[66]&&1===s[89]&&2===s[69]&&$("#logout").click()}},t=function(e){switch(e.target.nodeName){case"BODY":case"A":case"BUTTON":return!0;default:return!1}};$(document).keydown(function(e){return t(e)?!0===a[e.keyCode]||void(void 0!==s[e.keyCode]?(n(e),a[e.keyCode]=!0):s[e.keyCode]=Object.keys(s).length):27!==e.keyCode||void $(e.target).blur()}).keyup(function(e){if(!t(e))return!0;!0!==a[e.keyCode]?void 0!==s[e.keyCode]&&n(e):delete a[e.keyCode],delete s[e.keyCode]}),window.startMony(K,Y,r)};window.appReady()}});