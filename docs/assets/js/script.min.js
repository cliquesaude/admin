"use strict";app.config({autoload:!0,provide:["jsgrid","summernote","dropzone","typeahead","bloodhound","tagsinput","selectpicker","colorpicker"],googleApiKey:"",googleAnalyticsId:"",smoothScroll:!1,saveState:!1,cacheBust:""}),function(){var s;window.startMony=function(e,a,t){var n=!1,o=e.store_id,s=e.name,r=a.name.split(" ");r=r[0];var i=a.email,c=a._id,l=t.access_token,u=function(e,a){if(e&&""!==e){var t='<div class="'+(a?"media media-chat media-chat-reverse":"media media-chat")+'"><div class="media-body"><p>'+e+"</p></div></div>";$("#mony").append(t).scrollTop(9999)}};window.Mony.init(o,s,null,r,null,i,c,null,l,c,function(e){if(u(e),!1===n){$("#mony").html(""),n=!0;var a,t=(new Date).getHours();t<13?a="Bom dia":13<=t&&t<18?a="Boa tarde":18<=t&&(a="Boa noite"),u(a+=" "+r+", em que posso te ajudar?")}});var d=function(){var e=$("#dock-chat .publisher-input"),a=e.val();""!==a&&(u(a,!0),window.Mony.sendMessage(a),e.val(""))};$("#dock-chat .publisher-btn").click(d),$("#dock-chat .publisher-input").keypress(function(e){13===e.which&&d()})},window.appReady=function(){"pt_br"===window.lang?($.getScript("/assets/vendor/jsgrid/i18n/jsgrid-pt-br.js",function(){jsGrid.locale("pt-br")}),$.getScript("/assets/vendor/summernote/lang/summernote-pt-BR.js",function(){$.summernote.options.lang="pt-BR"}),s=","):s=".",$("select").selectpicker({style:"btn-light",noneSelectedText:"--",windowPadding:70}),$.fn.selectRange=function(e,a){var t=$(this)[0];if(t)if(t.setSelectionRange)t.focus(),t.setSelectionRange(e,a);else if(t.createTextRange){var n=t.createTextRange();n.collapse(!0),n.moveEnd("character",a),n.moveStart("character",e),n.select()}else t.selectionStart&&(t.selectionStart=e,t.selectionEnd=a)}},window.keyIsNumber=function(e){if(13!==e.which&&8!==e.which){var a=e.which?e.which:e.keyCode;return 95<a&&a<106&&(a-=48),!isNaN(String.fromCharCode(a))||(e.preventDefault(),!1)}},window.fixScrollbars=function(e){e.find(".scrollable").perfectScrollbar({wheelPropagation:!1,wheelSpeed:.5})},window.formatMoney=function(a,e,t){var n;e||(e="BRL"),t||(t=window.lang),t=t?t.replace("_","-"):"pt-BR";try{n=a.toLocaleString(t,{style:"currency",currency:e})}catch(e){n=a}return n},window.stringToNumber=function(e){return"."!==s&&(e=e.replace(/\./g,"").replace(s,".")),-1===(e=e.replace(/[^0-9-.]/g,"")).indexOf(".")?parseInt(e,10):parseFloat(e)},window.numberToString=function(e,a,t){var n,o;a?(n=e.toString(),"."!==s?(n=n.replace(".",s),o="."):o=",",n=n.replace(/\B(?=(\d{3})+(?!\d))/g,o),t&&-1===n.indexOf(s)&&(n+=s+"00")):n=parseInt(e,10).toString();return n},window.newTabLink=function(e){var a=window.open(e,"_blank");a&&a.focus()},window.cutString=function(e,a,t){if(a<e.length){var n=e.substr(0,a+1);return n=n.substr(0,n.lastIndexOf(" ")),t?n+t:n}return e},window.getFromDotNotation=function(e,a){var t=a.split(".");if(t.length<=1)return e[a];for(var n=0;n<t.length;n++){if("object"!=typeof e||null===e)return;e=e[t[n]]}return e},window.getProperties=function(e,a){for(var t=a.split(","),n={},o=0;o<t.length;o++){var s=t[o];n[s]=e[s]}return n},window.clearAccents=function(e,a){return e=e.replace(/[çć]/g,"c").replace(/[ÇĆ]/g,"C").replace(/[áâãà]/g,"a").replace(/[ÁÂÃÀ]/g,"A").replace(/[éêẽ]/g,"e").replace(/[ÉÊẼ]/g,"E").replace(/[íîĩ]/g,"i").replace(/[ÍÎĨ]/g,"I").replace(/[óôõ]/g,"o").replace(/[ÓÔÕ]/g,"O").replace(/[úûõ]/g,"u").replace(/[ÚÛŨ]/g,"U"),a&&("string"!=typeof a&&(a=""),e=e.replace(/[\s\n]/g,a)),e},window.normalizeString=function(e){return clearAccents(e.toLowerCase(),"_")},window.randomInt=function(e,a){return Math.floor(Math.random()*(a-e))+e},window.objectIdPad=function(e,a){return e.substring(0,24-a.length)+a},window.randomObjectId=function(){for(var e=randomInt(1e4,99999)+"0"+Date.now();e.length<24;)e+="0";return e},window.substringMatcher=function(s){return function(e,a){var t,n,o;t="function"==typeof s?s():s,n=[],o=new RegExp(e,"i"),$.each(t,function(e,a){o.test(a)&&n.push(a)}),a(n)}},window.handleInputs=function(r,i){r.find('input[type="checkbox"]').change(function(){i($(this),!0)}),r.find('input[type="radio"]').change(function(){var e=r.find('input[name="'+$(this).attr("name")+'"]:checked');i(e);var a=e.data("disable");a&&r.find('[name="'+a+'"]').each(function(){$(this).data("enable-value")===e.val()?$(this).removeAttr("disabled").focus():$(this).attr("disabled",!0).val("").trigger("change")})}),r.find('input[type="text"],select,textarea').change(function(){i($(this));var e=$(this).data("fill-field");if(e){var a=r.find('[name="'+e+'"]'),t=$(this).val(),n=a.data("fill-clear-accents");n&&(t=clearAccents(t,n)),"lower"===a.data("fill-case")&&(t=t.toLowerCase());var o=a.data("fill-pattern");o&&(t=t.replace(new RegExp(o,"g"),""));var s=a.attr("maxlength");s&&(t=t.substr(0,parseInt(s,10))),a.val(t).trigger("change")}}),r.find('input[type="tel"],input[type="number"]').change(function(){i($(this))});var e=r.find("input[data-money]");if(e.length){var a=formatMoney(0);e.attr("placeholder",a);var t={prefix:a.replace(/0.*/,""),allowNegative:!0,decimal:s};t.thousands="."===s?",":".",e.maskMoney(t)}r.find('input[type="number"]').keydown(function(e){var a=[46,8,9,27,13],t=$(this).attr("step");!t||"any"!==t&&-1===t.indexOf(".")||a.push(110,188,190);var n=$(this).attr("min");(!n||parseInt(n,10)<0)&&a.push(109,173,189),-1!==$.inArray(e.keyCode,a)||-1!==$.inArray(e.keyCode,[65,67,86,88])&&(!0===e.ctrlKey||!0===e.metaKey)||35<=e.keyCode&&e.keyCode<=40||(e.shiftKey||e.keyCode<48||57<e.keyCode)&&(e.keyCode<96||105<e.keyCode)&&e.preventDefault()})},window.setupInputValues=function(e,a,t,n){for(var o in t||(t=""),a){var s,r=a[o],i=e.find('[name="'+t+o+'"]:not(:disabled)');if(n&&(i=i.filter(function(){return $(this).data("object-id")===n})),i.length){if(!i.is("input:file"))switch(typeof r){case"string":"radio"!==i.attr("type")?i.val(r):i.filter(function(){return $(this).val()===r}).click();break;case"number":i.data("money")?i.val(formatMoney(r)):"number"===i.attr("type")?i.val(r):i.val(numberToString(r,!i.data("integer")));break;case"object":if(Array.isArray(r)){var c=[];for(s=0;s<r.length;s++){var l=r[s];"string"!=typeof l?c.push(JSON.stringify(l)):c.push(l)}i.val(c)}else null!==r&&i.val(JSON.stringify(r));break;case"boolean":r?i.attr("checked",!0):i.removeAttr("checked")}}else if("object"==typeof r&&null!==r){var u=t+o+".";if(Array.isArray(r)){if(r[0]&&"object"==typeof r[0]&&r[0]._id)for(s=0;s<r.length;s++)setupInputValues(e,r[s],u,r[s]._id)}else setupInputValues(e,r,u)}}},window.getCombinations=function(e,a,t,n){void 0===a&&(a=0),t||(t=[]),n||(n={});var o=Object.keys(e),s=o[a],r=e[s];if(Array.isArray(r))for(var i=0;i<r.length;i++)if(n[s]=r[i],a+1<o.length)getCombinations(e,a+1,t,n);else{var c=Object.assign({},n);t.push(c)}return t}}(),app.ready(function(){var e,n={},a=function(){for(var e in n)n.hasOwnProperty(e)&&sessionStorage.setItem(e,n[e]);$(window).off("beforeunload"),location.reload()},t=function(e){e&&console.error(e),alert(h({en_us:"Fatal error, restarting in 3 seconds",pt_br:"Erro fatal, reiniciando em 3 segundos"})),setTimeout(function(){a()},3e3)},o=localStorage.getItem("lang");o&&/^[a-z]{2}(_[a-z]{2})?$/.test(o)||(o="pt_br"),window.lang=o,(e=$('#langs-menu [data-lang="'+o+'"]')).addClass("active"),$("#current-lang").find("img").attr("src",e.find("img").attr("src")).next().text(o.split("_")[0].toUpperCase()),$("#langs-menu > a").click(function(){localStorage.setItem("lang",$(this).data("lang")),a()});var h=function(e){if("object"==typeof e&&null!==e){if(e.hasOwnProperty("en_us"))return e.hasOwnProperty(o)?e[o]:e.en_us;for(var a in e)e.hasOwnProperty(a)&&(e[a]=h(e[a]))}return e};window.i18n=h,$("head").append('<style type="text/css">.i18n > [data-lang="'+o+'"]{display: inline;}</style>'),$(".after-i18n").fadeIn();var c={home:h({en_us:"Home",pt_br:"Início"}),resources:h({en_us:"Resources",pt_br:"Recursos"}),channels:h({en_us:"Sales channels",pt_br:"Canais de venda"}),media:h({en_us:"Media",pt_br:"Mídia"}),go_to_store:h({en_us:"Go to store",pt_br:"Ir à loja"}),themes:h({en_us:"Themes",pt_br:"Temas"}),settings:h({en_us:"Settings",pt_br:"Configurações"}),all_the:h({en_us:"All the",pt_br:"Todos os"}),create:h({en_us:"Add",pt_br:"Adicionar"}),unknown_error:h({en_us:"Unknown error, please try again",pt_br:"Erro desconhecido, por favor tente novamente"})},s=function(){$("div.toast.reveal").removeClass("reveal")},r=app.toast;app.toast=function(e){if("string"!=typeof e&&e)try{e=JSON.stringify(e)}catch(e){return void console.error(e)}r(e)};var i,m=function(e){var a;"object"==typeof e&&null!==e&&(e.hasOwnProperty("user_message")?a=e.user_message[o]:e.hasOwnProperty("message")&&(a=e.message)),void 0!==a?console.log("API Error Code: "+e.error_code):a=c.unknown_error,app.toast(a,{duration:7e3})};if("boolean"==typeof login&&!0===login){!function(t){var n,o=function(){n=["/assets/img/bg/coffee.jpg","/assets/img/bg/notebook.jpg","/assets/img/bg/numbers.jpg","/assets/img/bg/pens.jpg","/assets/img/bg/table.jpg","/assets/img/bg/writer.jpg"]};o();var e=function(){var e=new Image;e.onload=function(){var e=this;$(t).fadeOut(1e3,function(){$(this).css("background-image","url("+e.src+")").fadeIn()})};var a=Math.floor(Math.random()*(n.length-1));e.src=n[a],n.splice(a,1),0===n.length&&o()};e(),setInterval(e,6e4)}("#full-bg");var l=(i=[{msg:{en_us:"Start where you are. Use what you have. Do what you can.",pt_br:"Comece de onde você está. Use o que você tiver. Faça o que você puder."},author:"Arthur Ashe"},{msg:{en_us:"Success is the sum of repeated small efforts day after day.",pt_br:"O sucesso é a soma de pequenos esforços repetidos dia após dia."},author:"Robert Collier"},{msg:{en_us:"All progress takes place outside the comfort zone.",pt_br:"Todo progresso acontece fora da zona de conforto."},author:"Michael John Bobak"},{msg:{en_us:"Courage is the resistance and mastery of fear, not its absence.",pt_br:"Coragem é a resistência e o domínio do medo, não a ausência dele."},author:"Mark Twain"},{msg:{en_us:"The only place where success comes before work is in the dictionary.",pt_br:"O único lugar em que o sucesso vem antes do trabalho é no dicionário."},author:"Vidal Sassoon"},{msg:{en_us:"To dream small and big requires the same work.",pt_br:"Sonhar grande e sonhar pequeno dá o mesmo trabalho."},author:"Jorge Paulo Lemann"},{msg:{en_us:"If you want to live and are curious, sleeping is not the most important thing.",pt_br:"Se você tem vontade de viver e curiosidade, dormir não é a coisa mais importante."},author:"Martha Stewart"},{msg:{en_us:"Do or do not, there is no try.",pt_br:"Faça ou não faça. Tentativas não existem."},author:"Yoda"},{msg:{en_us:"You don't need a company with 100 people to develop this idea.",pt_br:"Você não precisa de uma equipe de 100 pessoas para desenvolver uma ideia."},author:"Larry Page"},{msg:{en_us:"Do not let what you cannot do interfere with what you can do.",pt_br:"Não deixe o que você não pode fazer interferir no que você pode fazer."},author:"John Wooden"},{msg:{en_us:"Winners never quit and quitters never win.",pt_br:"Vencedores nunca desistem e quem desiste nunca vence."},author:"Vince Lombardi"}])[Math.floor(Math.random()*(i.length-1))];(e=$("#quote-of-day")).find('[data-lang="en_us"]').text('"'+l.msg.en_us+'"'),e.find('[data-lang="pt_br"]').text('"'+l.msg.pt_br+'"'),e.find("cite").text(l.author);var u=localStorage.getItem("username");u&&$("#username").val(u),$("#username, #password").change(function(){""!==$(this).val()&&$(this).parent().addClass("do-float")}).trigger("change"),$("#login-form").submit(function(){if(!$(this).hasClass("ajax")){s();var t=$("#username").val(),e=md5($("#password").val());$("#remember").is(":checked")?localStorage.setItem("username",t):localStorage.removeItem("username");var n=$(this);n.addClass("ajax");var o=function(e,a,t){403!==e.status&&console.error(t),m(e.responseJSON),n.removeClass("ajax")};$.ajax({url:"https://api.e-com.plus/v1/_login.json?username",method:"POST",dataType:"json",contentType:"application/json; charset=UTF-8",headers:{"X-Store-ID":1},data:JSON.stringify({username:t,pass_md5_hash:e})}).done(function(e){console.log("Logged");var a=e.store_id;localStorage.setItem("store_id",a),$.ajax({url:"https://api.e-com.plus/v1/_authenticate.json",method:"POST",dataType:"json",contentType:"application/json; charset=UTF-8",headers:{"X-Store-ID":a},data:JSON.stringify({_id:e._id,api_key:e.api_key})}).done(function(e){sessionStorage.setItem("my_id",e.my_id),sessionStorage.setItem("access_token",e.access_token),sessionStorage.setItem("expires",e.expires),sessionStorage.setItem("username",t);var a=sessionStorage.getItem("go_to");a?sessionStorage.removeItem("go_to"):a="/",window.location=a}).fail(o)}).fail(o)}}),$(document).keypress(function(e){13===e.which&&$("#login-form").submit()})}else{var d=localStorage.getItem("store_id");if(n.my_id=n.access_token=null,0<d&&(n.my_id=sessionStorage.getItem("my_id"),n.access_token=sessionStorage.getItem("access_token")),!n.my_id||!n.access_token)return sessionStorage.setItem("go_to",window.location.href),void(window.location="/pages/login.html");$("#dashboard").fadeIn(),console.log("Hello #"+n.my_id+"\nStore #"+d),sessionStorage.removeItem("my_id"),sessionStorage.removeItem("access_token");var v={"X-Store-ID":d,"X-My-ID":n.my_id,"X-Access-Token":n.access_token},p=[],f=!1,g={},w=function(){if(p.length){var e=p.shift();setTimeout(function(){w()},500);var a=e.options;a.dataType="json",a.data&&(a.contentType="application/json; charset=UTF-8");var o=e.callback,t=$.ajax(a);t.done(function(e){"function"==typeof o?o(null,e):console.log(e)}),t.fail(function(e,a,t){var n=e.responseJSON;"function"==typeof o&&o(t,n),m(n),500<=e.status&&(console.log("API request with internal error response:"),console.log(e))})}else f=!1},b=function(e,a,t){a&&(e.data=JSON.stringify(a)),p.push({options:e,callback:t}),f||(f=!0,w())},y=function(e,a,t,n,o){var s=Date.now();g[s]={uri:e,method:a,callback:t,bodyObject:n};var r=a+" "+e;n&&(r+="\n"+JSON.stringify(n,null,2)),setTimeout(function(){var e=$("#modal-confirm-request");e.find("#api-request-control").data("request-id",s),e.find(".modal-body > p").text(o),console.log("Confirm request",r),e.modal("show")},400)},k=function(e,a,t,n){s();var o="https://api.e-com.plus/v1/"+e;switch(a){case"GET":case"POST":case"PATCH":case"PUT":break;case"DELETE":return void y(o,a,t,n,h({en_us:"You are going to delete a resource permanently, are you sure?",pt_br:"Você vai excluir um recurso permanentemente, tem certeza?"}));default:return void app.toast(h({en_us:"Invalid request method",pt_br:"Método de requisição inválido"}))}"string"==typeof e&&""!==e?/^\$update\.json/.test(e)?y(o,a,t,n,h({en_us:"You are going to do a bulk update, are you sure?",pt_br:"Você vai fazer uma atualização em massa, tem certeza?"})):b({url:o,headers:v,method:a},n,t):app.toast(h({en_us:"Invalid request endpoint",pt_br:"O endpoint da requisição é inválido"}))},_=function(e,a,t,n){var o="https://e-com.plus/api/v1/"+e;"GET"===a&&(o+="?store_id="+d),b({url:o,method:a},n,t)},C="https://apx-storage.e-com.plus/"+d+"/api/v1/",S=function(e,a,t){var n,o=C;if(e){if(o+="s3/"+e+".json",n="POST",/^delete/.test(e))return void y(o,n,a,t,h({en_us:"You are going to delete files permanently, are you sure?",pt_br:"Você vai excluir arquivos permanentemente, tem certeza?"}))}else n="GET";b({url:o,headers:v,method:n},t,a)};window.callApi=k,window.callStorageApi=S,window.callSearchApi=function(e,a,t,n){b({url:"https://apx-search.e-com.plus/api/v1/"+e,headers:{"X-Store-ID":d},method:a},n,t)},window.Tabs={},window.loadContent=function(e,a){a.hide();var t=a.closest(".ajax-content");t.addClass("ajax"),$.ajax({url:e,dataType:"html",timeout:6e3}).done(function(e){a.html(e).fadeIn()}).fail(function(e,a,t){app.toast(h({en_us:e.status+" error, cannot load HTML content",pt_br:"Erro "+e.status+", não foi possível carregar o conteúdo HTML"}))}).always(function(){setTimeout(function(){t.removeClass("ajax")},400)})};var T=function(e,a){var t=e.closest("#api-request-control").data("request-id");if(t&&g.hasOwnProperty(t))if(a){var n=g[t],o={url:n.uri,headers:v,method:n.method};b(o,n.bodyObject,n.callback),delete g[t]}else{var s=g[t].callback;"function"==typeof s&&s(new Error("Request rejected"),null)}};$("#confirm-api-request").click(function(){T($(this),!0)}),$("#discard-api-request").click(function(){T($(this),!1)}),$(window).on("beforeunload",function(e){var a="Are you sure you want to leave?";return e.returnValue=a});var j,I,x={},O=null,A=!1,P=!1,q=function(e,a){if(!0!==A){var t=Date.now();x[O=t]={tabTitle:null,routesHistory:[],saveAction:!1,actionTitle:null},$("#route-content").append('<div id="app-tab-'+t+'"></div>');var n=$("#new-nav-item").clone().attr("id","app-nav-"+t);n.prependTo("#app-nav-tabs").toggle("slide"),n.children("a").attr("data-tab",t).click(M).click(),n.children(".close-tab").click(function(){D(t)}),a&&("#/new"===window.location.hash?R():window.location="/#/new")}"function"==typeof e&&e()},M=function(){if(!0!==A){O=parseInt($(this).attr("data-tab"),10);var e=function(){var e=$("#app-tab-"+O),a=e.children();a.hide(),e.addClass("app-current-tab"),a.fadeIn(100),z(x[O].tabTitle);var t=x[O].hash;void 0!==t&&(""===t&&(t="#/"),t!==window.location.hash&&(P=!0,window.location="/"+t))},a=$("#route-content > .app-current-tab");a.length?($("#app-nav-tabs .active").removeClass("active"),a.children().fadeOut(200,function(){a.removeClass("app-current-tab"),e()})):e(),$(this).addClass("active")}};$("#new-tab").click(function(){q(null,!0)});var D=function(e){if(!0!==A){var a=x[e];if(a){if(!0===a.unsavedChanges)return $("#app-nav-"+e+" > a").click(),j=null,void setTimeout(function(){$("#modal-unsaved").modal("show")},100);if(delete x[e],delete window.Tabs[e],e===O){var t=Object.keys(x);0===t.length?q(null,!0):$("#app-nav-"+t[t.length-1]+" > a").click()}$("#app-tab-"+e).remove(),$("#app-nav-"+e).toggle("slide",function(){$(this).remove()})}}};$("#close-current-tab").click(function(){D(O)});var N=function(e,t){if(!t){if(!0===A)return;null!==O&&x[O].routesHistory.push(e)}A=!0,window.routeParams=[];for(var a=e.split("/"),n="routes/"+a[0]+".html",o=1;o<a.length;o++)""!==a[o]&&window.routeParams.push(a[o]);$("#router > .loading").show(),$.ajax({url:n,dataType:"html",timeout:1e4}).done(function(e){var a=$("#app-tab-"+O);window.tabId=O,window.elTab=a,window.Tabs[O]={},t||(I=setTimeout(function(){N("408",!0)},1e4)),a.html(e)}).fail(function(e,a,t){if(404===e.status)window.e404();else{var n;switch(a){case"abort":n="400";break;case"timeout":n="504";break;default:console.error(t),n="500"}N(n,!0)}})};window.renderContentIds=function(e){var a=window.tabId;e||(e=window.elTab);var t="t"+a+"-";e.find("[data-id]").each(function(){$(this).attr("id",t+$(this).data("id"))}),e.find("[data-id-href]").each(function(){$(this).attr("href","#"+t+$(this).data("id-href"))})},window.routeReady=function(e){A=!1,clearTimeout(I),I=null,void 0!==e&&$("#app-nav-"+window.tabId+" > a").text(e),$("#router > .loading").fadeOut(),window.elTab.children().fadeIn(),x[O].tabTitle=e,z(e)};var z=function(e){e||(e="Dashboard"),document.title=e+" · E-Com Plus"};window.e404=function(){N("404",!0)};var E=function(e){if("#/new"!==e)for(var a in x)if(x.hasOwnProperty(a)&&x[a].hash===e)return $("#app-nav-"+a+" > a").click(),G(),!1;return!0},R=function(){var e=window.location.hash,a=e.slice(2);if(""!==a){var t=x[O];if(P)P=!1;else{if(!E(e))return;if(!0===A&&B())return;if(!0===t.unsavedChanges&&B())return $("#modal-unsaved").modal("show"),void(j=a);N(a),t&&t.saveAction&&(t.saveAction=!1,t.saveCallback=t.actionTitle=null)}t&&(t.hash=e,G())}else window.location="/#/home"};$(window).on("hashchange",R);var B=function(){if(null!==O){var e=x[O].routesHistory;if(0<e.length)return P=!0,window.location="/#/"+e[e.length-1],!0}return!1};$(".previous-route").click(function(){var e="/#/";if(null!==O){var a=x[O].routesHistory;if(0<=a.length-2)a.pop(),e+=a.pop()}window.location=e}),$("#ignore-unsaved").click(function(){var e=x[O];e&&(e.unsavedChanges=!1,j?window.location="/#/"+j:D(O))});var L=function(){var e=x[O];if(e){var a=function(){e.unsavedChanges=!1,e&&"function"==typeof e.saveCallback&&e.saveCallback(function(e){if(e===O){var a=$("#action-todo"),t=$("#action-done");a.fadeOut(200,function(){t.fadeIn(400,function(){setTimeout(function(){t.fadeOut(200,function(){a.fadeIn()})},800)})})}})};e.unsavedChanges?a():setTimeout(function(){e.unsavedChanges?a():app.toast(h({en_us:"Nothing to save",pt_br:"Não há alteração a ser salva"}))},300)}};$("#action-save").click(L);var U=!1,J=function(){var a=x[O];if(a)if(null===a.actionTitle){var e=!0;if(window.elTab){var t=window.elTab.find("input.action-title");if(t.length){var n=function(e){a.actionTitle=e,$("#action-title").text(e)};t.focus().change(function(){n($(this).val())}),n(t.val()),e=!1}}!0===e&&$("#action-title").text("")}else $("#action-title").text(a.actionTitle);$("#topbar-action").fadeIn(),U=!0},V=function(){$("#topbar-action").fadeOut(),U=!1},G=function(){var e=x[O];e&&(e.saveAction?J():U&&V(),function(){var e,a=$("#sidebar"),t=a.find(".menu-link").filter(function(){return"/#/"===$(this).attr("href").slice(0,3)}),n=function(e,a){e[a]("active"),e.parent(".menu-submenu").parent()[a]("active")};if(n(t.parent(".active"),"removeClass"),t.each(function(){if($(this).attr("href")==="/"+window.location.hash)return n($(this).parent(),"addClass"),!(e=!0)}),!e&&window.routeParams.length){var o=a.find('li[data-route-param="'+window.routeParams[0]+'"]');o.length&&n(o,"addClass")}}())};window.setSaveAction=function(e,a){var t=x[O];if(t){if(e){t.unsavedChanges=!1;try{e.submit(L)}catch(e){console.error(e)}}t.saveAction=!0,t.saveCallback=a,J()}},window.unsetSaveAction=function(){var e=x[O];e&&(e.saveAction=!1,e.saveCallback=null,V())},window.triggerUnsaved=function(e){var a=x[e];a&&!0!==a.unsavedChanges&&(a.unsavedChanges=!0)},window.apiResources={products:{label:{en_us:"Products",pt_br:"Produtos"},icon:"tag"},orders:{label:{en_us:"Orders",pt_br:"Pedidos"},icon:"inbox"},brands:{label:{en_us:"Brands",pt_br:"Marcas"},icon:"trademark"},categories:{label:{en_us:"Categories",pt_br:"Categorias"},icon:"bookmark"},collections:{label:{en_us:"Collections",pt_br:"Coleções"},icon:"th-large"},grids:{label:{en_us:"Grids",pt_br:"Grades"},icon:"filter"},customers:{label:{en_us:"Customers",pt_br:"Clentes"},icon:"users"},carts:{label:{en_us:"Carts",pt_br:"Carrinhos"},icon:"shopping-cart"},authentications:{label:{en_us:"Users",pt_br:"Usuários"},icon:"id-card"}};!function(){var e=function(e,a){var t,n="";if(a)for(var o=0;o<a.length;o++){var s=a[o];n+='<li class="menu-item" data-route-param="'+s+'"><a class="menu-link" href="/#/resources/'+s+'"><span class="icon fa fa-'+(t=window.apiResources[s]).icon+'"></span><span class="title">'+h(t.label)+"</span></a></li>"}t=window.apiResources[e];var r=h(t.label),i=r.toLowerCase();return'<li class="menu-item" id="'+e+'-menu" data-route-param="'+e+'"><a class="menu-link" href="javascript:;"><span class="icon fa fa-'+t.icon+'"></span><span class="title">'+r+'</span><span class="arrow"></span></a><ul class="menu-submenu"><li class="menu-item"><a class="menu-link" href="/#/resources/'+e+'"><span class="icon fa fa-th-list"></span><span class="title">'+c.all_the+" "+i+'</span></a></li><li class="menu-item"><a class="menu-link" href="/#/resources/'+e+'/new"><span class="icon fa fa-plus"></span><span class="title">'+c.create+" "+i.slice(0,-1)+"</span></a></li>"+n+"</ul></li>"},a='<li class="menu-item"><a class="menu-link" href="/#/home"><span class="icon fa fa-home"></span><span class="title">'+c.home+"</span></a></li>"+e("orders",["customers","carts"])+e("products",["brands","categories","collections","grids"])+'<li class="menu-item"><a class="menu-link" href="/#/apps"><span class="icon fa fa-puzzle-piece"></span><span class="title">Apps</span></a></li><li class="menu-item"><a class="menu-link" href="javascript:;" onclick="initStorageLib()" data-toggle="quickview" data-target="#qv-storage"><span class="icon fa fa-picture-o"></span><span class="title">'+c.media+'</span></a></li><li class="menu-item"><a class="menu-link" href="/#/settings"><span class="icon fa fa-cogs"></span><span class="title">'+c.settings+'</span></a></li><li class="menu-category" onclick="newChannel()">'+c.channels+'<i class="fa fa-plus-circle"></i></li>',t=$("#sidebar");t.append(a);var n=$("<span />",{class:"badge badge-primary"});t.find("#orders-menu > a > .title").after(n);var o=function(){k("$count.json","POST",function(e,a){e||n.text(a.count)},{resource:"orders"})};setTimeout(function(){o(),setInterval(o,6e4)},600),$(".sidebar-toggler").is(":visible")&&sidebar.unfold()}();var H,F,K=[];window.newChannel=function(){if(K.length){var e=H.$main.additional_channels_cost;if(void 0===e)return;var a=$("#channel-price");a.children("strong").text(window.formatMoney(e)),a.show()}$("#modal-channel").modal("show")},S(null,function(e,a){if(e)console.error(e);else if(a.host){var d="https://"+a.host+"/",c=null;window.setImagesCallback=function(e){c=e,l=[]};var l=[],s=function(e){"function"==typeof c&&(c(e,l),c=null)};$("#uploads-done").click(function(){s()});var p,f={zoom:{path:""},small:{size:100,path:"imgs/100px/"},normal:{size:400,path:"imgs/400px/"},big:{size:700,path:"imgs/700px/"}},r=function(){var a=[];return $("#storage-content a.active").each(function(){var e=$(this).data("key");e&&a.push(e)}),a},i=function(){$("#storage-content a.active").removeClass("active")};$("#storage-select").click(function(){var e=r();if(e.length){for(var a=0;a<e.length;a++){var t=e[a].replace(/^.*(@.*)$/,"$1"),n={};for(var o in f)f.hasOwnProperty(o)&&(n[o]={url:d+f[o].path+t});l.push(n)}i()}s()}),$("#storage-delete").click(function(){var e=r();e.length?(!function(e){for(var a=[],t=0;t<e.length;t++){var n=e[t].replace(/^.*(@.*)$/,"$1");for(var o in f)f.hasOwnProperty(o)&&a.push({Key:f[o].path+n})}var s={Delete:{Objects:a,Quiet:!0}},r=$("#storage-content").closest(".ajax-content");r.addClass("ajax");S("deleteObjects",function(e,a){e||u(),r.removeClass("ajax")},s)}(e),i()):app.toast(h({en_us:"No image selected to delete",pt_br:"Nenhuma imagem selecionada para deletar"}))}),$("#load-storage").click(function(){u(p)});var u=function(e){var c=$("#storage-content"),l=c.closest(".ajax-content");e||c.html(""),l.addClass("ajax");var u=$("#load-storage");u.attr("disabled",!0);var a={Prefix:f.normal.path,MaxKeys:15};e&&(a.Marker=e);S("listObjects",function(e,a){if(!e){var t=a.Contents;if(Array.isArray(t)){var n="",o=t.length,s=0,r=function(){o<=++s&&(a.IsTruncated&&(u.removeAttr("disabled"),a.NextMarker&&(p=a.NextMarker)),l.removeClass("ajax"),c.append(n).find(".storage-object").fadeIn())};if(0<o)for(var i=0;i<o;i++)!function(){var e=t[i].Key,a=new Image;a.onload=function(){n+='<div class="masonry-item storage-object"><a href="javascript:;" onclick="$(this).toggleClass(\'active\')" data-key="'+e+'"><img src="'+this.src+'"></a></div>',r()},a.src=d+e}();else r()}}},a)},t=new Dropzone("#dropzone",{url:C+"upload.json",headers:v});t.on("complete",function(a){try{var e=JSON.parse(a.xhr.responseText)}catch(e){return m(),void console.error(new Error("Upload filed"),a)}if("success"!==a.status&&m(e),"function"==typeof c&&"image/"===a.type.substr(0,6)&&e.key&&"success"===a.status){var t,n={};for(t in f)f.hasOwnProperty(t)&&(n[t]={url:d+f[t].path+e.key});if(a.height&&a.width){var o=a.width,s=a.height;for(t in n.zoom.size=o+"x"+s,f)if(f.hasOwnProperty(t)){var r=f[t].size;r&&(n[t].size=s<o?r+"x"+Math.round(s*r/o):Math.round(o*r/s)+"x"+r)}}if(a.name){var i=a.name.replace(/\.[^.]+$/,"");for(t in n)n.hasOwnProperty(t)&&(n[t].alt=i)}l.push(n)}}),window.upload=function(){t.removeAllFiles(),$("#modal-uploads").modal("show")};var n=null;window.editImage=function(e,a){n=e;var t=$("#modal-edit-image");a?t.find("input").each(function(){var e=a[$(this).attr("name")];e?$(this).val(e):$(this).val("")}):t.find("input").val(""),t.modal("show")},$("#edit-image").click(function(){if("function"==typeof n){var a={};$("#modal-edit-image input").each(function(){var e=$(this).val().trim();""!==e&&(a[$(this).attr("name")]=e)}),n(null,a)}}),$("#remove-image").click(function(){"function"==typeof n&&n(null,!1)}),window.initStorageLib=function(){void 0===p&&u()}}else console.log("Unexpected Storage API response:",a)}),k("stores/me.json","GET",function(e,a){e?t(e):(H=a,k("authentications/me.json","GET",function(e,a){e?t(e):(F=a,X(),Y())}))});var Y=function(){_("channels.json","GET",function(e,a){if(!e&&(K=a.result).length){for(var t=0;t<K.length;t++)K[t].domains=[];_("domains.json","GET",function(e,a){if(!e){for(var t=a.result,n=0;n<t.length;n++){for(var o=t[n].id,s=0;s<K.length;s++)t[n].channel_id===K[s].id&&K[s].domains.push(o);window.shopDomain||-1!==o.indexOf(".e-com.plus")&&n!==t.length-1||(window.shopDomain=o)}!function(){var e=$("#sidebar");e.find(".li-channel").remove();for(var a=0;a<K.length;a++){var t,n=K[a],o="/#/channels/"+n.id;t=n.domains.length?"https://"+n.domains[n.domains.length-1]:"#";var s=$("<li />",{class:"menu-item li-channel",html:'<a class="menu-link" href="javascript:;"><span class="icon fa fa-shopping-bag"></span><span class="title">'+n.title+'</span><span class="arrow"></span></a><ul class="menu-submenu"><li class="menu-item"><a class="menu-link" href="'+t+'" target="_blank"><span class="icon fa fa-eye"></span><span class="title">'+c.go_to_store+'</span></a></li><li class="menu-item"><a class="menu-link" href="'+o+'/themes"><span class="icon fa fa-paint-brush"></span><span class="title">'+c.themes+'</span></a></li><li class="menu-item"><a class="menu-link" href="'+o+'/settings"><span class="icon fa fa-wrench"></span><span class="title">'+c.settings+"</span></a></li></ul>"});e.append(s),s.slideDown("slow")}}()}})}})},X=function(){q(function(){R()}),$(".qv-close").click(function(){quickview.close($(this).closest(".quickview"))}),$(".logout").click(function(){$("#modal-logout").modal("show")}),$("#logout").click(function(){$(window).off("beforeunload"),window.location="/"}),$("#new-channel").click(function(){var t={};$("#modal-channel").find("input,select").each(function(){var e=$(this).attr("name"),a=$(this).val();e&&a&&(t[e]=a)});k("@channels.json","POST",function(e){e||(Y(),$("#modal-channel input").val(""))},t)});var r=!1;$(document).mousedown(function(e){return(e.ctrlKey||2===e.which)&&(r=!0),!0}),$(document).click(function(e){if(!0===r){var a,t;for(r=!1,a=e.target;a&&void 0===t;)switch(a.nodeName){case"A":t=a;break;case"DIV":case"P":case"BUTTON":case"BODY":a=!1;break;default:a=a.parentElement}if(void 0===t||"string"!=typeof t.href)return!0;switch(t.href){case"javascript:;":case"#":return e.preventDefault(),!0}var n=t.href.split(window.location.origin+"/#");if(2===n.length){e.preventDefault();var o="#"+n[1];"#"!==o&&E(s=o)&&q(function(){window.location.hash===s?R():window.location="/"+s})}}var s});var o=$("#app-search");o.attr("placeholder",h({en_us:"Search",pt_br:"Pesquisar"}));var s={},a={},t=function(e){switch(Object.keys(s).length){case 1:switch(e.keyCode){case 37:$("#app-nav-"+O).prev().children("a").click();break;case 39:var a=$("#app-nav-"+O).next();"new-nav-item"!==a.attr("id")&&a.children("a").click();break;case 84:q(null,!0);break;case 87:D(O);break;case 83:e.preventDefault(),o.focus();break;case 81:$(".topbar img.avatar").click();break;case 77:dock.toggleMinimize("#dock-chat")}break;case 2:var t,n=function(){switch(e.keyCode){case 80:return"/#/resources/products";case 79:return"/#/resources/orders";case 73:return"/#/resources/categories";case 85:return"/#/resources/customers";case 89:return"/#/resources/brands";case 84:return"/#/resources/carts";case 82:return"/#/resources/grids";case 69:return"/#/resources/collections";case 87:return"/#/resources/authentications"}};if(0===s[71])switch(e.keyCode){case 72:window.location="/#/home";break;case 83:window.location="/#/settings";break;case 65:window.location="/#/apps";break;default:(t=n())&&(window.location=t)}else 0===s[65]&&(t=n())&&(window.location=t+"/new");break;case 3:0===s[66]&&1===s[89]&&2===s[69]&&$("#logout").click()}};$(document).keydown(function(e){return"BODY"!==e.target.nodeName?27!==e.keyCode||void $(e.target).blur():!0===a[e.keyCode]||void(void 0!==s[e.keyCode]?(t(e),a[e.keyCode]=!0):s[e.keyCode]=Object.keys(s).length)}).keyup(function(e){if("BODY"!==e.target.nodeName)return!0;!0!==a[e.keyCode]?void 0!==s[e.keyCode]&&t(e):delete a[e.keyCode],delete s[e.keyCode]}),window.startMony(H,F,n)};window.appReady()}});